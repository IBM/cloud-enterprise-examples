(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{nLAp:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return o})),n.d(t,"default",(function(){return m}));n("91GP"),n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("q1tI");var a=n("7ljp"),r=n("013z");n("qKvR");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var o={},c=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(a.b)("div",t)}},p=c("PageDescription"),s=c("AnchorLinks"),l=c("AnchorLink"),u={_frontmatter:o},b=r.a;function m(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["components"]);return Object(a.b)(b,i({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)(p,{mdxType:"PageDescription"},Object(a.b)("p",null,"IaC to manage Network Services Resources")),Object(a.b)("p",null,"Every infrastructure requires network resources in order to build everything on top of it. This page explain all the Network Resources needed to provision and deploy an application exposing an API about movies. The following diagram shows the network architecture to build in this page."),Object(a.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"762px"}},"\n      ",Object(a.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"117.01388888888889%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAEXUlEQVQ4y4WUa2gcVRTHp7XZpNlNSk229ZMPCn6LVAuKSAnURBGhflMiYpE2UdRqMDZQailRRFoREbH4qP2gScQvPj60K6UiqJRqax4mzZPNZndn7rzfj33N7PHcmdlmrY/O8tt753/PPXPO/zLDMAyzD+lD7kceQh5A+uP53cjeOObBeE7Xe5B7kUeRnQizfecdTOO6HbkL2YXcibQiyZi2mFST1ryWiuM3I7eEpFLbbmtLJLq2tie7tra2bk+1t6c6k8kkpSOZTFE6Uyk6TzbpyUjHP4xHOpJtbR1btrR0MLv29A329D+d3t37xI69B461P37045aHX3qnte/wqcQjw+8lel94O9Hz5GuJ3QNHwnn/K+8m+nGNjn0vnwxjHhv5INE3/H7inv0vtjDpV8f3bx7+tpdhbk3EpW/6B12AI9n0r2tNpI5fbGX2vXF2R7ZAvlZU9UdZkc5LsvQDjhmKosoZjrCZ2T9nMnPzcxlCuIyKWmO9Ke6iwJPJgdMXUsyVc9B9Yf68sKIvAL3qUIMA/PAXhL8aVGolqNbKUKvXQrWOQIyPGr0kRbSPfjXVyYyc+iadI7ksr6tQUOxqVjJ9Qbd923F9w3J8oln+umL7edX2NbynumLgvWL6axjLa3bV9jwQZYEbnfyjk3nq2Om0riu5c9cE+HmBDfKsCJyogWG7sMprMHF5DVbzAhSIDJxigoebv58pwE/zRShwYWygu2VaoTA6cbWTGXrz87QgCznJ8uimgMuzwAoqiJoFumlDXtSBLRDgWAFYyQDDsoFg4jx9AMZyghoothcl/PL3RkIxZzgeEKsSELcGnIlP1Mxos4agRhzUVTvUZFzjrArEsYGK3YQJxxsJFTGnocgZXkCsMnA6eqJGCTnFAqqFuhJpkmoAa3gQxwaq1Zxw7EyU0HKAzZOAWysAW+RBVHTc7ABHJOByReDW0QqcU01SjMiGHMYW+EA16UMkYfSLyxst604JOMkIOPSGeiWhh1GFJvUpQo4rxJZZ2QAaS/eoDQ9phYNxyyqt0CzFHpY2WkbfqH+Rh1bcMvWwvOHh9ZavdDLPv3U2zeMpu6UARLMaEAMr1TBAbaoQ/QrBCvWGh7oLhGqa83cPnz3xYVpW1dyv2V9gdn0qEHUJWxJBMTQwbQdUzbiOglBNN61wHuqqEVhu3PIEVvjciY/SkqLk5sgULGUvBXx2GgR+ESSdB8d1wb0Rx7lRCyrVSpjwyORV2vJn2LKY80oWyCaHFRZBMApYJU3ohQmcZjBJ873rNCWM3pRP8ZSlnG5LwFvFQHSFumAV65JK6piwjpv+l6aEfFjh4NgneMrSmmZKIKjrNVEr+jj6ssr7rlfysSXE+w9c33O9WrkSvstkhB7K4ZPj3UQiQhU/U7Zng1N2QtyyC+Vq6aaUKl74uRMkYox9t9LB3HfgePel2YWB2eXVoeml1YMzS6uHIlYOTS0u35yF5YPTiytDv81ee2bP62e2/QVuWhXtiY8VvQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(a.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Architecture",title:"Network Resources Architecture",src:"/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/1b1fd/IaC-Network_Resources.png",srcSet:["/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/7fc1e/IaC-Network_Resources.png 288w","/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/a5df1/IaC-Network_Resources.png 576w","/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/1b1fd/IaC-Network_Resources.png 762w"],sizes:"(max-width: 762px) 100vw, 762px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(a.b)("p",null,"The code to build these resources can be downloaded from the GitHub repository ",Object(a.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(a.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/06-network"}),"06-network"),"."),Object(a.b)(s,{small:!0,mdxType:"AnchorLinks"},Object(a.b)(l,{mdxType:"AnchorLink"},"VPC"),Object(a.b)(l,{mdxType:"AnchorLink"},"Subnets and Zones"),Object(a.b)(l,{mdxType:"AnchorLink"},"Security Groups"),Object(a.b)(l,{mdxType:"AnchorLink"},"Public Gateways"),Object(a.b)(l,{mdxType:"AnchorLink"},"Floating IP"),Object(a.b)(l,{mdxType:"AnchorLink"},"VPN"),Object(a.b)(l,{mdxType:"AnchorLink"},"Final Terraform code"),Object(a.b)(l,{mdxType:"AnchorLink"},"Clean up")),Object(a.b)("h2",null,"VPC"),Object(a.b)("p",null,"IBM Cloud Virtual Private Cloud (VPC) allows you to create your own space in the IBM Cloud, to run an isolated environment within the public cloud. VPC gives you the security of a private cloud, with the agility and ease of a public cloud."),Object(a.b)("p",null,"To create a VPC with Terraform use the resource ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_vpc")," providing the ",Object(a.b)("inlineCode",{parentName:"p"},"name")," and optionally the ",Object(a.b)("inlineCode",{parentName:"p"},"resource_group"),", add this code to the ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," file."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=network.tf",path:"network.tf"}),'resource "ibm_is_vpc" "iac_app_vpc" {\n  name = "${var.project_name}-${var.environment}-vpc"\n}\n')),Object(a.b)("p",null,"More parameters are accepted, to know more about them read the ",Object(a.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#provider-vps"}),"ibm_is_vpc")," documentation."),Object(a.b)("h2",null,"Subnets and Zones"),Object(a.b)("p",null,"A  VPC is divided into subnets, using a range of private IP addresses. After creating the VPC you can add one or more subnets. Bu default all resources within the same VPC can communicate with each other, regardless of the subnets."),Object(a.b)("p",null,"Each subnet must be contained within a single Zone and cannot span zones. Zones are distinct locations that are engineered to be isolated from failures in other Zones. By launching instances in separate Zones, you can protect your applications from the failure of a single location, helping with security, with reducing latency, and with high availability."),Object(a.b)("p",null,"To create a Subnet with Terraform we use the resource ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_subnet"),", it requires the ",Object(a.b)("inlineCode",{parentName:"p"},"name"),", the ",Object(a.b)("inlineCode",{parentName:"p"},"vpc")," and the ",Object(a.b)("inlineCode",{parentName:"p"},"zone")," where the subnet belongs."),Object(a.b)("p",null,"An example of a simple subnet would be like this"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl"}),'resource "ibm_is_subnet" "iac_app_subnet" {\n  name            = "${var.project_name}-${var.environment}-subnet"\n  vpc             = ibm_is_vpc.iac_app_vpc.id\n  zone            = "us-south-1"\n  ipv4_cidr_block = "10.240.0.0/24"\n}\n')),Object(a.b)("p",null,"This example creates a subnet named from the project name and environment, in the VPC previously created, in the zone ",Object(a.b)("inlineCode",{parentName:"p"},"us-south-1")," and with CIDR block ",Object(a.b)("inlineCode",{parentName:"p"},"10.240.0.0/24"),". These and other parameters are:"),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",i({parentName:"tr"},{align:null}),"Input parameter"),Object(a.b)("th",i({parentName:"tr"},{align:null}),"Description"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),Object(a.b)("inlineCode",{parentName:"td"},"name")),Object(a.b)("td",i({parentName:"tr"},{align:null}),"name of the subnet")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),Object(a.b)("inlineCode",{parentName:"td"},"vpc")),Object(a.b)("td",i({parentName:"tr"},{align:null}),"VPC ID where the subnet is created")))),Object(a.b)("p",null,"|\n",Object(a.b)("inlineCode",{parentName:"p"},"zone")," | Zone name where the subnet is created |\n| ",Object(a.b)("inlineCode",{parentName:"p"},"ipv4_cidr_block")," | (optional) IPv4 range of the subnet |\n| ",Object(a.b)("inlineCode",{parentName:"p"},"total_ipv4_address_count")," | (optional) total number of IPv4 addresses |\n| ",Object(a.b)("inlineCode",{parentName:"p"},"network_acl")," | (optional) ID of the network ACL for the subnet |\n| ",Object(a.b)("inlineCode",{parentName:"p"},"public_gateway")," | (optional) ID of the public gateway for the subnet that you want to attach to the subnet. You create the public gateway with the ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_public_gateway")," resource |\n| ",Object(a.b)("inlineCode",{parentName:"p"},"resource_group")," | (optional) ID of the resource group where you want to create the subnet |"),Object(a.b)("p",null,"For more information read the ",Object(a.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#subnet"}),"ibm_is_subnet")," documentation."),Object(a.b)("p",null,"In our use case we need multiple subnets, append the following code to ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," to create them all using the index as part of the name."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=network.tf",path:"network.tf"}),'resource "ibm_is_subnet" "iac_app_subnet" {\n  count                    = local.max_size\n  name                     = "${var.project_name}-${var.environment}-subnet-${format("%02s", count.index)}"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_app_vpc.id\n  total_ipv4_address_count = 16\n  public_gateway           = element(ibm_is_public_gateway.pgw.*.id, count.index)\n  resource_group           = data.ibm_resource_group.group.id\n}\n')),Object(a.b)("p",null,"Instead of define a CIDR block lets define the total number of IP address and get the default ",Object(a.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc-on-classic-network?topic=vpc-on-classic-network-working-with-ip-address-ranges-address-prefixes-regions-and-subnets#ibm-cloud-vpc-and-address-prefixes"}),"VPC address prefixes"),"."),Object(a.b)("p",null,"This code creates the subnets in different zones, defined in the list variable ",Object(a.b)("inlineCode",{parentName:"p"},"vpc_zone_names")," which is in the ",Object(a.b)("inlineCode",{parentName:"p"},"variables.tf")," file like this."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "region" {\n  default  = "us-south"\n}\nvariable "vpc_zone_names" {\n  type    = list(string)\n  default = ["us-south-1", "us-south-2", "us-south-3"]\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n')),Object(a.b)("p",null,"As you can see the number of subnets to create depends on the number of zones in the list ",Object(a.b)("inlineCode",{parentName:"p"},"vpc_zone_names"),"."),Object(a.b)("h2",null,"Security Groups"),Object(a.b)("p",null,"A ",Object(a.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-using-security-groups"}),"security group")," is like a virtual firewall for your VSI to control inbound and outbound traffic through filtering rules. The default rule (create the security group without rules) denies all traffic, you need to add rules to define the filters for inbound and outbound traffic. These rules allow reverse traffic, this means a rule opening port 80 for inbound traffic also open the port 80 for outbound traffic to the original host."),Object(a.b)("p",null,"To create the security groups and the rules we use the resources ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_security_group")," and ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_security_group_rule"),". Adding the following code to ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," we open the port defined by the user (defaults to ",Object(a.b)("inlineCode",{parentName:"p"},"8080"),") and port ",Object(a.b)("inlineCode",{parentName:"p"},"22")," to allow SSH connections (just for testing, we can remove it later) only to the VSI in the first security group."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=network.tf",path:"network.tf"}),'resource "ibm_is_security_group" "iac_app_security_group" {\n  name           = "${var.project_name}-${var.environment}-sg-public"\n  vpc            = ibm_is_vpc.iac_app_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource "ibm_is_security_group_rule" "iac_app_security_group_rule_tcp_http" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = "inbound"\n  remote    = ibm_is_subnet.iac_app_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = var.port\n    port_max = var.port\n  }\n}\n\nresource "ibm_is_security_group_rule" "iac_app_security_group_rule_tcp_ssh" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = "inbound"\n  remote    = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n\n  tcp {\n    port_min = 22\n    port_max = 22\n  }\n}\n')),Object(a.b)("p",null,"Other option to set access rules to the security group is through the Network Access Control List (ACL) with the ",Object(a.b)("a",i({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#network-acl"}),"ibm_is_network_acl")," resource."),Object(a.b)("p",null,"Three options are available for enabling communications from your VSI to the public internet:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Use a public gateway (PGW) to enable communication to the internet for all virtual server instances on the attached subnet. There is no charge for using a PGW, except for the bandwidth used."),Object(a.b)("li",{parentName:"ul"},"Use a Floating IP (FIP) to enable communication to and from a single VSI to the internet."),Object(a.b)("li",{parentName:"ul"},"Use a VPN gateway.")),Object(a.b)("h2",null,"Public Gateways"),Object(a.b)("p",null,"A Public Gateway (PGW) enables a subnet to connect to the Internet. PGW uses Many-to-1 NAT, which means every VSI  with private addresses will use 1 public IP address to talk to the public Internet. The PGW are tie to the VPC and the Zone, allowing internet connection to all the subnets and VSI within that zone."),Object(a.b)("p",null,"To create a PGW we use the ",Object(a.b)("inlineCode",{parentName:"p"},"ibm_is_public_gateway")," resources like the following code appended to the ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," file."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=network.tf",path:"network.tf"}),'resource "ibm_is_public_gateway" "pgw" {\n  count = local.max_size\n  name  = "${var.project_name}-${var.environment}-pgw-${format("%02s", count.index)}"\n  vpc   = ibm_is_vpc.iac_app_vpc.id\n  zone  = var.vpc_zone_names[count.index]\n}\n')),Object(a.b)("p",null,"Besides the parameters in the example you can also have the optional parameters ",Object(a.b)("inlineCode",{parentName:"p"},"resource_group")," and ",Object(a.b)("inlineCode",{parentName:"p"},"tags"),". Among the output parameters we have ",Object(a.b)("inlineCode",{parentName:"p"},"floating_ip")," with a collection of floating IP addresses that are bound to the public gateway. Every floating IP address is listed with the floating IP ",Object(a.b)("inlineCode",{parentName:"p"},"id")," and ",Object(a.b)("inlineCode",{parentName:"p"},"address"),". To report these IP address, lets use the following output variables in the file ",Object(a.b)("inlineCode",{parentName:"p"},"output.tf")),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "pgw_ip_addresses" {\n  value = ibm_is_public_gateway.pgw[*].floating_ip.address\n}\n')),Object(a.b)("h2",null,"Floating IP"),Object(a.b)("p",null,"Floating IP addresses are IP addresses that are provided by IBM Cloud and are reachable from the public Internet. An Floating IP is linked to a VSI, Load Balancer or VPN Gateway, allowing internet access to this linked resource only."),Object(a.b)("p",null,"Having a public gateway defined we do not need Floating IP but if youâ€™d like to have them instead of PWG this is the code to add to ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," to link every Floating IP to a VSI."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=network.tf",path:"network.tf"}),'resource "ibm_is_floating_ip" "iac_app_floating_ip" {\n  count  = var.max_size\n  name   = "${var.project_name}-${var.environment}-ip-${format("%02s", count.index)}"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n}\n')),Object(a.b)("p",null,"To list the Floating IPs we can use the following code with output variables."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "ip_address" {\n  value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n}\n')),Object(a.b)("h2",null,"VPN"),Object(a.b)("p",null,"The last resource to allow internet connection is Virtual Private Network (VPN), a service that is available for users to connect to their IBM Cloud VPC from the Internet, securely. This method may be the best option to connect to your VPC but it may not be suitable for every architecture or requirements."),Object(a.b)("p",null,"A simple example, not to be used in this story would be like this."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl"}),'resource "ibm_is_vpn_gateway" "iac_app_vpn_gateway" {\n  name   = "${var.project_name}-${var.environment}-vpn"\n  subnet = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n}\n\nresource "ibm_is_vpn_gateway_connection" "VPNGatewayConnection" {\n  name          = "${var.project_name}-${var.environment}-vpn-gw"\n\n  vpn_gateway   = ibm_is_vpn_gateway.iac_app_vpn_gateway.id\n  peer_address  = ibm_is_vpn_gateway.iac_app_vpn_gateway.public_ip_address\n\n  preshared_key = "VPNDemoPassword"\n\n  local_cidrs   = [ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block]\n  peer_cidrs    = [ibm_is_subnet.iac_app_subnet[1].ipv4_cidr_block]\n}\n')),Object(a.b)("p",null,"Having all the resources ready in the ",Object(a.b)("inlineCode",{parentName:"p"},"network.tf")," file and the variables set, we just need to execute the following terraform commands."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform init    # Only the first time\nterraform plan\nterraform apply\n")),Object(a.b)("h2",null,"Final Terraform code"),Object(a.b)("p",null,"You can download the code from the GitHub repository ",Object(a.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(a.b)("a",i({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/06-network"}),"06-network")," where the main files are:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:'path=network.tfresource "ibm_is_vpc" "iac_app_vpc" {',path:"network.tfresource",'"ibm_is_vpc"':!0,'"iac_app_vpc"':!0,"{":!0}),'  name = "${var.project_name}-${var.environment}-vpc"\n}\n\nresource "ibm_is_subnet" "iac_app_subnet" {\n  count                    = local.max_size\n  name                     = "${var.project_name}-${var.environment}-subnet-${format("%02s", count.index)}"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_app_vpc.id\n  total_ipv4_address_count = 16\n  public_gateway           = element(ibm_is_public_gateway.pgw.*.id, count.index)\n  resource_group           = data.ibm_resource_group.group.id\n}\n\nresource "ibm_is_security_group" "iac_app_security_group" {\n  name           = "${var.project_name}-${var.environment}-sg-public"\n  vpc            = ibm_is_vpc.iac_app_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource "ibm_is_security_group_rule" "iac_app_security_group_rule_tcp_http" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = "inbound"\n  remote    = ibm_is_subnet.iac_app_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = var.port\n    port_max = var.port\n  }\n}\n\nresource "ibm_is_security_group_rule" "iac_app_security_group_rule_tcp_ssh" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = "inbound"\n  remote    = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n\n  tcp {\n    port_min = 22\n    port_max = 22\n  }\n}\n\nresource "ibm_is_security_group_rule" "iac_app_security_group_rule_all_outbound" {\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = "outbound"\n}\n\nresource "ibm_is_public_gateway" "pgw" {\n  count = local.max_size\n  name  = "${var.project_name}-${var.environment}-pgw-${format("%02s", count.index)}"\n  vpc   = ibm_is_vpc.iac_app_vpc.id\n  zone  = var.vpc_zone_names[count.index]\n}\n\n// resource "ibm_is_floating_ip" "iac_app_floating_ip" {\n//   name   = "${var.project_name}-${var.environment}-ip-${format("%02s", count.index)}"\n//   target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n//   count  = var.max_size\n// }\n')),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "project_name" {}\nvariable "environment" {}\n\nvariable "port" {\n  default = 8080\n}\n\nvariable "resource_group" {\n  default = "Default"\n}\nvariable "region" {\n  default = "us-south"\n}\nvariable "vpc_zone_names" {\n  type    = list(string)\n  default = ["us-south-1", "us-south-2", "us-south-3"]\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n')),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-hcl",metastring:"path=output.rf",path:"output.rf"}),'// output "ip_address" {\n//   value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n// }\n\noutput "pgw_ip_addresses" {\n  value = ibm_is_public_gateway.pgw[*].floating_ip.address\n}\n')),Object(a.b)("h2",null,"Clean up"),Object(a.b)("p",null,"To clean up everything just execute:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-bash"}),"terraform destroy\n")))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-iac-resources-network-index-mdx-fbbed9664b6ddd7e8605.js.map