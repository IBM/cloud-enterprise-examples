(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{CPEp:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return d}));a("91GP"),a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("q1tI");var n=a("7ljp"),o=a("013z");a("qKvR");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var i={},c=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",t)}},l=c("PageDescription"),s=c("AnchorLinks"),b=c("AnchorLink"),p=c("InlineNotification"),m={_frontmatter:i},u=o.a;function d(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,["components"]);return Object(n.b)(u,r({},m,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)(l,{mdxType:"PageDescription"},Object(n.b)("p",null,"Automating compute resources with Terraform and Schematics. Compute images and instances life cycle")),Object(n.b)("p",null,"One of the basic and atomic services every cloud provide is compute. Compute on IBM Cloud covers different services however this pattern guide is about the IBM Cloud Virtual Servers, also called Virtual Server Instances or VSI, how to customize public and private virtual servers that scale up or down to suit your needs, using Terraform and IBM Cloud Schematics. Other IBM Cloud Compute services such as Kubernetes, OpenShift, Container Registry and Cloud Functions are covered in other pattern guides."),Object(n.b)("p",null,"Based on the ",Object(n.b)("a",r({parentName:"p"},{href:"/cloud-enterprise-examples/iac-resources/network"}),"Network Resources")," pattern we would like to add a few compute resources and storage to host and expose an API with movies."),Object(n.b)("p",null,"The following diagram shows the proposed architecture."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"762px"}},"\n      ",Object(n.b)("span",r({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"117.01388888888889%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAFAElEQVQ4y4WUa4wTVRTHB4Tusm1XBep+8INREz+YIComvqKbIGD8gt80G42GAItREXSBSJAgEE1AQY1RIyJ+cAFFIo8AiwSNBHwssAul0N12aaevmbm98+w8+5jp8czQ1QVNnMmv9/bMOf85955zh2EY5qkWDyOPIQ8hc5HHkXuQJ1r/H23Nfb9ZyAPI00gXwtzadQczft2O3Inc1RIYn0eR9hYRJHwD4/Y2ZDJyU0A0ektXeyg0Y1pHePq0trbp7W2hGe04RsPhyDidkUgYx3Bni+g10I4/HR0RJBpub49OmTI1ytw9Z17vrAUvxGY/+WxX9+INHa/tH53Ss/3I1PkrPgwtQLpfeS8067m3Qvf3rA7m89/4IDR/+dZgnPf6ltCCldtCz/R9Epq38qPQfQtfncrEVvQvnLzyQDfDTA+1UveZdB0zAEd+0r/sNxBZf7KNmfvOrtsyBf57SZZ/FiV6jIr0OI4DPpIsDnB8aSB+6eJA4nJigOe5ARlt488n+J0kAr+n5/MTEebcUZh54vIxklaT4F9NaIAHbnB7/t1sQK3hQL1RhQbOfWsTgRYu2vyLSmVj7d7hTqZv648xlmczgipDkar1TFl1iWq4hmm5mm66vKy5OVFz87LhKvjft0ua7uap4map5gqKUTdsG8oi4dbsGepknl/3RUxVJfZoksKpjOHlSQVKRALVsGBMkKF/SIA0caDAi8CJGti2BYfiJfhlzADflyOSp1hVP0OyZvf5TqZ3w2cxQRZZURaBHl7t0T++A0GpAVU0UIwqcIN7QTq8FkhJAF4y8EU2CHwe6KE+KA8eQN+6J+vWNcH+cyi47uMYURRWLZeA2zzbyx/fDknNAqFMoOK4wO17G7ht3TBGCWaMNrsOlL0CpXfvheKvO9HX8URVBVGmZNW3f3YySzfujBGpzCoVA0q86A2nR2H3bz9AIpsE06pBrsBBJs/B8cQpOHz2GOimjX4EsjkOkqU89J/Z56W4DCiqQpbt+AkzHBfEtHlO9AqZHFy6nIAiwWxwH4u4d7lMHrJXr0Iqi4EVHW1l4DgRCtkcpNIpT5AlzFAkb35zGgU3fR0jYplVTQdKVPV4AR0FBXiqoKAJJSxErsADTxQgiomBKj6TgwLx+DJB0j0FY//ew6W+IGYo6xhccTzerAOnV6EoUJBVDQTVhBwKlfQalCQd20PCglUCH95qAIcx/xTlbCezbPOumCAS1nKaUK7UPV5zgFOxr+QKEIqtgiI5qqHNgpwggYTVF1GwpOAWaTZwinm94EsbPo2JssyeyZyGeG7YK8sEKCJXVFC0CgiEAiljS4kyLptiUUxQNT0Qln1kzdMtu9WHuORF2IdUltgENwSj7KAnFFMokgaqCmCho6b5gdjomgq6oaPNuhGvVq8Fgqv3nPeX/FVMoLjkehVk9pSnHlkONHMSaEUBE7OxbRNSl/C0JEhwSnzbRCxzgmBwUjbtCATVqgFc/KBXfP+RJn9hf1M0taZpGE3bsZrJIdK8gvhzFLmOCYJCkOHSjV9ilWlWrYhApFyDSAWXSKwryoJr2Y6LS3Idxw7w57gNE7Bc27Ib1Vpwlvk+vyjLt/TP5ClP6vjZMhwDrJoNVtUKqNad/8VBf/9zRyivbTyYjjIPvrx+5u/xZE88NdZ7YSS9+OJIesnF0TEkvWR4JHWNZIuR/yCZWoxxvYPxKy/OWbXz5r8ASEkENBhtSl8AAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",r({parentName:"span"},{className:"gatsby-resp-image-image",alt:"architecture",title:"Compute Resources Architecture",src:"/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/1b1fd/IaC-Compute_Resources.png",srcSet:["/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/7fc1e/IaC-Compute_Resources.png 288w","/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/a5df1/IaC-Compute_Resources.png 576w","/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/1b1fd/IaC-Compute_Resources.png 762w"],sizes:"(max-width: 762px) 100vw, 762px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"The code to build these resources can be downloaded from the GitHub repository ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute"}),"07-compute"),"."),Object(n.b)(s,{small:!0,mdxType:"AnchorLinks"},Object(n.b)(b,{mdxType:"AnchorLink"},"Virtual Server Instance"),Object(n.b)(b,{mdxType:"AnchorLink"},"Virtual Server Instance with IBM Cloud Schematics"),Object(n.b)(b,{mdxType:"AnchorLink"},"Load Balance a Cluster of VSI"),Object(n.b)(b,{mdxType:"AnchorLink"},"IBM Cloud Object Storage"),Object(n.b)(b,{mdxType:"AnchorLink"},"Volumes"),Object(n.b)(b,{mdxType:"AnchorLink"},"Final Terraform code"),Object(n.b)(b,{mdxType:"AnchorLink"},"Clean up"),Object(n.b)(b,{mdxType:"AnchorLink"},"Compute Resources & Data Source Reference")),Object(n.b)(p,{mdxType:"InlineNotification"},Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Requirements")),Object(n.b)("p",null,"To be able to execute and complete the instructions in this page, make sure you have an ",Object(n.b)("strong",{parentName:"p"},"IBM Cloud account"),": if you don’t have one yet, you can ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/overview?topic=overview-quickstart_lite#prereqs-lite"}),"create a Lite account")," for free."),Object(n.b)("p",null,"Also make sure you have the environment setup as explained in the ",Object(n.b)("a",r({parentName:"p"},{href:"/cloud-enterprise-examples/iac/setup-environment"}),"Setup Environment")," page to have installed the IBM Cloud CLI, login into your account with the IBM Cloud CLI and create a SSH Key.")),Object(n.b)("h2",null,"Virtual Server Instance"),Object(n.b)("p",null,"Before create a VSI we need to have all the networking resources created. The list of resources includes: VPC, Subnets in one or more zones, Public gateway for public internet communication, ACL’s for inbound and outbound traffic to the subnets. All these resources management is covered in the ",Object(n.b)("a",r({parentName:"p"},{href:"/cloud-enterprise-examples/iac/networking"}),"Networking section")," where the required network resources were created in the ",Object(n.b)("inlineCode",{parentName:"p"},"networking.tf")," file."),Object(n.b)("p",null,"The following code is an example to create a VSI, for this we use the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance")," resource."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'resource "ibm_is_ssh_key" "iac_app_key" {\n  name       = "${var.project_name}-${var.environment}-key"\n  public_key = var.public_key\n}\n\nresource "ibm_is_instance" "iac_app_instance" {\n  name    = "${var.project_name}-${var.environment}-instance"\n  image   = "r006-14140f94-fcc4-11e9-96e7-a72723715315"\n  profile = "cx2-2x4"\n\n  primary_network_interface {\n    name            = "eth1"\n    subnet          = ibm_is_subnet.iac_app_subnet.id\n    security_groups = [ibm_is_security_group.iac_app_security_group.id]\n  }\n\n  vpc  = ibm_is_vpc.iac_app_vpc.id\n  zone = "us-south-1"\n  keys = [ibm_is_ssh_key.iac_app_key.id]\n\n  user_data = <<-EOUD\n              #!/bin/bash\n              echo "Hello World" > index.html\n              nohup busybox httpd -f -p ${var.port} &\n              EOUD\n\n  tags = ["iac-${var.project_name}-${var.environment}"]\n}\n')),Object(n.b)("p",null,"The variables used in this code are defined at ",Object(n.b)("inlineCode",{parentName:"p"},"variables.tf")," like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "project_name" {}\nvariable "environment" {}\n\nvariable "public_key" {}\n\nvariable "port" {\n  default = 8080\n}\n')),Object(n.b)("p",null,"The value of the variables are set in the ",Object(n.b)("inlineCode",{parentName:"p"},"terraform.tfvars")," and ",Object(n.b)("inlineCode",{parentName:"p"},"*.auto.tfvars")," files. As we are going to use this code with the Terraform CLI on our local host and with IBM Cloud Schematics we should not use ",Object(n.b)("inlineCode",{parentName:"p"},"file(pathexpand(var.public_key_file))")," to get the value of a public key file like ",Object(n.b)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa.pub")," because it doesn’t work on IBM Cloud Schematics. Instead let’s send the content of the public key file to the variable ",Object(n.b)("inlineCode",{parentName:"p"},"public_key")," in the ",Object(n.b)("inlineCode",{parentName:"p"},"secrets.auto.tfvars")," file using the following command."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'echo -n "public_key = \\"$(cat ~/.ssh/id_rsa.pub)\\"\\n" > secrets.auto.tfvars\n')),Object(n.b)("p",null,"It is ",Object(n.b)("strong",{parentName:"p"},"important")," you make sure to include the file ",Object(n.b)("inlineCode",{parentName:"p"},"secrets.auto.tfvars")," to the ",Object(n.b)("inlineCode",{parentName:"p"},".gitignore")," file so you don’t share your secrets to the world."),Object(n.b)("p",null,"To test this VSI we’ll deploy a server to expose an API from a ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute/db.json"}),"movies database")," JSON file. This is a sample of it:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-json"}),'{\n  "movies": [{\n    "id": "83",\n    "title": "Akira Kurosawa\'s Dreams",\n    "summary": "This is essentially eight separate short films, with some overlaps in characters and thematic material - that of man\'s relationship with his environment. \'Sunshine Through The Rain\' - \'The Peach Orchard\' - \'The Blizzard\' - \'Crows\' - \'Mount Fuji in Red\' - The Weeping Demon\' - \'Village of the Watermills\'",\n    "year": "1990",\n    "duration": "7173610",\n    "originallyAvailableAt": "1990-05-11",\n    "addedAt": "1348382738",\n    "updatedAt": "1531023643",\n    "genre": "Sci-Fi & Fantasy",\n    "director": ["Akira Kurosawa", "Ishirô Honda"],\n    "writer": ["Akira Kurosawa"],\n    "cast": ["Akira Terao", "Mitsuko Baisho", "Toshie Negishi"]\n  }, {\n    ...\n  }]\n}\n')),Object(n.b)("p",null,"To deploy the JSON file to the provisioned VSI the first step is to load the file using the data source ",Object(n.b)("a",r({parentName:"p"},{href:"https://www.terraform.io/docs/providers/local/d/file.html"}),"local_file"),", the file content can be obtained with the attribute ",Object(n.b)("inlineCode",{parentName:"p"},"content")," or ",Object(n.b)("inlineCode",{parentName:"p"},"content_base64")," if you require the file content encoded."),Object(n.b)("p",null,"In the ",Object(n.b)("inlineCode",{parentName:"p"},"user_data")," attribute use the command ",Object(n.b)("inlineCode",{parentName:"p"},"echo")," with ",Object(n.b)("inlineCode",{parentName:"p"},"base64")," to print the decoded content of the JSON file that was previously encoded using the ",Object(n.b)("inlineCode",{parentName:"p"},"content_base64")," attribute of the ",Object(n.b)("inlineCode",{parentName:"p"},"local_file")," data source. Terraform sends the content of the file to the IBM Cloud engine through HTTP, it is recommended to encode this text otherwise we can get unexpected results. That’s why we’ll use the attribute ",Object(n.b)("inlineCode",{parentName:"p"},"content_base64")," instead of ",Object(n.b)("inlineCode",{parentName:"p"},"content"),", and we use the command ",Object(n.b)("inlineCode",{parentName:"p"},"base64"),", at the server side, to decode the received text."),Object(n.b)("p",null,"Modify the value of the ",Object(n.b)("inlineCode",{parentName:"p"},"user_data")," attribute of ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance.iac_app_instance")," and add the ",Object(n.b)("inlineCode",{parentName:"p"},"local_file")," data source, like this:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'data "local_file" "db" {\n  filename = "${path.module}/db.min.json"\n}\n\nresource "ibm_is_instance" "iac_app_instance" {\n  ...\n  user_data = <<-EOUD\n            #!/bin/bash\n            echo \'${data.local_file.db.content_base64}\' | base64 --decode > /var/lib/db.min.json\n\n            echo \'* libraries/restart-without-asking boolean true\' | debconf-set-selections\n            apt update\n            curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -\n            apt-get install -y nodejs\n            npm install -g json-server\n\n            json-server --watch /var/lib/db.min.json --port ${var.port} --host 0.0.0.0 &\n            EOUD\n  ...\n}\n')),Object(n.b)(p,{mdxType:"InlineNotification"},Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"user_data vs provisioners")),Object(n.b)("p",null,"Should I use ",Object(n.b)("inlineCode",{parentName:"p"},"user_data")," or provisioners such as ",Object(n.b)("inlineCode",{parentName:"p"},"file")," and ",Object(n.b)("inlineCode",{parentName:"p"},"remote-exec"),"?"),Object(n.b)("p",null,"Terraform is a provisioning tool, it should not do configuration tasks maybe just trigger them. Among the configuration management tools are: Ansible, Cloud-Init, Puppet and (the less recommended) shell scripts. Thus, the appropriate way to configure a server or trigger the configuration should be using ",Object(n.b)("inlineCode",{parentName:"p"},"user_data"),", it can execute either a Cloud-Init code, a script or to start a configuration management tool like Ansible. The ",Object(n.b)("inlineCode",{parentName:"p"},"user_data")," is also used by the auto-scaling in IBM Cloud and Terraform provisioners are not."),Object(n.b)("p",null,"The provisioners such as ",Object(n.b)("inlineCode",{parentName:"p"},"file")," and ",Object(n.b)("inlineCode",{parentName:"p"},"remote-exec")," are specific to Terraform that’s why they are not suggested for configuration management. If you would like to use them, read ",Object(n.b)("a",r({parentName:"p"},{href:"/cloud-enterprise-examples/iac/resources/compute/provisioners"}),"Using Terraform Provisioners"),".")),Object(n.b)("p",null,"We are introducing a new Terraform plugin (",Object(n.b)("inlineCode",{parentName:"p"},"local"),") with the ",Object(n.b)("inlineCode",{parentName:"p"},"local_file")," data source, so before apply the infrastructure code and deploy the application we need to download this plugin with the ",Object(n.b)("inlineCode",{parentName:"p"},"terraform init")," command. Execute the following commands to apply the new code:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform plan\nterraform apply\n")),Object(n.b)("p",null,"In about a minute the VSI is provisioned but the API server will be running in about an extra minute. To verify it’s working get the ",Object(n.b)("inlineCode",{parentName:"p"},"public_ip")," output variable to fetch some movies, like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'curl "$(terraform output entrypoint)/movies" | jq\ncurl "$(terraform output entrypoint)/movies/675"\ncurl "$(terraform output entrypoint)/movies?id=1067&id=1649"\n')),Object(n.b)("p",null,"If you do not see any response, please, give it a minute or two, it takes some time to install all the dependencies to run the API server."),Object(n.b)("h2",null,"Virtual Server Instance with IBM Cloud Schematics"),Object(n.b)("p",null,"As seen in the ",Object(n.b)("a",r({parentName:"p"},{href:"/cloud-enterprise-examples/iac/schematics"}),"IBM Cloud Schematics")," pattern a similar HCL code can be used with IBM Cloud Schematics and Terraform CLI, the only change is that Schematics cannot access your local filesystem but it can access the files located in the git repository or remote files."),Object(n.b)("p",null,"To create this project on IBM Cloud Schematics create a JSON Workspace template file like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-json",metastring:"path=workspace.tmpl.json",path:"workspace.tmpl.json"}),'{\n  "name": "iac_schematics_test",\n  "type": [\n    "terraform_v0.12"\n  ],\n  "description": "Sample workspace to test IBM Cloud Schematics. Deploys an web server on a VSI with a Hello World response",\n  "tags": [\n    "app:helloworld",\n    "env:dev"\n  ],\n  "template_repo": {\n    "url": "https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute"\n  },\n  "template_data": [{\n    "folder": ".",\n    "type": "terraform_v0.12",\n    "variablestore": [{\n        "name": "project_name",\n        "value": "iac_schematics_test",\n        "type": "string"\n      },\n      {\n        "name": "environment",\n        "value": "dev",\n        "type": "string"\n      },\n      {\n        "name": "public_key",\n        "value": "{ PUBLIC_KEY }",\n        "type": "string"\n      }\n    ]\n  }]\n}\n')),Object(n.b)("p",null,"Then execute the following commands to create the Workspace, provision the VSI and deploy the application."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"# Verify you are logged in to the right account\nibmcloud target\n\n# Get the content of the SSH public key and render it into the JSON file using the template\nPUBLIC_KEY=\"$(cat ~/.ssh/id_rsa.pub)\"\nsed \"s|{ PUBLIC_KEY }|$PUBLIC_KEY|\" workspace.tmpl.json > workspace.json\n\n# Create the Schematics Workspace\nibmcloud schematics workspace new --file workspace.json\n\n# List the Workspaces and get the Workspace ID\nibmcloud schematics workspace list\nID=$(ibmcloud schematics workspace list --json | jq -r '.workspaces[] | select(.name == \"iac_schematics_test\") | .id')\n\n# Planning and Provisioning\nact_ID=$(ibmcloud schematics plan --id $ID --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n\nact_ID=$(ibmcloud schematics apply --id $ID --force --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n")),Object(n.b)("p",null,"You may have to wait 2-3 seconds between the execution of an action (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"apply"),") and the retrieval of the logs. Also, you may have to execute the retrieval of the ",Object(n.b)("inlineCode",{parentName:"p"},"apply")," logs several times until the task is completed."),Object(n.b)("p",null,"If the Workspace JSON file is modified, for example a variable value, you can update it with the command ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud schematics workspace update"),"."),Object(n.b)("p",null,"To verify the application is running, get the output variables and use ",Object(n.b)("inlineCode",{parentName:"p"},"curl")," to get the page:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"ibmcloud schematics workspace output --id $ID --json\nIP=$(ibmcloud schematics workspace output --id $ID --json | jq -r '.[].output_values[].ip_address.value')\nADDR=$(ibmcloud schematics workspace output --id $ID --json | jq -r '.[].output_values[].entrypoint.value')\n\ncurl \"${ADDR}/movies/675\"\n")),Object(n.b)(p,{kind:"warning",mdxType:"InlineNotification"},Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Sensitive data in JSON file")),Object(n.b)("p",null,"The file ",Object(n.b)("inlineCode",{parentName:"p"},"workspace.json")," contain your SSH public key, make sure this file is not committed to the Git repository. Add the ",Object(n.b)("inlineCode",{parentName:"p"},"workspace.json")," filename to the ",Object(n.b)("inlineCode",{parentName:"p"},".gitignore")," file.")),Object(n.b)("h2",null,"Identify Input Parameters Values"),Object(n.b)("p",null,"In the Getting Started with Terraform section was explained how to get the value of the input parameters such as the instance ",Object(n.b)("inlineCode",{parentName:"p"},"image")," and ",Object(n.b)("inlineCode",{parentName:"p"},"profile")," using the IBM Cloud CLI and some Unix commands."),Object(n.b)("p",null,"It’s also possible to get these parameters using the Data Sources ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance_profile")," and ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_image"),". Modify the ",Object(n.b)("inlineCode",{parentName:"p"},"compute.tf")," file to add the following data sources."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'data "ibm_is_image" "ds_iac_app_image" {\n  name = "ibm-ubuntu-18-04-1-minimal-amd64-1"\n}\n\nresource "ibm_is_instance" "iac_app_instance" {\n  ...\n  image   = data.ibm_is_image.ds_iac_app_image.id\n  ...\n}\n')),Object(n.b)("p",null,"This change is not much but give more information to the developer reading the code if the the image name is used instead of the ID. You still need to execute the following IBM Cloud CLI commands to find the image and profile name, like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),'ibmcloud is images\nibmcloud is images | grep available | grep ubuntu-18 | grep amd64 | cut -f2 -d" "\nibmcloud is images --json | jq -r \'.[] | select(.status=="available" and .operating_system.name=="ubuntu-18-04-amd64").name\'\n\nibmcloud is instance-profiles\nibmcloud is instance-profiles | grep amd64 | sort -k4 -k5 -n | head -1 | cut -f1 -d" "\nibmcloud is instance-profiles --json | jq -r \'map(select(.vcpu_architecture.value=="amd64")) | sort_by(.memory.value)[0].name\'\n')),Object(n.b)("h2",null,"Load Balance a Cluster of VSI"),Object(n.b)("p",null,"Running a single server serve the purpose but it’s a single point of failure, if this single server fails the API is not accessible. The solution is to have a cluster of Virtual Servers, routing the traffic to the servers that are working and scaling the size up or down based on the traffic load. IBM Cloud allow us to get this features with the Load Balancer service and Terraform resources."),Object(n.b)("p",null,"You can read more about the type of Load Balancers, Listeners, Pools, LB Methods and more in the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers"}),"Load Balancer documentation")," for IBM CLoud Gen 2."),Object(n.b)("p",null,"We’ll begin the Load Balancer code by creating a ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb")," resource in the ",Object(n.b)("inlineCode",{parentName:"p"},"lb.tf")," file, like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=lb.tf",path:"lb.tf"}),'resource "ibm_is_lb" "iac_app_lb" {\n  name    = "${var.project_name}-${var.environment}-lb"\n  subnets = [ibm_is_subnet.iac_app_subnet.id]\n}\n')),Object(n.b)("p",null,"It requires an ID reference of the subnets where the LB is located. The VSI that are served by this Load Balancer should be in the same VPC and region. This specific LB name is formed by the project name and environment to not collide with other Load Balancers. Other important parameter is ",Object(n.b)("inlineCode",{parentName:"p"},"type")," to define if the LB will be ",Object(n.b)("inlineCode",{parentName:"p"},"public")," (default) or ",Object(n.b)("inlineCode",{parentName:"p"},"private"),", this would be public so the fully qualified domain name (FQDN) will be accessible from the internet and have assigned multiple public IP addresses."),Object(n.b)("p",null,"For private load balancers the access is restricted to internal clients on the same subnet, region and VPC. It also has assigned a FQDN with multiple IP addresses and only accepts traffic from ",Object(n.b)("a",r({parentName:"p"},{href:"https://tools.ietf.org/html/rfc1918"}),"RFC1918")," address spaces such as those in the blocks 10.0.0.0/8, 172.16.0.0/12 and 192.168.0.0/16."),Object(n.b)("p",null,"The Load Balancer needs a listener to listen on a given port and protocol. The FQDN and port assigned to the load balancer are exposed to the public internet. The traffic is then redirected to a pool member or VSI from the assigned default pool. The API on the VSI is listening/serving on port ",Object(n.b)("inlineCode",{parentName:"p"},"8080")," by default, unless a different port is set in the ",Object(n.b)("inlineCode",{parentName:"p"},"port")," variable. We can make the LB listener to use the same port or different, in this case, let’s use the same."),Object(n.b)("p",null,"The available protocols on the LB listener are ",Object(n.b)("strong",{parentName:"p"},"HTTP"),", ",Object(n.b)("strong",{parentName:"p"},"HTTPS")," and ",Object(n.b)("strong",{parentName:"p"},"TCP"),", this one uses the HTTP protocol. The pool or VSI protocols supported are only HTTP and TCP, in this case it’s HTTP. Let’s append the following code to ",Object(n.b)("inlineCode",{parentName:"p"},"lb.tf")," to define the LB listener:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=lb.tf",path:"lb.tf"}),'resource "ibm_is_lb_listener" "iac_app_lb_listener" {\n  lb       = ibm_is_lb.iac_app_lb.id\n  port     = var.port\n  protocol = "http"\n  default_pool = ibm_is_lb_pool.iac_app_lb_pool.id\n}\n')),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb")," ID, ",Object(n.b)("inlineCode",{parentName:"p"},"port")," and ",Object(n.b)("inlineCode",{parentName:"p"},"protocol")," are required parameters. Other optional parameters are ",Object(n.b)("inlineCode",{parentName:"p"},"default_pool"),", ",Object(n.b)("inlineCode",{parentName:"p"},"certificate_instance")," and ",Object(n.b)("inlineCode",{parentName:"p"},"connection_limit"),", the last two are not needed for this project."),Object(n.b)("p",null,"On the other side of the Load Balancer are the VSI or backend application which are identified as a Pool Member (",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool_member"),") that is, obviously, a member of the defined pool (",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool"),"). Let’s begin modifying the VSI ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance.iac_app_instance")," resource in the ",Object(n.b)("inlineCode",{parentName:"p"},"compute.tf")," file to have multiple instances adding the Terraform ",Object(n.b)("inlineCode",{parentName:"p"},"count")," parameter and modifying the ",Object(n.b)("inlineCode",{parentName:"p"},"name")," parameter to include the number of that instance. Like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'...\nresource "ibm_is_instance" "iac_app_instance" {\n  name    = "${var.project_name}-${var.environment}-instance-${format("%02s", count.index)}"\n  ...\n  count   = var.max_size\n  ...\n}\n')),Object(n.b)("p",null,"The new variable ",Object(n.b)("inlineCode",{parentName:"p"},"max_size")," defines how many VSI, therefore how many pool members too, will be created. This variable is defined like this in the ",Object(n.b)("inlineCode",{parentName:"p"},"variables.tf")," file:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl"}),'variable "max_size" {\n  default = 3\n}\n')),Object(n.b)("p",null,"All is set to create the Pool and the Pool Members, add the following code to the ",Object(n.b)("inlineCode",{parentName:"p"},"lb.tf")," file:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=lb.tf",path:"lb.tf"}),'resource "ibm_is_lb_pool" "iac_app_lb_pool" {\n  name                = "${var.project_name}-${var.environment}-lb-pool"\n  lb                  = ibm_is_lb.iac_app_lb.id\n  algorithm           = "round_robin"\n  protocol            = "http"\n  health_delay        = 5\n  health_retries      = 2\n  health_timeout      = 2\n  health_type         = "http"\n  health_monitor_url  = "/"\n  health_monitor_port = var.port\n}\n\nresource "ibm_is_lb_pool_member" "iac_app_lb_pool_mem" {\n  count          = var.max_size\n  lb             = ibm_is_lb.iac_app_lb.id\n  pool           = ibm_is_lb_pool.iac_app_lb_pool.id\n  port           = var.port\n  target_address = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.primary_ipv4_address\n  weight         = (100 - count.index)\n}\n')),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool.iac_app_lb_pool")," resource requires the following input attributes:"),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"name")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"name of the pool. In this case it has the name of the project and environment to not collide with other pools")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"lb")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"ID of the load balancer is linked to")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"algorithm")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"load balancing algorithm. Supported values are ",Object(n.b)("inlineCode",{parentName:"td"},"round_robin"),", ",Object(n.b)("inlineCode",{parentName:"td"},"weighted_round_robin"),", or ",Object(n.b)("inlineCode",{parentName:"td"},"least_connections"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"protocol")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"pool protocol. Supported values are ",Object(n.b)("inlineCode",{parentName:"td"},"http"),", and ",Object(n.b)("inlineCode",{parentName:"td"},"tcp"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"health_delay")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"health check interval in seconds. Interval must be greater than timeout value")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"health_retries")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"health check max retries")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"health_timeout")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"health check timeout in seconds")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"health_type")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"pool protocol. Supported values are ",Object(n.b)("inlineCode",{parentName:"td"},"http"),", and ",Object(n.b)("inlineCode",{parentName:"td"},"tcp"))))),Object(n.b)("p",null,"Other input and output parameters are described in the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool")," ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool"}),"resource documentation"),". The 3 different load balancing methods to set in the ",Object(n.b)("inlineCode",{parentName:"p"},"algorithm")," input parameter are described in the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers#load-balancing-methods"}),"Load Balancers documentation"),"."),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool_member.iac_app_lb_pool_mem")," is actually a list of resources because it also has the Terraform ",Object(n.b)("inlineCode",{parentName:"p"},"count")," attribute, just like the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance")," resource and this is because we need one pool member per VSI."),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool_member")," uses the ",Object(n.b)("inlineCode",{parentName:"p"},"target_address")," attribute to link the pool member to the VSI using its IP address. Here we use the ",Object(n.b)("inlineCode",{parentName:"p"},"count.index")," to reference to the VSI with the same index, so the pool member 0 is linked to the VSI 0, and so on. As we did to link the Floating IP to the IP address of the VSI, this IP address is identified by the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance.iac_app_instance")," resource output parameter ",Object(n.b)("inlineCode",{parentName:"p"},"primary_network_interface.0.primary_ipv4_address"),"."),Object(n.b)("p",null,"The required input attributes for ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool_member")," are:"),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"pool")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"ID of the load balancer pool")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"lb")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"load balancer ID")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"port")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"port number of the application running in the server member, in this case is in the variable ",Object(n.b)("inlineCode",{parentName:"td"},"port"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"target_address")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"IP address of the pool member or VSI")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"weight")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"weight of the server member. This parameter is optional and it takes effect only when the load balancing algorithm of its belonging pool is ",Object(n.b)("inlineCode",{parentName:"td"},"weighted_round_robin"))))),Object(n.b)("p",null,"More information about this resource can be found at the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool_member")," ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool-member"}),"resource documentation"),"."),Object(n.b)("p",null,"The load balancer adjusts its capacity automatically according to the load. When this adjustment occurs, you may see a change in the number of IP addresses associated with the load balancer’s DNS name. To know the load balancer’s DNS name and the associated IP addresses we use the following output variables to be included in the file ",Object(n.b)("inlineCode",{parentName:"p"},"output.tf")),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "lb_ip_address" {\n  value = ibm_is_lb.iac_app_lb.public_ips\n}\n\noutput "entrypoint" {\n  value = "http://${ibm_is_lb.iac_app_lb.hostname}:${var.port}"\n}\n')),Object(n.b)("p",null,"The new value of ",Object(n.b)("inlineCode",{parentName:"p"},"entrypoint")," has now the hostname or FQDN of the load balancer."),Object(n.b)("p",null,"Having a load balancer there is no need to have floating IP assigned to every VSI so you can remove them but in case you want to keep them you need one per VSI, so you have to do something similar done with the pool members modifying the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_floating_ip.iac_app_floating_ip")," and the ",Object(n.b)("inlineCode",{parentName:"p"},"ip_address")," output variable that uses this resource, like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"network.tf","network.tf":!0}),'resource "ibm_is_floating_ip" "iac_app_floating_ip" {\n  name   = "${var.project_name}-${var.environment}-ip"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n  count  = var.max_size\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl"}),'output "ip_address" {\n  value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n}\n')),Object(n.b)("p",null,"Here we use ",Object(n.b)("inlineCode",{parentName:"p"},"[*]")," to let Terraform knows that we need the ",Object(n.b)("inlineCode",{parentName:"p"},"address")," of all the ",Object(n.b)("inlineCode",{parentName:"p"},"iac_app_floating_ip")," resources. This variable would be a list just like ",Object(n.b)("inlineCode",{parentName:"p"},"lb_ip_address"),"."),Object(n.b)("p",null,"But, again, there is no need to have Floating IP’s assigned per VSI, the Load Balancer provide the FQDN and an IP per pool member or VSI. Remove the Floating IP’s once you verify the Load Balancer works."),Object(n.b)("h2",null,"Health Checks"),Object(n.b)("p",null,"Health check definitions are mandatory for back-end pools. Not having health checks cause the pool identify the pool members as unhealthy therefore not forwarding new connections to them."),Object(n.b)("p",null,"The health check is configured in the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool")," resource using the ",Object(n.b)("inlineCode",{parentName:"p"},"health_*")," attributes. Read the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers#health-checks"}),"Health Check documentation")," and the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool")," ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool-input"}),"input attributes")," that can be used for health check."),Object(n.b)("p",null,"Health checks can be configured on back-end ports or on a separate health check port, based on the application. For this application, the API is being served with HTTP protocol, so we ser the input parameter ",Object(n.b)("inlineCode",{parentName:"p"},"health_type")," of ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_lb_pool")," to ",Object(n.b)("inlineCode",{parentName:"p"},"http"),". The port to monitor is the same port where the API is exposed so the ",Object(n.b)("inlineCode",{parentName:"p"},"health_monitor_port")," parameter is set to the value we have on the variable ",Object(n.b)("inlineCode",{parentName:"p"},"port")," but if not set, the port used in the pool member will be used. Finally, the URL to monitor is the path to be used for the health check, the default value is ",Object(n.b)("inlineCode",{parentName:"p"},"/")," but we may have something like ",Object(n.b)("inlineCode",{parentName:"p"},"/health"),". If the HTTP response code is ",Object(n.b)("inlineCode",{parentName:"p"},"200")," then the pool member is considered healthy."),Object(n.b)("h2",null,"IBM Cloud Object Storage"),Object(n.b)("p",null,"There are different type of storage objects in cloud environment and you use different types for different situations Review the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/cloud-object-storage?topic=cloud-object-storage-about-cloud-object-storage"}),"IBM Cloud Object Storage")," resources to know how to use them and which storage object to use."),Object(n.b)("p",null,"We use the resource ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_cos_bucket")," to create an Object Storage bucket to store data but it requires a ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_resource_instance")," to be created in advance. There are 5 different storage classes to choose:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Smart Tier")," (",Object(n.b)("inlineCode",{parentName:"li"},"smart"),") can be used for any workload, especially dynamic workloads where access patterns are unknown or difficult to predict. Smart Tier provides a simplified pricing structure and automatic cost optimization by classifying the data into “hot”, “cool”, and “cold” tiers based on monthly usage patterns. All data in the bucket is then billed at the lowest applicable rate. There are no threshold object sizes or storage periods, and there are no retrieval fees."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Standard")," (",Object(n.b)("inlineCode",{parentName:"li"},"standard"),") is used for active workloads, with no charge for data retrieved (other than the cost of the operational request itself)."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Vault")," (",Object(n.b)("inlineCode",{parentName:"li"},"vault"),") is used for cool workloads where data is accessed less than once a month - an extra retrieval charge ($/GB) is applied each time data is read. The service includes a minimum threshold for object size and storage period consistent with the intended use of this service for cooler, less-active data."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Cold Vault")," (",Object(n.b)("inlineCode",{parentName:"li"},"cold"),") is used for cold workloads where data is accessed every 90 days or less - a larger extra retrieval charge ($/GB) is applied each time data is read. The service includes a longer minimum threshold for object size and storage period consistent with the intended use of this service for cold, inactive data."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Flex")," (",Object(n.b)("inlineCode",{parentName:"li"},"flex"),") is being replaced by Smart Tier for dynamic workloads.")),Object(n.b)("p",null,"In our demo application we use this bucket to store images with the movie covers and they are actively used, so the object class to choose is ",Object(n.b)("inlineCode",{parentName:"p"},"standard"),". For more information about storage classes, see ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage?topic=cloud-object-storage-classes"}),"Use storage classes"),"."),Object(n.b)("p",null,"Lets create the storage with the following code:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl"}),'resource "ibm_resource_instance" "iac_app_cos_instance" {\n  name     = "${var.project_name}-${var.environment}-cos-instance"\n  service  = "cloud-object-storage"\n  plan     = "standard"\n  location = "global"\n}\n\nresource "ibm_cos_bucket" "iac_app_cos_bucket" {\n  bucket_name          = "${var.project_name}-${var.environment}-bucket"\n  resource_instance_id = ibm_resource_instance.iac_app_cos_instance.id\n  region_location      = "us-south"\n  storage_class        = "smart"\n}\n')),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_cos_bucket")," resource requires the following input parameters:"),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"bucket_name")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"to name the bucket")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"resource_instance_id")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"ID of the ",Object(n.b)("inlineCode",{parentName:"td"},"ibm_resource_instance")," service instance for which you want to create a bucket")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"storage_class")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"The storage class that you want to use for the bucket")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"region_location")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"location of a regional bucket. Do not use this parameter with other ",Object(n.b)("inlineCode",{parentName:"td"},"*_location")," parameter")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"single_site_location")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"location for a single site bucket. Do not use this parameter with other ",Object(n.b)("inlineCode",{parentName:"td"},"*_location")," parameter")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"cross_region_location")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"location for a cross-regional bucket. Do not use this parameter with other ",Object(n.b)("inlineCode",{parentName:"td"},"*_location")," parameter")))),Object(n.b)("p",null,"For more information about other optional input parameters and the output parameters read the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_cos_bucket")," ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-resources#cos-bucket"}),"IBM Cloud Object Storage resource documentation"),"."),Object(n.b)("p",null,"The upload of data to the bucket is not done with Terraform nor Schematics, but can be done using code in different languages such as ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-go"}),"Go"),", ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-python"}),"Python"),", ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-node"}),"Node")," or ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-java"}),"Java")," using the SDK, or using the Linux commands (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"curl"),") with the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/services/cloud-object-storage/api-reference?topic=cloud-object-storage-compatibility-api"}),"Cloud Storage API"),", or using any file transfer tools such as ",Object(n.b)("a",r({parentName:"p"},{href:"https://cyberduck.io/"}),"Cyberduck")," or ",Object(n.b)("a",r({parentName:"p"},{href:"https://panic.com/transmit/"}),"Transmit")," and command-line utilities like ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/s3tools/s3cmd"}),"s3cmd")," or ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/minio/mc"}),"Minio Client"),", and many others."),Object(n.b)("h2",null,"Block Storage for Volumes"),Object(n.b)("p",null,"Besides IBM Cloud Storage Object we can attach volumes to the instance to store data or files to access though file system interface, file system access semantics (such as strong consistency and file locking), and concurrently-accessible storage."),Object(n.b)("p",null,"Block Storage are block-level volumes that can be attached to VSI as either a boot volume or as a data volume. The boot volumes are attached by default. The ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-block-storage-about"}),"Block Storage for VPC")," documentation can give you more information."),Object(n.b)("p",null,"To create a data volume per instance we use the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_volume")," resource with a code like this one."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=storage.tf",path:"storage.tf"}),'resource "ibm_is_volume" "iac_app_volume" {\n  count    = var.max_size\n  name     = "${var.project_name}-${var.environment}-volume-${format("%02s", count.index)}"\n  profile  = "10iops-tier"\n  zone     = "us-south-1"\n  capacity = 100\n}\n')),Object(n.b)("p",null,"The main input parameters for ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_volume")," are described in the following table."),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Input parameter"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"Description"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"name")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"to name the volume")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"profile")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"volume profile")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"zone")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"location of the volume")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"capacity")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"capacity of the volume in gigabytes. the default value is ",Object(n.b)("inlineCode",{parentName:"td"},"100"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),Object(n.b)("inlineCode",{parentName:"td"},"iops")),Object(n.b)("td",r({parentName:"tr"},{align:null}),"total input/ output operations per second (IOPS) for your storage. This value is required for custom storage profiles only")))),Object(n.b)("p",null,"The ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-capacity-performance"}),"Block Storage Capacity and Performance")," documentation give you information about the available capacities and the performance (IOPS and Throughput) per capacity."),Object(n.b)("p",null,"To get a list of volume profiles with the CLI use the following command, also the ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloud.ibm.com/docs/vpc?topic=vpc-block-storage-profiles"}),"Profiles")," documentation list the available profiles and explain how to define a custom one."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"ibmcloud is volume-profiles\n")),Object(n.b)("p",null,"Having the Block Storage is not enough, you need to assign the volume to the VSI using the ",Object(n.b)("inlineCode",{parentName:"p"},"volumes")," list attribute of the ",Object(n.b)("inlineCode",{parentName:"p"},"ibm_is_instance")," resource, like so:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'resource "ibm_is_instance" "iac_app_instance" {\n  ...\n  volumes = [ibm_is_volume.iac_app_volume[count.index].id]\n  ...\n}\n')),Object(n.b)("p",null,"Notice the use of ",Object(n.b)("inlineCode",{parentName:"p"},"count.index")," to get one volume id. This way we ensure the volume ",Object(n.b)("inlineCode",{parentName:"p"},"0")," is assigned to the instance ",Object(n.b)("inlineCode",{parentName:"p"},"0")," and so on. The volume is mounted in the root partition, so there is no need to modify the user data to change the location of the JSON DB file."),Object(n.b)("p",null,"Verify and apply all the changes executing the commands:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"terraform plan\nterraform apply\n")),Object(n.b)("p",null,"To test the API works execute the following command to get the Load Balancer FQDN or entrypoint to be used by the ",Object(n.b)("inlineCode",{parentName:"p"},"curl")," command:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"curl $(terraform output entrypoint)/movies/675\n")),Object(n.b)("h2",null,"Final Terraform code"),Object(n.b)("p",null,"You can download the code from the GitHub repository ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute"}),"07-compute")," where the main files are:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=compute.tf",path:"compute.tf"}),'resource "ibm_is_ssh_key" "iac_app_key" {\n  name       = "${var.project_name}-${var.environment}-key"\n  public_key = var.public_key\n}\n\ndata "local_file" "db" {\n  filename = "${path.module}/db.min.json"\n}\n\ndata "ibm_is_image" "ds_iac_app_image" {\n  name = "ibm-ubuntu-18-04-1-minimal-amd64-1"\n}\n\nresource "ibm_is_instance" "iac_app_instance" {\n  count   = var.max_size\n  name    = "${var.project_name}-${var.environment}-instance-${format("%02s", count.index)}"\n  image   = data.ibm_is_image.ds_iac_app_image.id\n  profile = "cx2-2x4"\n\n  primary_network_interface {\n    name            = "eth1"\n    subnet          = ibm_is_subnet.iac_app_subnet.id\n    security_groups = [ibm_is_security_group.iac_app_security_group.id]\n  }\n\n  vpc     = ibm_is_vpc.iac_app_vpc.id\n  zone    = "us-south-1"\n  keys    = [ibm_is_ssh_key.iac_app_key.id]\n  volumes = [ibm_is_volume.iac_app_volume[count.index].id]\n\n  user_data = <<-EOUD\n            #!/bin/bash\n            echo \'${data.local_file.db.content_base64}\' | base64 --decode > /var/lib/db.min.json\n\n            echo \'* libraries/restart-without-asking boolean true\' | debconf-set-selections\n\n            apt update\n            curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -\n            apt-get install -y nodejs\n            npm install -g json-server\n\n            json-server --watch /var/lib/db.min.json --port ${var.port} --host 0.0.0.0 &\n            EOUD\n\n  tags = ["iac-${var.project_name}-${var.environment}"]\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=lb.tf",path:"lb.tf"}),'resource "ibm_is_lb" "iac_app_lb" {\n  name    = "${var.project_name}-${var.environment}-lb"\n  subnets = [ibm_is_subnet.iac_app_subnet.id]\n}\n\nresource "ibm_is_lb_listener" "iac_app_lb_listener" {\n  lb       = ibm_is_lb.iac_app_lb.id\n  port     = var.port\n  protocol = "http"\n  default_pool = ibm_is_lb_pool.iac_app_lb_pool.id\n}\n\nresource "ibm_is_lb_pool" "iac_app_lb_pool" {\n  name                = "${var.project_name}-${var.environment}-lb-pool"\n  lb                  = ibm_is_lb.iac_app_lb.id\n  algorithm           = "round_robin"\n  protocol            = "http"\n  health_delay        = 5\n  health_retries      = 2\n  health_timeout      = 2\n  health_type         = "http"\n  health_monitor_url  = "/"\n  health_monitor_port = var.port\n}\n\nresource "ibm_is_lb_pool_member" "iac_app_lb_pool_mem" {\n  count          = var.max_size\n  lb             = ibm_is_lb.iac_app_lb.id\n  pool           = ibm_is_lb_pool.iac_app_lb_pool.id\n  port           = var.port\n  target_address = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.primary_ipv4_address\n  weight         = (100 - count.index)\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=storage",path:"storage"}),'resource "ibm_resource_instance" "iac_app_cos_instance" {\n  name     = "${var.project_name}-${var.environment}-cos-instance"\n  service  = "cloud-object-storage"\n  plan     = "standard"\n  location = "global"\n}\n\nresource "ibm_cos_bucket" "iac_app_cos_bucket" {\n  bucket_name          = "${var.project_name}-${var.environment}-bucket"\n  resource_instance_id = ibm_resource_instance.iac_app_cos_instance.id\n  region_location      = "us-south"\n  storage_class        = "smart"\n}\n\nresource "ibm_is_volume" "iac_app_volume" {\n  count    = var.max_size\n  name     = "${var.project_name}-${var.environment}-volume-${format("%02s", count.index)}"\n  profile  = "10iops-tier"\n  zone     = "us-south-1"\n  capacity = 100\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "lb_ip_address" {\n  value = ibm_is_lb.iac_app_lb.public_ips\n}\n\noutput "entrypoint" {\n  value = "http://${ibm_is_lb.iac_app_lb.hostname}:${var.port}"\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "project_name" {}\nvariable "environment" {}\n\nvariable "public_key" {}\n\nvariable "port" {\n  default = 8080\n}\nvariable "max_size" {\n  default = 3\n}\n')),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-json",metastring:"path=workspace.tmpl.json",path:"workspace.tmpl.json"}),'{\n  "name": "iac_schematics_test",\n  "type": [\n    "terraform_v0.12"\n  ],\n  "description": "Sample workspace to test IBM Cloud Schematics. Deploys an web server on a VSI with a Hello World response",\n  "tags": [\n    "app:helloworld",\n    "env:dev"\n  ],\n  "template_repo": {\n    "url": "https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute"\n  },\n  "template_data": [{\n    "folder": ".",\n    "type": "terraform_v0.12",\n    "variablestore": [{\n        "name": "project_name",\n        "value": "iac_schematics_test",\n        "type": "string"\n      },\n      {\n        "name": "environment",\n        "value": "dev",\n        "type": "string"\n      },\n      {\n        "name": "public_key",\n        "value": "{ PUBLIC_KEY }",\n        "type": "string"\n      }\n    ]\n  }]\n}\n')),Object(n.b)("h2",null,"Clean up"),Object(n.b)("p",null,"In this section you have created the same infrastructure using Terraform CLI and IBM Cloud Schematics."),Object(n.b)("p",null,"To destroy everything created with Terraform CLI, execute:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"terraform destroy\n")),Object(n.b)("p",null,"To delete everything you’ve created with IBM Cloud Schematics, execute the following command to destroy the infrastructure:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"ID=$(ibmcloud schematics workspace list --json | jq -r '.workspaces[] | select(.name == \"iac_schematics_test\") | .id')\nibmcloud schematics destroy --id $ID\n\n# Or:\nact_ID=$(ibmcloud schematics destroy --id $ID --force --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n")),Object(n.b)("p",null,"Finally, to delete the Workspace, execute these commands:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{className:"language-bash"}),"ibmcloud schematics workspace delete --id $ID --force\nibmcloud schematics workspace list\n")),Object(n.b)("h2",null,"Compute Resources & Data Source Reference"),Object(n.b)("p",null,"The following Terraform Resources or Data Source are used to handle compute resources. Most of them are covered in this section, for those that were not, the links include a description, examples, the input and output parameters. There are also other useful links related to the resources that you may find useful."),Object(n.b)(s,{small:!0,mdxType:"AnchorLinks"},Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_ssh_key"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_instance"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb_listener"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb_listener_policy"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb_listener_policy_rule"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb_pool"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_lb_pool_member"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_volume"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_images"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_instance_profile"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_instance_profiles"),Object(n.b)(b,{mdxType:"AnchorLink"},"ibm_is_region")),Object(n.b)("h3",null,"ibm_is_ssh_key"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#ssh-key"}),"Resource documentation")," with examples, input and output parameters."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-ssh-key"}),"Data Source documentation")," retrieves non sensitive information from the given ssh key name"),Object(n.b)("li",{parentName:"ul"},"Terraform ",Object(n.b)("a",r({parentName:"li"},{href:"https://www.terraform.io/docs/configuration/variables.html"}),"input variables")," are required to load the content of the SSH public key, using filesystem functions such as ",Object(n.b)("a",r({parentName:"li"},{href:"https://www.terraform.io/docs/configuration/functions/file.html"}),"file")," and Terraform data source like ",Object(n.b)("a",r({parentName:"li"},{href:"https://www.terraform.io/docs/providers/local/d/file.html"}),"local_file"),"."),Object(n.b)("li",{parentName:"ul"},"Command ",Object(n.b)("a",r({parentName:"li"},{href:"https://www.ssh.com/ssh/keygen/"}),Object(n.b)("inlineCode",{parentName:"a"},"ssh-keygen"))," is required to generate the SSH key pair files.")),Object(n.b)("h3",null,"ibm_is_instance"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-instance"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb_listener"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb_listener_policy"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener-policy)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb_listener_policy_rule"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener-policy-rule)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb_pool"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-pool)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_lb_pool_member"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-pool-member)"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_is_volume"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#volume"}),"Resource documentation")," with examples, input and output parameters.")),Object(n.b)("h3",null,"ibm_cos_bucket"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-resources#cos-bucket"}),"Resource documentation")," with examples, input and output parameters."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-data-sources#cos-bucket"}),"Data Source documentation")," retrieves information about the given bucket")),Object(n.b)("h3",null,"ibm_is_images"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-image"}),"Data Source documentation")," retrieves all the compute images")),Object(n.b)("h3",null,"ibm_is_instance_profile"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-instance-profile)"}),"Data Source documentation")," retrieves an instance profile from a given name.")),Object(n.b)("h3",null,"ibm_is_instance_profiles"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-instance-profiles)"}),"Data Source documentation")," retrieves all the instance profiles")),Object(n.b)("h3",null,"ibm_is_region"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-region)"}),"Data Source documentation")," retrieves all the regions.")))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-iac-resources-compute-index-mdx-2d11e709cee5f17b34c5.js.map