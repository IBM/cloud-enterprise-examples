{"componentChunkName":"component---src-pages-logging-configure-virtual-server-index-mdx","path":"/logging/configure-virtual-server/","result":{"pageContext":{"frontmatter":{"title":"Configuring Logging for VSI","description":"VSI, Container and Platform Logging","keywords":"ibm cloud, configuration, policy, procedures"},"relativePagePath":"/logging/configure-virtual-server/index.mdx","titleType":"page","MdxNode":{"id":"1295e6f8-2ca6-5dff-bb38-e94d15d619d3","children":[],"parent":"e4f09cca-039a-5332-bb7d-505cf4d313b5","internal":{"content":"---\ntitle: Configuring Logging for VSI\ndescription: VSI, Container and Platform Logging\nkeywords: 'ibm cloud, configuration, policy, procedures'\n---\n\n## Provision IBM Log Analysis with LogDNA for Virtual Server Instance(VSI)\n\nIn this section, we will see how to send application logs on VSIs to LogDNA for analysis. In order to demonstrate the feature, we will do the following: \n- Create an instance VSI with Ubuntu image on VPC\n- Deploy a WAS liberty server and deploy a sample J2EE application\n- Install and configure LogDNA agent\n- Visualize the logs on LogDNA Dashboard on IBM Cloud\n\nWe will also cover some aspect of auto-scaling and how you can setup for proper filtering of logs from each of the instance. \n\n<AnchorLinks small>\n  <AnchorLink>Create VSI Instance</AnchorLink>\n  <AnchorLink>Deploy an application</AnchorLink>\n  <AnchorLink>Install and Configure LogDNA</AnchorLink>\n  <AnchorLink>Visualize Logs</AnchorLink>\n</AnchorLinks>\n\n\n## Create VSI Instance\n\nClick [here](https://cloud.ibm.com/vpc-ext/provision/vpc) to create an instance of Virtual Private Cloud.\nPlease configure as shown below, and click `Create Virtual Private Cloud`\n\n![Create VPC](./images/create_vpc_logdna.png \"Create VPC for LogDNA\")\n\nClick [here](https://cloud.ibm.com/vpc-ext/provision/vs) to create an instance of Virtual Server.\nPlease configure as shown below, and click `Create Virtual Server Instance`.\n\n  ##### Note: \n  Please refer the [link](https://cloud.ibm.com/docs/vpc?topic=vpc-ssh-keys) to create SSH keys.\n\n\n![Create VSI](./images/create_vsi_vpc_logdna.png \"Create VSI for LogDNA\")\n\nReserve IP:\n\nClick on `Reserve IP` to bind to a Floating IP.\n![Reserve IP](./images/reserve_ip_logdna.png \"Reserve IP for LogDNA\")\n\n## Deploy an application\n\nLogin to VSI using SSH and deploy the application as shown below.\n\n```\nssh -i [path to private key file] root@[Floating IP address]\nwget https://raw.githubusercontent.com/IBM/cloud-enterprise-examples/master/artifacts/autoscale/scripts/install-script\nchmod +x install-script\n./install-script\n```\n\n## Install and configure LogDNA\n\nOn the LogDNA Dashboard, click on `Edit log sources`.\n![Log sources](./images/edit_log_sources.png \"Edit log sources\")\n\nOn the `Add agents to desired log sources` page, select the `Linux Ubuntu/Debian` tab.\nRun the commands displayed with the below changes.\n- For \"/var/log is monitored/added by default (recursively), optionally add more dirs with\", run the below command\n```\nsudo logdna-agent -d /root/wlp/usr/servers/defaultServer/logs/\n```\n- For \"You can configure the agent to tag your hosts with\", run the below command:\n```\nsudo logdna-agent -t $HOSTNAME\n```\n<InlineNotification>\n  \n###### Tagging of logs\n\nIn the above command the parameter after -t is the tag you want to provide for the log created by this instance. If you have only 1 instance of this Virtual Server, a static tag can be specified, and then you can filter the log based on that tag.  But when you make use of auto-scaling functionality, you may end up with more than 1 instance of the server, and having a unique tag for each instance helps you filter logs for a specific instance.  $HOSTNAME is one such argument which will be unique for each instance. The logs of VSI instances that have been removed during a scale down can also be analyzed.\n\n</InlineNotification>\n\n\nThe script below needs to be included in the \"User Data\" section of the \"Instance Template\" for auto scale configuration.  This will ensure the new VSI instance is attached to the same logDNA instance.\n\n\n![Log commands](./images/logdna_agent_commands.png \"LogDNA agent commands\")\n\n## Visualize Logs\n\nClick on `View LogDNA` after all the commands run fine.\n\nThe logs can then be viewed on the LogDNA Dashboard:\n![Dashboard](./images/dashboard_logs.png \"Dashboard\")\n","type":"Mdx","contentDigest":"e7972a8630199422c5bc208343e40860","counter":579,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Configuring Logging for VSI","description":"VSI, Container and Platform Logging","keywords":"ibm cloud, configuration, policy, procedures"},"exports":{},"rawBody":"---\ntitle: Configuring Logging for VSI\ndescription: VSI, Container and Platform Logging\nkeywords: 'ibm cloud, configuration, policy, procedures'\n---\n\n## Provision IBM Log Analysis with LogDNA for Virtual Server Instance(VSI)\n\nIn this section, we will see how to send application logs on VSIs to LogDNA for analysis. In order to demonstrate the feature, we will do the following: \n- Create an instance VSI with Ubuntu image on VPC\n- Deploy a WAS liberty server and deploy a sample J2EE application\n- Install and configure LogDNA agent\n- Visualize the logs on LogDNA Dashboard on IBM Cloud\n\nWe will also cover some aspect of auto-scaling and how you can setup for proper filtering of logs from each of the instance. \n\n<AnchorLinks small>\n  <AnchorLink>Create VSI Instance</AnchorLink>\n  <AnchorLink>Deploy an application</AnchorLink>\n  <AnchorLink>Install and Configure LogDNA</AnchorLink>\n  <AnchorLink>Visualize Logs</AnchorLink>\n</AnchorLinks>\n\n\n## Create VSI Instance\n\nClick [here](https://cloud.ibm.com/vpc-ext/provision/vpc) to create an instance of Virtual Private Cloud.\nPlease configure as shown below, and click `Create Virtual Private Cloud`\n\n![Create VPC](./images/create_vpc_logdna.png \"Create VPC for LogDNA\")\n\nClick [here](https://cloud.ibm.com/vpc-ext/provision/vs) to create an instance of Virtual Server.\nPlease configure as shown below, and click `Create Virtual Server Instance`.\n\n  ##### Note: \n  Please refer the [link](https://cloud.ibm.com/docs/vpc?topic=vpc-ssh-keys) to create SSH keys.\n\n\n![Create VSI](./images/create_vsi_vpc_logdna.png \"Create VSI for LogDNA\")\n\nReserve IP:\n\nClick on `Reserve IP` to bind to a Floating IP.\n![Reserve IP](./images/reserve_ip_logdna.png \"Reserve IP for LogDNA\")\n\n## Deploy an application\n\nLogin to VSI using SSH and deploy the application as shown below.\n\n```\nssh -i [path to private key file] root@[Floating IP address]\nwget https://raw.githubusercontent.com/IBM/cloud-enterprise-examples/master/artifacts/autoscale/scripts/install-script\nchmod +x install-script\n./install-script\n```\n\n## Install and configure LogDNA\n\nOn the LogDNA Dashboard, click on `Edit log sources`.\n![Log sources](./images/edit_log_sources.png \"Edit log sources\")\n\nOn the `Add agents to desired log sources` page, select the `Linux Ubuntu/Debian` tab.\nRun the commands displayed with the below changes.\n- For \"/var/log is monitored/added by default (recursively), optionally add more dirs with\", run the below command\n```\nsudo logdna-agent -d /root/wlp/usr/servers/defaultServer/logs/\n```\n- For \"You can configure the agent to tag your hosts with\", run the below command:\n```\nsudo logdna-agent -t $HOSTNAME\n```\n<InlineNotification>\n  \n###### Tagging of logs\n\nIn the above command the parameter after -t is the tag you want to provide for the log created by this instance. If you have only 1 instance of this Virtual Server, a static tag can be specified, and then you can filter the log based on that tag.  But when you make use of auto-scaling functionality, you may end up with more than 1 instance of the server, and having a unique tag for each instance helps you filter logs for a specific instance.  $HOSTNAME is one such argument which will be unique for each instance. The logs of VSI instances that have been removed during a scale down can also be analyzed.\n\n</InlineNotification>\n\n\nThe script below needs to be included in the \"User Data\" section of the \"Instance Template\" for auto scale configuration.  This will ensure the new VSI instance is attached to the same logDNA instance.\n\n\n![Log commands](./images/logdna_agent_commands.png \"LogDNA agent commands\")\n\n## Visualize Logs\n\nClick on `View LogDNA` after all the commands run fine.\n\nThe logs can then be viewed on the LogDNA Dashboard:\n![Dashboard](./images/dashboard_logs.png \"Dashboard\")\n","fileAbsolutePath":"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/src/pages/logging/configure-virtual-server/index.mdx"}}}}