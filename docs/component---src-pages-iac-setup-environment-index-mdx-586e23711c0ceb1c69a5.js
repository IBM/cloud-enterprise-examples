(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{"Epf/":function(e,t,o){"use strict";o.r(t),o.d(t,"_frontmatter",(function(){return l})),o.d(t,"default",(function(){return f}));o("91GP"),o("rGqo"),o("yt8O"),o("Btvt"),o("RW0V"),o("q1tI");var n=o("7ljp"),r=o("013z");o("qKvR");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}var l={},i=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",t)}},c=i("PageDescription"),s=i("AnchorLinks"),b=i("AnchorLink"),u=i("InlineNotification"),p=i("Tabs"),m=i("Tab"),d={_frontmatter:l},h=r.a;function f(e){var t=e.components,o=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,["components"]);return Object(n.b)(h,a({},d,o,{components:t,mdxType:"MDXLayout"}),Object(n.b)(c,{mdxType:"PageDescription"},Object(n.b)("p",null,"Instructions to setup your environment to use Terraform for IBM Cloud")),Object(n.b)("p",null,"The first step before you start working with Infrastructure as Code or Terraform is to setup your environment. We will install terraform, then set it up for IBM Cloud and make sure it works with IBM Cloud."),Object(n.b)(s,{small:!0,mdxType:"AnchorLinks"},Object(n.b)(b,{mdxType:"AnchorLink"},"Install IBM Cloud CLI"),Object(n.b)(b,{mdxType:"AnchorLink"},"Install Terraform"),Object(n.b)(b,{mdxType:"AnchorLink"},"Configure access to IBM Cloud"),Object(n.b)(b,{mdxType:"AnchorLink"},"Testing access to IBM Cloud")),Object(n.b)(u,{mdxType:"InlineNotification"},Object(n.b)("h6",null,"Requirements"),Object(n.b)("p",null,"To be able to execute and complete the instructions in this page, make sure you have an ",Object(n.b)("strong",{parentName:"p"},"IBM Cloud account"),": if you don’t have one yet, you can ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/overview?topic=overview-quickstart_lite#prereqs-lite"}),"create a Lite account")," for free.")),Object(n.b)("h2",null,"Install IBM Cloud CLI"),Object(n.b)("p",null,"If you already have installed and setup the IBM Cloud CLI you may skip this section and go straight to install infrastructure ",Object(n.b)("a",a({parentName:"p"},{href:"#ibm-cloud-cli-plugins"}),"IBM Cloud CLI Plugins"),"."),Object(n.b)("p",null,"In this pattern you will see ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud")," CLI in most of the examples and instructions. This table provides simplified instructions to install ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud")," CLI on different platforms, for more details, see the ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/cli?topic=cloud-cli-install-ibmcloud-cli"}),"cli installation instructions"),"."),Object(n.b)(p,{mdxType:"Tabs"},Object(n.b)(m,{label:"Linux",mdxType:"Tab"},Object(n.b)("p",null,"The following one-liner script works on Linux to install the latest version of ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud"),":"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"curl -fsSL https://clis.cloud.ibm.com/install/linux | sh\n")),Object(n.b)("p",null,"Or, you can download the latest version of the Installer for Linux from the ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/IBM-Cloud/ibm-cloud-cli-release/releases/"}),"IBM Cloud CLI Releases")," page, extract the package and run the ",Object(n.b)("inlineCode",{parentName:"p"},"install")," script.")),Object(n.b)(m,{label:"Mac OS X",mdxType:"Tab"},Object(n.b)("p",null,"If you have ",Object(n.b)("a",a({parentName:"p"},{href:"https://brew.sh"}),"brew")," installed, you can install terraform executing the following command."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"brew cask install ibm-cloud-cli\n")),Object(n.b)("p",null,"Then add one of the following lines to ",Object(n.b)("inlineCode",{parentName:"p"},"~/.zshrc")," or ",Object(n.b)("inlineCode",{parentName:"p"},"~/.bashrc")," respectively (more about autocomplete ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/cli?topic=cloud-cli-shell-autocomplete"}),"here"),"):"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"source /usr/local/ibmcloud/autocomplete/zsh_autocomplete\nsource /usr/local/ibmcloud/autocomplete/bash_autocomplete\n")),Object(n.b)("p",null,"If ",Object(n.b)("inlineCode",{parentName:"p"},"brew")," is not installed then execute the following command:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"curl -fsSL https://clis.cloud.ibm.com/install/osx | sh\n")),Object(n.b)("p",null,"Or, download the latest version of the Installer for Mac OS X from the ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/IBM-Cloud/ibm-cloud-cli-release/releases/"}),"IBM Cloud CLI Releases")," page, execute it and follow the instructions.")),Object(n.b)(m,{label:"Windows",mdxType:"Tab"},Object(n.b)("p",null,"Download the latest version of the Installer for Windows from the ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/IBM-Cloud/ibm-cloud-cli-release/releases/"}),"IBM Cloud CLI Releases")," page, execute it and follow the instructions."),Object(n.b)("p",null,"Or, if you prefer to install with PowerShell, execute the following command:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-powershell"}),"iex(New-Object Net.WebClient).DownloadString('https://clis.cloud.ibm.com/install/powershell')\n")))),Object(n.b)("p",null,"Verify ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud")," was correctly installed by executing: ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud version"),", you should see something like this:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"$ ibmcloud version\nibmcloud version 1.0.0+908f90a-2020-03-30T10:19:41+00:00\n")),Object(n.b)("h3",null,"IBM Cloud CLI Plugins"),Object(n.b)("p",null,"The next steps is to install all the required plugins, for Infrastructure as Code you’ll need the ",Object(n.b)("inlineCode",{parentName:"p"},"vpc-infrastructure")," (aka ",Object(n.b)("inlineCode",{parentName:"p"},"infrastructure-service"),") and the ",Object(n.b)("inlineCode",{parentName:"p"},"schematics")," plugins, to install them execute the following command:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),'ibmcloud plugin install -f -r "IBM Cloud" infrastructure-service\nibmcloud plugin install -f -r "IBM Cloud" schematics\n')),Object(n.b)("p",null,"To list all the available plugins use the command:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud plugin repo-plugins\n")),Object(n.b)("p",null,"When a plugin version is out-of-date, you will see a reminder the first time you use that plugin in a cli session. To update plugins, you can use the following command to list available updates and select the ones to install:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud plugin update\n")),Object(n.b)("h3",null,"Login to IBM Cloud"),Object(n.b)("p",null,"Log in to IBM Cloud with the ",Object(n.b)("inlineCode",{parentName:"p"},"login")," sub-command. You may need to use the parameter ",Object(n.b)("inlineCode",{parentName:"p"},"-r")," to select a region (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"us-south")," or ",Object(n.b)("inlineCode",{parentName:"p"},"eu-gb"),"), ",Object(n.b)("inlineCode",{parentName:"p"},"-g")," to select a resource group (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"Default"),"), ",Object(n.b)("inlineCode",{parentName:"p"},"-c")," to select an account ID and ",Object(n.b)("inlineCode",{parentName:"p"},"--sso")," to request a one-time password if your IBMid is federated with another identity provider. When not using ",Object(n.b)("inlineCode",{parentName:"p"},"--sso"),", the command will interactively prompt for user name and password. Although these can be specified with the ",Object(n.b)("inlineCode",{parentName:"p"},"-u")," or ",Object(n.b)("inlineCode",{parentName:"p"},"-p")," parameters, for security reasons, it’s not recommended to do so."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud login -r us-south -g Default --sso\n")),Object(n.b)("p",null,"You don’t have to select the region or the resource group at login, these can be set at any time in the cli. After login (with or without resource group), to list all the available resource groups use the ",Object(n.b)("inlineCode",{parentName:"p"},"resource groups")," sub-command then use the ",Object(n.b)("inlineCode",{parentName:"p"},"target")," sub-command to select it."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud resource groups\nibmcloud target -g RESOURCE_GROUP_NAME\n")),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"target")," sub-command can be used also to select a new account ID or region."),Object(n.b)(u,{mdxType:"InlineNotification"},Object(n.b)("h6",null,Object(n.b)("inlineCode",{parentName:"h6"},"ibmcloud")," cheatsheet"),Object(n.b)("p",null,"To know more about the IBM Cloud CLI download this ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/ibm-cloud-docs/cli/raw/master/IBM%20Cloud%20CLI%20quick%20reference.pdf"}),"quick reference")," sheet. Also check the ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/cli?topic=cloud-cli-getting-started"}),"IBM Cloud CLI documentation"),".")),Object(n.b)("h2",null,"Install Terraform"),Object(n.b)("p",null,Object(n.b)("a",a({parentName:"p"},{href:"http://terraform.io/"}),"Terraform")," is Open Source software developed by ",Object(n.b)("a",a({parentName:"p"},{href:"https://www.hashicorp.com/"}),"HashiCorp")," to describe infrastructure as a code. Terraform allows you to build, change, and do versioning of the infrastructure safely and efficiently on multiple platforms and clouds. You can use Terraform to automate your IBM Cloud resource provisioning, rapidly build complex, multi-tier cloud environments, and implement Infrastructure as Code (IaC)."),Object(n.b)("p",null,"Terraform is distributed as a single binary for different platforms and architectures. To install Terraform follow the instructions below to install it from Terraform downloads or from the command prompt from your platform."),Object(n.b)(p,{mdxType:"Tabs"},Object(n.b)(m,{label:"Manual installation",mdxType:"Tab"},Object(n.b)("p",null,"Download the latest version for your operative system from the ",Object(n.b)("a",a({parentName:"p"},{href:"https://www.terraform.io/downloads.html"}),"Download Terraform")," page, then unzip it and move it to a directory included in your system’s PATH environment variable.")),Object(n.b)(m,{label:"Linux",mdxType:"Tab"},Object(n.b)("p",null,"The following one-liner script works on Linux and Mac OS X to install Terraform ",Object(n.b)("strong",{parentName:"p"},"v0.12.24")," for ",Object(n.b)("strong",{parentName:"p"},"amd64")," architecture."),Object(n.b)("p",null,"Update the version number to the latest one and move the downloaded ",Object(n.b)("inlineCode",{parentName:"p"},"terraform")," binary to one of the directories listed in the ",Object(n.b)("inlineCode",{parentName:"p"},"$PATH")," environment variable."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"curl -SL \"https://releases.hashicorp.com/terraform/0.12.24/terraform_0.12.24_$(uname | tr '[:upper:]' '[:lower:]')_amd64.zip\" | \\\ntar -xf - && \\\nchmod +x terraform\n"))),Object(n.b)(m,{label:"Mac OS X",mdxType:"Tab"},Object(n.b)("p",null,"If you have ",Object(n.b)("a",a({parentName:"p"},{href:"https://brew.sh"}),"brew")," installed, you can install terraform executing the following command."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"brew install terraform\n")),Object(n.b)("p",null,"If not, you can follow the same instructions for Linux.")),Object(n.b)(m,{label:"Windows",mdxType:"Tab"},Object(n.b)("p",null,"If you have ",Object(n.b)("a",a({parentName:"p"},{href:"https://chocolatey.org/"}),"Chocolatey")," installed, you can install terraform executing the following command."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"choco install terraform\n")),Object(n.b)("p",null,"If not, download from the Terraform downloads page and install manually."))),Object(n.b)("p",null,"Verify terraform is correctly installed by executing: ",Object(n.b)("inlineCode",{parentName:"p"},"terraform version"),", you should see something like this:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"$ terraform version\nTerraform v0.12.24\n")),Object(n.b)("h2",null,"Configure access to IBM Cloud"),Object(n.b)("p",null,"With Terraform you can create, manage and update almost any infrastructure resource such as virtual servers, virtual routers, load balancers, containers, kubernetes clusters, and more. All these infrastructure components are represented as a ",Object(n.b)("strong",{parentName:"p"},"resource")," in Terraform. All these resources are defined in a ",Object(n.b)("strong",{parentName:"p"},"Terraform provider")," which is responsible to interact and expose the resources using the cloud service API."),Object(n.b)(u,{mdxType:"InlineNotification"},Object(n.b)("h6",null,"Where can I find an overview of available resources?"),Object(n.b)("p",null,"To find a full list of IBM Cloud resources that you can provision with the IBM Cloud Provider plug-in, see the ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/terraform?topic=terraform-index-of-terraform-resources-and-data-sources"}),"IBM Cloud Provider reference"),".")),Object(n.b)("p",null,"In order for Terraform to interact with IBM Cloud, it requires the IBM Cloud Provider. To install the IBM Cloud Provider just download the binary to the directory ",Object(n.b)("inlineCode",{parentName:"p"},"~/.terraform.d/plugins"),". Download the latest version from ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/IBM-Cloud/terraform-provider-ibm/releases"}),"https://github.com/IBM-Cloud/terraform-provider-ibm/releases"),", or execute the following simple script on Linux or Mac OS X, make sure to update the version number (i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"v1.3.0"),") to the latest one."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"mkdir -p ~/.terraform.d/plugins\ncurl -SL \"https://github.com/IBM-Cloud/terraform-provider-ibm/releases/download/v1.3.0/$(uname | tr '[:upper:]' '[:lower:]')_amd64.zip\" | \\\ntar -xf - -C ~/.terraform.d/plugins\nchmod +x ~/.terraform.d/plugins/terraform-provider-ibm_*\n")),Object(n.b)("p",null,"Now we need to setup the IBM Cloud credentials on the system to let the IBM Cloud provider to talk the IBM Cloud REST API."),Object(n.b)(u,{mdxType:"InlineNotification"},Object(n.b)("h6",null,"What credentials do I need?"),Object(n.b)("p",null,"The credentials that you need depend on the type of resource that you want to provision. For example, to provision classic infrastructure resources, you must provide your IBM Cloud classic infrastructure user name and API key. To provision VPC infrastructure generation 2, you need an IBM Cloud API key. For more information about what credentials you need for a specific IBM Cloud resource, see ",Object(n.b)("a",a({parentName:"p"},{href:"https://github.com/IBM-Cloud/terraform-provider-ibm/releases"}),"Retrieving required credentials for your resources"),"."),Object(n.b)("p",null,"In this documentation we are going to use Gen 2 resources so we’ll only work with the IBM Cloud API key.")),Object(n.b)(u,{mdxType:"InlineNotification"},Object(n.b)("h6",null,"Using Classic Infrastructure?"),Object(n.b)("p",null,"To use the Classic Infrastructure or the VPC Infrastructure Gen 1 you’ll need to include in the credentials the IAAS Classic username and API key. These can be obtained at the IBM Cloud web console. Go to ",Object(n.b)("strong",{parentName:"p"},"Manage")," > ",Object(n.b)("strong",{parentName:"p"},"Access (IAM)")," > ",Object(n.b)("strong",{parentName:"p"},"Users"),", find and click on your user. Under the section ",Object(n.b)("strong",{parentName:"p"},"API keys")," you’ll find your key(s) or generate them clicking on ",Object(n.b)("inlineCode",{parentName:"p"},"Create classic infrastructure key")," button. The ",Object(n.b)("strong",{parentName:"p"},"username")," is the email address you use to login to the IBM Cloud console."),Object(n.b)("p",null,"When you have the IAAS Classic username and API key, export them with the environment variables ",Object(n.b)("inlineCode",{parentName:"p"},"IAAS_CLASSIC_USERNAME")," and ",Object(n.b)("inlineCode",{parentName:"p"},"IAAS_CLASSIC_API_KEY")," respectively.")),Object(n.b)("p",null,"If you haven’t logged in yet, follow the steps from ",Object(n.b)("a",a({parentName:"p"},{href:"#login-to-ibm-cloud"}),"login")," to IBM Cloud or just execute ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud login")," and target a resource group."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud login --sso\nibmcloud resource groups\nibmcloud target -g RESOURCE_GROUP_NAME\n")),Object(n.b)("p",null,"Create an API Key on the IBM Cloud web console following these ",Object(n.b)("a",a({parentName:"p"},{href:"https://cloud.ibm.com/docs/iam?topic=iam-userapikey#create_user_key"}),"instructions")," or simply using the ",Object(n.b)("inlineCode",{parentName:"p"},"ibmcloud")," command, like this:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),'ibmcloud iam api-key-create TerraformKey -d "API Key for Terraform" --file terraform_key.json\n')),Object(n.b)("p",null,"If you are in a GitHub repository directory, make sure the file is not pushed or ignore it adding the filename to ",Object(n.b)("inlineCode",{parentName:"p"},".gitignore"),", executing:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),'echo "terraform_key.json" >> .gitignore\n')),Object(n.b)("p",null,"To give Terraform and the IBM Cloud provider access to the IBM Cloud credentials, store the API key as the environment variable ",Object(n.b)("inlineCode",{parentName:"p"},"IC_API_KEY"),"."),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"export IC_API_KEY=$(grep '\"apikey\":' terraform_key.json | sed 's/.*: \"\\(.*\\)\".*/\\1/')\n")),Object(n.b)("p",null,"Or by using jq:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"export IC_API_KEY=$(jq -r .apikey terraform_key.json)\n")),Object(n.b)(u,{kind:"warning",mdxType:"InlineNotification"},Object(n.b)("h6",null,"Important"),Object(n.b)("p",null,"The IBM Cloud credentials can also be set in Terraform input variables."),Object(n.b)("p",null,"There are different ways to set Terraform input variables, for security reasons we recommend to use environment variables (",Object(n.b)("inlineCode",{parentName:"p"},"TF_VAR_<variable name>"),") but you can also store them in a variable definition (",Object(n.b)("inlineCode",{parentName:"p"},".tfvar"),") files or pass them with the ",Object(n.b)("inlineCode",{parentName:"p"},"-var")," command line option."),Object(n.b)("p",null,"If you store the credentials in a variable definition file, i.e. ",Object(n.b)("inlineCode",{parentName:"p"},"terraform.tfvar")," make sure to not push the file to your github repository. Add the filename into the ",Object(n.b)("inlineCode",{parentName:"p"},".gitignore")," file."),Object(n.b)("p",null,"The same applies for the Key file previously created, so make sure it is also in the ",Object(n.b)("inlineCode",{parentName:"p"},".gitignore")," file.")),Object(n.b)("h2",null,"Testing access to IBM Cloud"),Object(n.b)("p",null,"The Terraform code can be done with JSON format or using ",Object(n.b)("strong",{parentName:"p"},"HashiCorp Configuration Language")," (HCL). During this pattern guide we’ll use only HCL and we will call it HCL or Terraform Code."),Object(n.b)("p",null,"A simple terraform code to verify your access could be something like the following:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-hcl"}),'provider "ibm" {\n  generation         = 2\n  region             = "us-south"\n}\n\ndata "ibm_iam_access_group" "accgroup" {\n}\n\noutput "accgroups" {\n  value = data.ibm_iam_access_group.accgroup.groups[*].name\n}\n')),Object(n.b)("p",null,"Create a file ",Object(n.b)("inlineCode",{parentName:"p"},"main.tf")," with the above terraform code in a temporary directory, then execute:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform apply\n")),Object(n.b)("p",null,"The output of ",Object(n.b)("inlineCode",{parentName:"p"},"terraform apply")," should print any Access Groups that are visible to you in the account associated with your API key. The output should be similar to the execution of:"),Object(n.b)("pre",null,Object(n.b)("code",a({parentName:"pre"},{className:"language-bash"}),"ibmcloud iam access-groups\n")),Object(n.b)("p",null,"In the following section we’ll see more examples."))}f.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-iac-setup-environment-index-mdx-586e23711c0ceb1c69a5.js.map