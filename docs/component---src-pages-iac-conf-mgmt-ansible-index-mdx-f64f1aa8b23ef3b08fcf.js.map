{"version":3,"sources":["webpack:///./src/pages/iac-conf-mgmt/ansible/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","InlineNotification","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","small","parentName","isMDXComponent"],"mappings":"yeAMO,IAAMA,EAAe,GAEtBC,EAAgB,SAAAC,GAAI,OAAI,SAA6BC,GAEzD,OADAC,QAAQC,KAAK,aAAeH,EAAO,2EAC5B,kBAASC,KAGZG,EAAkBL,EAAc,mBAChCM,EAAcN,EAAc,eAC5BO,EAAaP,EAAc,cAC3BQ,EAAqBR,EAAc,sBACnCS,EAAc,CAClBV,gBAEIW,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGX,E,oIACF,mBACD,OAAO,YAACQ,EAAD,KAAeD,EAAiBP,EAAhC,CAAuCW,WAAYA,EAAYC,QAAQ,cAG5E,YAACT,EAAD,CAAiBS,QAAQ,mBACvB,0EAEF,YAACR,EAAD,CAAaS,OAAK,EAACD,QAAQ,eAC7B,YAACP,EAAD,CAAYO,QAAQ,cAApB,wBACA,YAACP,EAAD,CAAYO,QAAQ,cAApB,qCACA,YAACP,EAAD,CAAYO,QAAQ,cAApB,oCACA,YAACP,EAAD,CAAYO,QAAQ,cAApB,+BACA,YAACP,EAAD,CAAYO,QAAQ,cAApB,aAEE,kTACA,YAACN,EAAD,CAAoBM,QAAQ,sBAC1B,qBAAG,sBAAQE,WAAW,KAAnB,yCACH,qHAAoG,mBAAGA,WAAW,KAAQ,CACtH,KAAQ,uBADwF,UAApG,KAEyB,mBAAGA,WAAW,KAAQ,CAC3C,KAAQ,wBADa,QAFzB,QAI0B,mBAAGA,WAAW,KAAQ,CAC5C,KAAQ,8BADc,aAJ1B,iRAQF,8CACA,4eACA,6TAA4S,mBAAGA,WAAW,KAAQ,CAC9T,KAAQ,sDADgS,qDAA5S,qBAEoF,mBAAGA,WAAW,KAAQ,CACtG,KAAQ,gFADwE,cAFpF,KAKA,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,UAPhB,WAUI,sBAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,qBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,wvCACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,qBAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,wBACP,MAAS,kCACT,IAAO,oGACP,OAAU,CAAC,yGAA0G,yGAA0G,0GAC/N,MAAS,kCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,UAyCA,yCACA,oGAAmF,mBAAGA,WAAW,KAAQ,CACrG,KAAQ,uFADuE,gBAAnF,mGAE6H,0BAAYA,WAAW,KAAvB,OAF7H,8BAGA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,iCAIL,sFAAqE,0BAAYA,WAAW,KAAvB,QAArE,iDACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,2BAIL,+EAA8D,0BAAYA,WAAW,KAAvB,qBAA9D,8FAA0N,0BAAYA,WAAW,KAAvB,SAA1N,KACA,gNACA,8CACA,gEAA+C,0BAAYA,WAAW,KAAvB,sBAA/C,iHAA+N,mBAAGA,WAAW,KAAQ,CACjP,KAAQ,qDADmN,qBAA/N,2FAGA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,sDAML,wCACA,sHAAqG,mBAAGA,WAAW,KAAQ,CACvH,KAAQ,4EADyF,gCAArG,0EAEoH,0BAAYA,WAAW,KAAvB,kBAFpH,gBAE+L,0BAAYA,WAAW,KAAvB,oBAF/L,gFAE4U,0BAAYA,WAAW,KAAvB,mBAF5U,KAGA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,sBACd,KAAQ,mBAHP,oRAiBL,kMAAiL,0BAAYA,WAAW,KAAvB,aAAjL,0CACA,sBACE,kBAAIA,WAAW,MAAK,0BAAYA,WAAW,MAAvB,gBAApB,8DAA4I,0BAAYA,WAAW,MAAvB,UAA5I,SACA,kBAAIA,WAAW,MAAK,0BAAYA,WAAW,MAAvB,gCAApB,mEAAiK,mBAAGA,WAAW,MAAS,CACpL,KAAQ,qDADqJ,uBAAjK,IAEqC,0BAAYA,WAAW,MAAvB,qBAFrC,iCAEqI,0BAAYA,WAAW,MAAvB,iBAFrI,SAGA,kBAAIA,WAAW,MAAK,0BAAYA,WAAW,MAAvB,2BAApB,wLAAiR,0BAAYA,WAAW,MAAvB,eAAjR,4BAAsW,0BAAYA,WAAW,MAAvB,+BAAtW,qFAAogB,0BAAYA,WAAW,MAAvB,6BAApgB,aAAwlB,0BAAYA,WAAW,MAAvB,eAAxlB,iCAEF,sFAAqE,0BAAYA,WAAW,KAAvB,QAArE,YACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,4CAIL,4CACA,0BAAS,mBAAGA,WAAW,KAAQ,CAC3B,KAAQ,iDADH,YAAT,iEAEuF,mBAAGA,WAAW,KAAQ,CACzG,KAAQ,kFAD2E,QAFvF,odAIse,mBAAGA,WAAW,KAAQ,CACxf,KAAQ,+BAD0d,wBAJte,oDAOA,6CAA4B,0BAAYA,WAAW,KAAvB,SAA5B,yCAAuH,0BAAYA,WAAW,KAAvB,gBAAvH,+BAA+M,0BAAYA,WAAW,KAAvB,SAA/M,gCAAiS,0BAAYA,WAAW,KAAvB,aAAjS,uEAA8Z,0BAAYA,WAAW,KAAvB,YAA9Z,KAAwd,0BAAYA,WAAW,KAAvB,YAAxd,KAAkhB,0BAAYA,WAAW,KAAvB,QAAlhB,KAAwkB,0BAAYA,WAAW,KAAvB,SAAxkB,KAA+nB,0BAAYA,WAAW,KAAvB,aAA/nB,QAA6rB,0BAAYA,WAAW,KAAvB,QAA7rB,sEACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,kCAIL,+PAA8O,0BAAYA,WAAW,KAAvB,SAA9O,qBACA,wCAAuB,0BAAYA,WAAW,KAAvB,iCACvB,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,oCACd,KAAQ,iCAHP,wDAOL,+HACA,yGAAwF,0BAAYA,WAAW,KAAvB,iBAAxF,KACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,qBACd,KAAQ,kBAHP,gEASL,4FAA2E,0BAAYA,WAAW,KAAvB,OAA3E,+DAA0L,0BAAYA,WAAW,KAAvB,eAA1L,2HAA6W,0BAAYA,WAAW,KAAvB,cAA7W,OAA2a,0BAAYA,WAAW,KAAvB,aAA3a,wCAAygB,0BAAYA,WAAW,KAAvB,oBAAzgB,sBACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,yDAIL,kGAAiF,0BAAYA,WAAW,KAAvB,MAAjF,wDACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,8jBAgBL,iCACA,qCAAoB,mBAAGA,WAAW,KAAQ,CACtC,KAAQ,qDADQ,WAApB,iKAGA,YAACR,EAAD,CAAoBM,QAAQ,sBAC1B,qBAAG,sBAAQE,WAAW,KAAnB,4BACH,uFAAsE,0BAAYA,WAAW,KAAvB,WAAtE,oOACA,2GAA0F,0BAAYA,WAAW,KAAvB,QAA1F,yEAAoN,0BAAYA,WAAW,KAAvB,OAApN,iCACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,8EAKP,+BAAc,0BAAYA,WAAW,KAAvB,6BAAd,mEACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,iCACd,KAAQ,8BAHP,6VAmBL,0DAAyC,0BAAYA,WAAW,KAAvB,QAAzC,qIAA+N,0BAAYA,WAAW,KAAvB,OAA/N,qJACA,sBACE,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,wEADQ,WAApB,gDAGA,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,+EADQ,kBAApB,sCAGA,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,oEADQ,OAApB,iGAIF,wCAAuB,0BAAYA,WAAW,KAAvB,+BAAvB,8CACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,mCACd,KAAQ,gCAHP,0jBAwBL,qDAAoC,mBAAGA,WAAW,KAAQ,CACtD,KAAQ,sEADwB,SAApC,uSAGA,wCAAuB,0BAAYA,WAAW,KAAvB,QAAvB,IAA4E,mBAAGA,WAAW,KAAQ,CAC9F,KAAQ,mFADgE,yBAA5E,mEAGA,iDAAgC,mBAAGA,WAAW,KAAQ,CAClD,KAAQ,gFADoB,qBAAhC,kBAEiD,0BAAYA,WAAW,KAAvB,SAFjD,oIAGA,4dAA2c,0BAAYA,WAAW,KAAvB,mCAA3c,KAIA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,iCACd,KAAQ,8BAHP,wKAUL,yDAAwC,0BAAYA,WAAW,KAAvB,YAAxC,uLAAoR,0BAAYA,WAAW,KAAvB,kBAApR,6CAA4X,0BAAYA,WAAW,KAAvB,SAA5X,4HACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,ogBAsBL,8HAA6G,0BAAYA,WAAW,KAAvB,6BAA7G,cACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,iCACd,KAAQ,8BAHP,qaAkBL,8CAA6B,0BAAYA,WAAW,KAAvB,SAA7B,kDAAiI,mBAAGA,WAAW,KAAQ,CACnJ,KAAQ,wEADqH,WAAjI,iEAEsF,0BAAYA,WAAW,KAAvB,iBAFtF,iEAEiN,0BAAYA,WAAW,KAAvB,WAFjN,KAE0Q,0BAAYA,WAAW,KAAvB,WAF1Q,KAEmU,0BAAYA,WAAW,KAAvB,aAFnU,QAEiY,0BAAYA,WAAW,KAAvB,YAFjY,iCAEud,0BAAYA,WAAW,KAAvB,QAFvd,2DAGA,+DAA8C,0BAAYA,WAAW,KAAvB,iBAA9C,6IACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,iCACd,KAAQ,8BAHP,wIAQL,sFAAqE,0BAAYA,WAAW,KAAvB,aAArE,+EACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,oCACd,KAAQ,iCAHP,6GAUL,uIAAsH,0BAAYA,WAAW,KAAvB,oBAAtH,yBACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,yDAIL,sJACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,4FAKL,2HACA,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,WAPhB,WAUI,sBAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,sBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,4aACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,qBAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,yBACP,MAAS,4CACT,IAAO,0FACP,OAAU,CAAC,+FAAgG,+FAAgG,gGAAiG,gGAAiG,gGAAiG,iGAC9e,MAAS,oCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,UAyCA,2KAA0J,0BAAYA,WAAW,KAAvB,cAA1J,8DAA+Q,0BAAYA,WAAW,KAAvB,SAA/Q,uBAAwV,0BAAYA,WAAW,KAAvB,qBAAxV,0CACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,wBAIL,2DACA,oTAAmS,0BAAYA,WAAW,KAAvB,aAAnS,4CACA,sCAAqB,0BAAYA,WAAW,KAAvB,cAArB,mDAA+H,0BAAYA,WAAW,KAAvB,oBAA/H,0BACA,qJAAoI,0BAAYA,WAAW,KAAvB,kBAApI,kBAAiN,0BAAYA,WAAW,KAAvB,aAAjN,+BAAsS,0BAAYA,WAAW,KAAvB,iCAAtS,gCACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,qCACd,KAAQ,kCAHP,4aAoBL,YAACR,EAAD,CAAoBM,QAAQ,sBAC1B,qBAAG,sBAAQE,WAAW,KAAnB,yBACH,wLAAuK,mBAAGA,WAAW,KAAQ,CACzL,KAAQ,6BAD2J,mBAAvK,oKAIF,sNAAqM,0BAAYA,WAAW,KAAvB,cAArM,KACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,kBACd,KAAQ,eAHP,wQAUL,wGAAuF,0BAAYA,WAAW,KAAvB,oBAAvF,6CACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,wBACd,KAAQ,qBAHP,mtBAwBL,0CAAyB,0BAAYA,WAAW,KAAvB,UAAzB,QAAoF,0BAAYA,WAAW,KAAvB,cAApF,qDAAgM,0BAAYA,WAAW,KAAvB,qDAAhM,sBACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,+GAQL,uMAAsL,0BAAYA,WAAW,KAAvB,gBAAtL,+BAA8Q,0BAAYA,WAAW,KAAvB,oBAA9Q,mCAA8W,0BAAYA,WAAW,KAAvB,cAA9W,KACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,oBACd,KAAQ,iBAHP,+QAeL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,wBACd,KAAQ,qBAHP,8JAQL,4DAA2C,0BAAYA,WAAW,KAAvB,kBAA3C,2HAAiO,0BAAYA,WAAW,KAAvB,cAAjO,UACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,0CAIL,+EAA8D,0BAAYA,WAAW,KAAvB,oBAA9D,uHAAkP,0BAAYA,WAAW,KAAvB,cAAlP,yBAAkU,0BAAYA,WAAW,KAAvB,iBAAlU,iBAA6Y,0BAAYA,WAAW,KAAvB,oBAA7Y,UACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,yNAUL,kUAAiT,0BAAYA,WAAW,KAAvB,eAAjT,yHACA,0CAAyB,0BAAYA,WAAW,KAAvB,wBAAzB,mBAA6G,0BAAYA,WAAW,KAAvB,oBAA7G,sBAAgM,0BAAYA,WAAW,KAAvB,2BAAhM,qBACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,ygBAwBL,4BAAW,0BAAYA,WAAW,KAAvB,wBAAX,2FAAuK,0BAAYA,WAAW,KAAvB,YAAvK,sNACA,yDAAwC,0BAAYA,WAAW,KAAvB,aAAxC,QAAsG,0BAAYA,WAAW,KAAvB,QAAtG,yBAAgL,0BAAYA,WAAW,KAAvB,kBAAhL,iDACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,sDAML,uNACA,6NAA4M,0BAAYA,WAAW,KAAvB,cAA5M,+CAAkT,0BAAYA,WAAW,KAAvB,eAAlT,gBAA0X,0BAAYA,WAAW,KAAvB,cAA1X,UACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,6IAIL,4EAA2D,0BAAYA,WAAW,KAAvB,QAA3D,sHACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,qDAIL,0DACA,sGAAqF,mBAAGA,WAAW,KAAQ,CACvG,KAAQ,sDADyE,qDAArF,qBAEoF,mBAAGA,WAAW,KAAQ,CACtG,KAAQ,gFADwE,cAFpF,yCAKA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,wBACd,KAAQ,qBAHP,s8CAiDL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,qCACd,KAAQ,kCAHP,4aAoBL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,oBACd,KAAQ,iBAHP,ubA2BL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,qBACd,KAAQ,kBAHP,gEASL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,oCACd,KAAQ,iCAHP,8GAUL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,uCACd,KAAQ,oCAHP,6VAmBL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,yCACd,KAAQ,sCAHP,0jBAwBL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,uCACd,KAAQ,oCAHP,qaAkBL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,gBACb,WAAc,uCACd,KAAQ,oCAHP,gMAWL,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,kBACd,KAAQ,eAHP,03CAiDL,mDAAkC,0BAAYA,WAAW,KAAvB,eAAlC,uCACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,iBADZ,4CAKL,gDAA+B,0BAAYA,WAAW,KAAvB,oBAA/B,yGAAqM,0BAAYA,WAAW,KAAvB,oBAArM,UACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,eACb,WAAc,wBACd,KAAQ,qBAHP,+RAaL,qDACA,yjBACA,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,UAPhB,WAUI,sBAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,qBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,wvCACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,qBAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,0BACP,MAAS,oCACT,IAAO,oGACP,OAAU,CAAC,yGAA0G,yGAA0G,0GAC/N,MAAS,kCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,UAyCA,8aACA,qaACA,kCACA,4DAA2C,0BAAYA,WAAW,KAAvB,qBAA3C,4DAAqK,0BAAYA,WAAW,KAAvB,YAArK,gEACA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,yBAQTJ,EAAWK,gBAAiB","file":"component---src-pages-iac-conf-mgmt-ansible-index-mdx-f64f1aa8b23ef3b08fcf.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst InlineNotification = makeShortcode(\"InlineNotification\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Configure the provisioned instance using Ansible`}</p>\n    </PageDescription>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Ansible Introduction</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Ansible and Terraform Integration</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Final Terraform and Ansible Code</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Ansible from a Bastion Host</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Clean up</AnchorLink>\n    </AnchorLinks>\n    <p>{`Terraform is great for infrastructure provisioning but it’s not a configuration management tool. That’s where Ansible comes in. After Terraform finishes the provisioning of an instance, control goes to Ansible to finish up the configuration of the instance system and applications.`}</p>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Other Configuration Management Tools`}</strong></p>\n      <p>{`Ansible is a Configuration Management Tool but is not the only one. There are others such as `}<a parentName=\"p\" {...{\n          \"href\": \"https://puppet.com\"\n        }}>{`Puppet`}</a>{`, `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.chef.io\"\n        }}>{`Chef`}</a>{` and `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.saltstack.com\"\n        }}>{`SaltStack`}</a>{`. This pattern explains how to use Ansible for Configuration Management after Terraform finishes the Provisioning and creates the input data for Ansible. In a similar way you can setup the input data for Puppet, Chef, SaltStack or other configuration management tools.`}</p>\n    </InlineNotification>\n    <h2>{`Ansible Introduction`}</h2>\n    <p>{`Ansible is one of the most used Configuration Management tools, it’s simple and easy to learn. Ansible use SSH to connect to the servers or instances to execute the configuration tasks defined in YAML files or playbooks. Ansible tasks are idempotent, this means that they can be applied multiple times without changing the result beyond the initial application, this is what makes Ansible reliable and differentiates it from some other configuration management tools.`}</p>\n    <p>{`To use Ansible we need one host with Ansible, the playbooks and all the Ansible configuration files. There are different designs, the one shown in this example is to use Ansible from the same host where Terraform is executed. The Terraform and Ansible example code is in the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/12-ansible\"\n      }}>{`12-ansible`}</a>{`.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"781px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"56.59722222222222%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADUklEQVQoz1VTe0jTYRS9/uYezj1TM0WdzcdWmoVmb4t0albD2SqjQkOrP1Ts/TDLbGWpU5P5aBWmEWSW1Qp6QFBIOrWpaNNyFeaahXs5dc20dF/7BZFdLnz3wuHcczn3A91XfX2z8k2b432hN4xzAcAp7WoUM71ITEEIwJH/RUDwiiCfLdly34zceMbmMyxmciYdEnJp3jszGT7bTtBhUDukffz4KVL3vkeOCAR4RUyPHRVvWNc5d5N3FSVE2uoeW9SVE3VBtfkvqefFrA3h5St3IHU+LbrC3aXxAY8RXj6Xyiq6R4GHiofvy4obUH39c+unAftSgCvY3lhTjjjmrZozpyog+sygqMuKUMkTnQpAgYWFds/Dt5i8zAs2SpfWGCXcIFPp8oZnJV5MONpNhNfNSk1t7S2kUnXbZqZRCK5gt3iKsydOn4LXqaV9YfJnfcYSxTsZ3q8X1FPhcC6t4yCXZdi7aMXHdC+aIT10dfxtjEQ7dYMCBuOIxjI6hoaHDd/VfdpwPjxwVYhq3TZu66F7BD1nIPQZe93UlNXZ3rwSJzy2fysJEmQknSySbyxbVjl82i/AXBBRe7eGy4QD7UQwmUc1PyZ/IYtlfKJAfi2l0ZUVgwggcplfFUn0lsXNNuRsoZwg8hcQobjMRStge+m3c6L0q5luJqFvjN9bCpF94hoFzOM2zdQMQiOWcVt5aVliNkCowmEmwBoWkAQLcKJqaTWhsbAUS6647QR5tzAQSymmVE7kyPklsrEk9wjzpYjrd2r8GHBISYKBHnW/TvMRGUbGbL+sEzz8TKZ3bc34uUMofcQjsGcrvC/cTmile7If+XCCLSHsZaYkfuroYlbAt8xIUVodm0zIuUmGtsb7/S8b7iJlS9uEtbNnIWKQwtHJgwjJZQgJ4472OxxFZHLwDEDYlDMxyuZESNC4sWMnHVs4hpPsAMQ/0+qAwMmrdIGW9o6BVlUnamlWTo9Zf/AdIKo9a1+7/XCWeSY5cS2ORd6e5EFXBiY5LsFgVQkG547QZitHaBcsLwRnj3w5BbTaoabe3j7DF93XDxO2ySAcML0mgob4vp54bUf//sq+intOPF68MyfjJD1UEkfl5idSA/OFVH9JEtWvQED1yGsg/waQ92d8F++9pgAAAABJRU5ErkJggg==')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Ansible at Local Host\",\n        \"title\": \"Running Ansible from Local Host\",\n        \"src\": \"/cloud-enterprise-examples/static/ced342e4102a26420170f80f60846589/1ec2b/IaC-Ansible_Design_1.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/ced342e4102a26420170f80f60846589/7fc1e/IaC-Ansible_Design_1.png 288w\", \"/cloud-enterprise-examples/static/ced342e4102a26420170f80f60846589/a5df1/IaC-Ansible_Design_1.png 576w\", \"/cloud-enterprise-examples/static/ced342e4102a26420170f80f60846589/1ec2b/IaC-Ansible_Design_1.png 781w\"],\n        \"sizes\": \"(max-width: 781px) 100vw, 781px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <h3>{`Install Ansible`}</h3>\n    <p>{`Install Ansible in the same host where Terraform is installed. Follow these `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html\"\n      }}>{`instructions`}</a>{` to install Ansible on your platform. However, the most generic way to install Ansible is using `}<inlineCode parentName=\"p\">{`pip`}</inlineCode>{` (Python package manager).`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`pip install --user ansible\n`}</code></pre>\n    <p>{`If you are on MacOS, other option to install Ansible is using `}<inlineCode parentName=\"p\">{`brew`}</inlineCode>{`, it’ll install Ansible and its dependencies.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`brew install ansible\n`}</code></pre>\n    <p>{`To verify Ansible is correctly installed, just execute `}<inlineCode parentName=\"p\">{`ansible --version`}</inlineCode>{` and you should get the latest version, at the time this document is written, it’s version `}<inlineCode parentName=\"p\">{`2.9.7`}</inlineCode>{`.`}</p>\n    <p>{`The use case exposed in this section is to install to the LogDNA agent on the instance for log analysis. All the hosts require the LogDNA agent to send the logs to the LogDNA service.`}</p>\n    <h3>{`Infrastructure Setup`}</h3>\n    <p>{`Clone the example project and go to the `}<inlineCode parentName=\"p\">{`12-user-data/start`}</inlineCode>{` folder. You will already need to have set up the terraform cli and the API key for terraform as described in `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n      }}>{`Setup Environment`}</a>{`. Run these commands to initially deploy the virtual machines for the Ansible examples.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init\nterraform plan\nterraform apply\n`}</code></pre>\n    <h3>{`Inventory File`}</h3>\n    <p>{`The first file used by Ansible is the inventory file with the list of hosts to configure. The `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html\"\n      }}>{`inventory file documentation`}</a>{` shows all the possible parameters and variables you can set. Create a `}<inlineCode parentName=\"p\">{`inventory.yaml`}</inlineCode>{` file in the `}<inlineCode parentName=\"p\">{`12-ansible/start`}</inlineCode>{` folder with the content below, but update with the IP addresses output from `}<inlineCode parentName=\"p\">{`terraform apply`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=inventory.yaml\",\n        \"path\": \"inventory.yaml\"\n      }}>{`all:\n  vars:\n    ansible_user: ubuntu\n    ansible_ssh_private_key_file: ~/.ssh/id_rsa\n    ansible_ssh_common_args: \"-o StrictHostKeyChecking=no\"\n  children:\n    appservers:\n      hosts:\n        52.116.136.206:\n        52.116.132.187:\n        52.116.136.220:\n\n`}</code></pre>\n    <p>{`As the example progresses, we will add more information into this file such as variables and the hostnames, for now we just need the IP addresses grouped by server tier (`}<inlineCode parentName=\"p\">{`appserver`}</inlineCode>{`) and the following ansible variables:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`ansible_user`}</inlineCode>{` defines the user to login into the hosts, in this case is `}<inlineCode parentName=\"li\">{`ubuntu`}</inlineCode>{` user`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`ansible_ssh_private_key_file`}</inlineCode>{` path to the private SSH key used to login to the hosts, if you `}<a parentName=\"li\" {...{\n          \"href\": \"/cloud-enterprise-examples/iac-resources/compute\"\n        }}>{`used the public key`}</a>{` `}<inlineCode parentName=\"li\">{`~/.ssh/id_rsa.pub`}</inlineCode>{` then provide the private key `}<inlineCode parentName=\"li\">{`~/.ssh/id_rsa`}</inlineCode>{` pair`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`ansible_ssh_common_args`}</inlineCode>{` this variable set extra parameters to the SSH command used by Ansible to connect to the hosts. With no extra arguments SSH will ask confirmation to the user to add the keys to the `}<inlineCode parentName=\"li\">{`known_hosts`}</inlineCode>{` file. Add the parameter `}<inlineCode parentName=\"li\">{`-o StrictHostKeyChecking=no`}</inlineCode>{` to make this process non-interactive. This can also be achieved with the setting `}<inlineCode parentName=\"li\">{`host_key_checking = False`}</inlineCode>{` into the `}<inlineCode parentName=\"li\">{`ansible.cfg`}</inlineCode>{` file in the same directory.`}</li>\n    </ul>\n    <p>{`To verify we can reach the hosts we execute Ansible using the `}<inlineCode parentName=\"p\">{`ping`}</inlineCode>{` module.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ansible all -m ping -i inventory.yaml\n`}</code></pre>\n    <h3>{`Playbook and Roles`}</h3>\n    <p>{`A `}<a parentName=\"p\" {...{\n        \"href\": \"http://docs.ansible.com/playbooks_intro.html\"\n      }}>{`Playbook`}</a>{` is yaml files with a set of tasks or roles to be executed. A `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html\"\n      }}>{`Role`}</a>{` is a collection of related tasks and handlers, to encapsulate data such as variables, files, templates and metadata, to execute one specific macro-task. For example, our (macro) task is to get LogDNA up and running on a given host, to execute this task we need to execute (atomic) tasks to install packages, execute configuration commands and start services, using the given configuration parameters (data in form of variables). We can use any of the open sourced `}<a parentName=\"p\" {...{\n        \"href\": \"https://galaxy.ansible.com\"\n      }}>{`Ansible Galaxy Roles`}</a>{` but in this example we’ll create a simple role.`}</p>\n    <p>{`Still working in the `}<inlineCode parentName=\"p\">{`start`}</inlineCode>{` directory, create the directory path `}<inlineCode parentName=\"p\">{`roles/logdna`}</inlineCode>{` and inside the directory a `}<inlineCode parentName=\"p\">{`tasks`}</inlineCode>{` sub-directory with the file `}<inlineCode parentName=\"p\">{`main.yaml`}</inlineCode>{`. Normal convention with Ansible will often add directories such as `}<inlineCode parentName=\"p\">{`handlers`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`defaults`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`vars`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`files`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`templates`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`meta`}</inlineCode>{` but they are not needed and are out of the scope of this article.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`mkdir -p roles/logdna/tasks\n`}</code></pre>\n    <p>{`This example only covers the installation of LogDNA. If you’d like to install or configure something else such as deploing the API application or deploying the initial database, then you would create more roles under the directory `}<inlineCode parentName=\"p\">{`roles`}</inlineCode>{` for those tasks.`}</p>\n    <p>{`Inside the file `}<inlineCode parentName=\"p\">{`roles/logdna/tasks/main.yaml`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/main.yaml\",\n        \"path\": \"roles/logdna/tasks/main.yaml\"\n      }}>{`- debug:\n    msg: \"Checking Ansible is working!\"\n`}</code></pre>\n    <p>{`We’ll develop the tasks role more, but for now let’s have a debug message just to verify it’s working.`}</p>\n    <p>{`To tell Ansible which roles to execute, create the following playbook file named `}<inlineCode parentName=\"p\">{`playbook.yaml`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=playbook.yaml\",\n        \"path\": \"playbook.yaml\"\n      }}>{`- hosts: all\n  become: yes\n  roles:\n    - role: logdna\n`}</code></pre>\n    <p>{`This playbook file instructs Ansible to execute the instructions on `}<inlineCode parentName=\"p\">{`all`}</inlineCode>{` hosts. The instructions should be executed as root, so the `}<inlineCode parentName=\"p\">{`become: yes`}</inlineCode>{` is used. And finally, we list all the roles to run on every host. You may have a list of roles per host groups such as `}<inlineCode parentName=\"p\">{`appservers`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`dbservers`}</inlineCode>{`. Then execute the playbook with the `}<inlineCode parentName=\"p\">{`ansible-playbook`}</inlineCode>{` command, like so.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ansible-playbook -i inventory.yaml ./playbook.yaml\n`}</code></pre>\n    <p>{`You should see, among a bunch of lines, the following lines starting with `}<inlineCode parentName=\"p\">{`ok`}</inlineCode>{` and at the end a report summary like the following.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-text\"\n      }}>{`ok: [52.116.136.206] => {\n    \"msg\": \"Checking Ansible is working!\"\n}\nok: [52.116.132.187] => {\n    \"msg\": \"Checking Ansible is working!\"\n}\nok: [52.116.136.220] => {\n    \"msg\": \"Checking Ansible is working!\"\n}\n\n52.116.132.187             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n52.116.136.206             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n52.116.136.220             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n`}</code></pre>\n    <h3>{`Modules`}</h3>\n    <p>{`Ansible uses `}<a parentName=\"p\" {...{\n        \"href\": \"http://docs.ansible.com/modules_by_category.html\"\n      }}>{`modules`}</a>{` to perform most tasks. In this example we’ll use a few modules to install packages for Ubuntu, executing commands, writing files, and handling the services.`}</p>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Running a single module`}</strong></p>\n      <p>{`It’s possible to just execute a single module or task with the `}<inlineCode parentName=\"p\">{`ansible`}</inlineCode>{` command. This is very handy when you need to execute a command for a group of hosts. However, excessive use of this approach is a bad practice, if this command is required frequently then it should be in a role or playbook.`}</p>\n      <p>{`An example of a single task or module execution is the previous ansible line using `}<inlineCode parentName=\"p\">{`ping`}</inlineCode>{` to verify the hosts are accessible. Another example may be using the `}<inlineCode parentName=\"p\">{`apt`}</inlineCode>{` module to install a package:`}</p>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-bash\"\n        }}>{`ansible all -s -m apt -a 'pkg=nginx state=installed update_cache=true'\n`}</code></pre>\n    </InlineNotification>\n    <p>{`In the `}<inlineCode parentName=\"p\">{`logdna/tasks/install.yaml`}</inlineCode>{` file use the following modules to install the LogDNA packages.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=logdna/tasks/install.yaml\",\n        \"path\": \"logdna/tasks/install.yaml\"\n      }}>{`- name: LogDNA Agent Package Public Key\n  apt_key:\n    url: https://repo.logdna.com/logdna.gpg\n\n- name: LogDNA Agent Repository\n  apt_repository:\n    repo: deb https://repo.logdna.com stable main\n\n- name: Install LogDNA Agent\n  apt:\n    state: present\n    name: logdna-agent\n    allow_unauthenticated: true\n    update_cache: true\n`}</code></pre>\n    <p>{`Every task can start with the key `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` to document or describe the task, this text is printed on the console when it’s executed. All the modules in this file deal with `}<inlineCode parentName=\"p\">{`apt`}</inlineCode>{`, the package manager of Debian and Ubuntu. Here are links to the documentation of each module to know the different parameters that can be used.`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://docs.ansible.com/ansible/latest/modules/apt_key_module.html\"\n        }}>{`apt_key`}</a>{` is used to add, remove or download apt keys`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://docs.ansible.com/ansible/latest/modules/apt_repository_module.html\"\n        }}>{`apt_repository`}</a>{` to add or remove APT repositories`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://docs.ansible.com/ansible/latest/modules/apt_module.html\"\n        }}>{`apt`}</a>{` to install, remove, upgrade, update and manage in general APT packages on Debian and Ubuntu`}</li>\n    </ul>\n    <p>{`Create the file `}<inlineCode parentName=\"p\">{`logdna/tasks/configure.yaml`}</inlineCode>{` to execute the tasks to configure LogDNA.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=logdna/tasks/configure.yaml\",\n        \"path\": \"logdna/tasks/configure.yaml\"\n      }}>{`- name: Setting LogDNA Ingestion Key\n  shell: \"logdna-agent -k {{ conf_key }}\"\n  when: conf_key != \"\"\n\n- name: Adding Log Directories\n  shell: \"logdna-agent -d {{ conf_logdir }}\"\n  when: conf_logdir != \"\"\n\n- name: Adding API Host\n  shell: \"logdna-agent -s LOGDNA_APIHOST={{ logdna_api_host }}\"\n  when: logdna_api_host != \"\"\n\n- name: Adding Log Host\n  shell: \"logdna-agent -s LOGDNA_LOGHOST={{ logdna_log_host }}\"\n  when: logdna_log_host != \"\"\n\n- name: Setting Tags for This Host\n  shell: \"logdna-agent -t {{ conf_tags }}\"\n  when: conf_tags != \"\"\n`}</code></pre>\n    <p>{`In this file we only use the `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/modules/shell_module.html\"\n      }}>{`shell`}</a>{` module to execute commands on the host. This module is useful when there is no module to do the tasks we want or need. However, exercise caution with the shell module because the outcome of the execution of these commands may not be idempotent, breaking the main characteristics of Ansible.`}</p>\n    <p>{`Here we use the `}<inlineCode parentName=\"p\">{`when`}</inlineCode>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html\"\n      }}>{`conditional directive`}</a>{` to execute a task only if the output of the condition is True.`}</p>\n    <p>{`In this file we also use `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html\"\n      }}>{`Ansible variables`}</a>{` enclosed with `}<inlineCode parentName=\"p\">{`{{ }}`}</inlineCode>{`, these variables can be set in different forms, in our case we’ll set them in the inventory and the default values in the role.`}</p>\n    <p>{`The default variable values or the role variable values are important in case you execute this role alone on any environment. For example to test the role or playbook with Vagrant or Docker and the default variable values will be used. Other sources of the role variables is they can be local variables, you may have variables that are set from other values provided by the user or constant values. Define some variable default values in the role file `}<inlineCode parentName=\"p\">{`roles/logdna/defaults/main.yaml`}</inlineCode>{`:`}</p>\n    {\n      /* TODO: find default values for the following variables */\n    }\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=logdna/defaults/main.yaml\",\n        \"path\": \"logdna/defaults/main.yaml\"\n      }}>{`conf_tags: \"\"\nconf_logdir: \"\" # default to /var/log\n\nlogdna_api_host: api.us-south.logging.cloud.ibm.com\nlogdna_log_host: logs.us-south.logging.cloud.ibm.com\n`}</code></pre>\n    <p>{`We are not setting a default for `}<inlineCode parentName=\"p\">{`conf_key`}</inlineCode>{` because the log ingestion key is only provided by the user and associated with a specific service instance. Values for variables provided by the user come from the inventory file `}<inlineCode parentName=\"p\">{`inventory.yaml`}</inlineCode>{` so we add the following variables in the `}<inlineCode parentName=\"p\">{`vars:`}</inlineCode>{` section (update with values from your LogDNA instance, the api and log host may be the same if you are using us-south).`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`all:\n  vars:\n    ansible_user: ubuntu\n    ansible_ssh_private_key_file: ~/.ssh/id_rsa\n    ansible_ssh_common_args: \"-o StrictHostKeyChecking=no\"\n\n    # Input Variables:\n    conf_key: e86611977....\n    conf_logdir: /var/log\n    conf_tags: app=movies,environment=dev\n    logdna_api_host: api.us-south.logging.cloud.ibm.com\n    logdna_log_host: logs.us-south.logging.cloud.ibm.com\n\n  children:\n    appservers:\n      hosts:\n        52.116.136.206:\n        52.116.132.187:\n        52.116.136.220:\n`}</code></pre>\n    <p>{`The last step in the LogDNA install is to startup the LogDNA agent service, let’s do that in the file `}<inlineCode parentName=\"p\">{`logdna/tasks/service.yaml`}</inlineCode>{`, like so.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=logdna/tasks/service.yaml\",\n        \"path\": \"logdna/tasks/service.yaml\"\n      }}>{`- name: Activating LogDNA Agent Service\n  shell: \"update-rc.d logdna-agent defaults\"\n\n- name: Start LogDNA agent\n  service:\n    name: logdna-agent\n    enabled: true\n    state: \"{{ agent_service }}\"\n  when: (conf_key != \"\" and agent_service) or agent_service == \"stopped\"\n\n- debug:\n    msg: \"LogDNA Agent has {{ agent_service }}!\"\n  when: (conf_key != \"\" and agent_service) or agent_service == \"stopped\"\n`}</code></pre>\n    <p>{`Here we again use the `}<inlineCode parentName=\"p\">{`shell`}</inlineCode>{` module to activate the service and the module `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.ansible.com/ansible/latest/modules/service_module.html\"\n      }}>{`service`}</a>{` to set the state of the service to the value of the variable `}<inlineCode parentName=\"p\">{`agent_service`}</inlineCode>{`. The possible values, according to the documentation, can be `}<inlineCode parentName=\"p\">{`started`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`stopped`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`restarted`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`reloaded`}</inlineCode>{`. Again, we use the directive `}<inlineCode parentName=\"p\">{`when`}</inlineCode>{` to print the message notifying the state of the agent.`}</p>\n    <p>{`This also requires to add the variable `}<inlineCode parentName=\"p\">{`agent_service`}</inlineCode>{` to the default role variables, not to the inventory because in this user case the required action is to have the service up and running.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=logdna/defaults/main.yaml\",\n        \"path\": \"logdna/defaults/main.yaml\"\n      }}>{`agent_service: started\nlogdna_api_host: api.us-south.logging.cloud.ibm.com\nlogdna_log_host: logs.us-south.logging.cloud.ibm.com\n`}</code></pre>\n    <p>{`To link all these files to the playbook we call them from the `}<inlineCode parentName=\"p\">{`main.yaml`}</inlineCode>{` file of the role, replace the content of the file for the following lines.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/main.yaml\",\n        \"path\": \"roles/logdna/tasks/main.yaml\"\n      }}>{`- include_tasks: ./install.yaml\n\n- include_tasks: ./configure.yml\n\n- include_tasks: ./service.yaml\n`}</code></pre>\n    <p>{`To run this code to let Ansible install and configure LogDNA on every host created we just need to execute the `}<inlineCode parentName=\"p\">{`ansible-playbook`}</inlineCode>{` command like before.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ansible-playbook -i inventory.yaml ./playbook.yaml\n`}</code></pre>\n    <p>{`After this has completed running, you can open the LogDNA dashboard and then connect to one of the virtual machines over ssh.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`IPADDR=$(terraform output -json ip_address | jq .[0] | tr -d \\\\\")\nssh ubuntu@$IPADDR\n`}</code></pre>\n    <p>{`Over in LogDNA output similar to the following will appear as a result of the login to the system.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"22.916666666666668%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2klEQVQY04WQ246EIBBE/Q0B44Xl1oIKqDvZ//+vWnDGyST7sA+VrlS6TwqaYBWi6hH0BGVneD8jVAV/aVnCNWs+E73nPBMcWSitMA4DpmksmtBkb/FDI3bSoCXh2BP2nJBzLD7jPPbiE1KKiNtadgjDNEAIga7rwAUH4wyMMbRtiyZ5g4cbkZwChQ3HfRy3J/A8kIqv2ZZWOGdhjYExGrq0k18S/dhDdAKc8Qq0FzBX4BL/AL9fwFyyVFrfX0DkILUE5/xqV1X9v8DzfD65AsPqIY18Az5BN/gXfYOURF/q1SUAAAAASUVORK5CYII=')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Screenshot from LogDNA\",\n        \"title\": \"Login information from instance in LogDNA\",\n        \"src\": \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/3cbba/LogDNA_log.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/7fc1e/LogDNA_log.png 288w\", \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/a5df1/LogDNA_log.png 576w\", \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/3cbba/LogDNA_log.png 1152w\", \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/0b124/LogDNA_log.png 1728w\", \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/4ea69/LogDNA_log.png 2304w\", \"/cloud-enterprise-examples/static/ed55f28063fd78f74a5a029405c3358e/b3e5a/LogDNA_log.png 2678w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`This completes the walk through of the general Ansible flow. Next, this example will show how to integrate Terraform with Ansible working from the `}<inlineCode parentName=\"p\">{`12-ansible`}</inlineCode>{` folder where the final code resides. To clean up from the `}<inlineCode parentName=\"p\">{`start`}</inlineCode>{` directory, execute `}<inlineCode parentName=\"p\">{`terraform destroy`}</inlineCode>{` before moving on to the next section.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n    <h2>{`Ansible and Terraform Integration`}</h2>\n    <p>{`Everything to this point of the example still requires the user to manually configure the values in the inventory and then execute Ansible manually. To automate this process we use Terraform to manage all of the steps, chaining to the Ansible execution. After the changes shown here, `}<inlineCode parentName=\"p\">{`terraform`}</inlineCode>{` it will be the only command to execute.`}</p>\n    <p>{`Change to the `}<inlineCode parentName=\"p\">{`12-ansible`}</inlineCode>{` folder to review the final code and create the `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` file specified below.`}</p>\n    <p>{`The first part is to automatically populate the Ansible inventory file. This is done with Terraform template files. Move the `}<inlineCode parentName=\"p\">{`inventory.yaml`}</inlineCode>{` file to a new `}<inlineCode parentName=\"p\">{`templates`}</inlineCode>{` directory and rename it to `}<inlineCode parentName=\"p\">{`templates/inventory.tmpl.yaml`}</inlineCode>{` with the following content.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=templates/inventory.tmpl.yaml\",\n        \"path\": \"templates/inventory.tmpl.yaml\"\n      }}>{`all:\n  vars:\n    ansible_user: ubuntu\n    ansible_ssh_private_key_file: \\${private_key_file}\n    ansible_ssh_common_args: \"-o StrictHostKeyChecking=no\"\n\n    # Input Variables:\n    conf_key: \\${logdna_ingestion_key}\n    conf_logdir: /var/log\n    conf_tags: app=\\${project_name},environment=\\${environment}\n    logdna_api_host: \\${logdna_api_host}\n    logdna_log_host: \\${logdna_log_host}\n\n  children:\n\\${appservers}\n`}</code></pre>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`LogDNA ingestion key`}</strong></p>\n      <p>{`This Terraform code does not include the provisioning or configuration of LogDNA on IBM Cloud. This has to be done manually following the instructions from the `}<a parentName=\"p\" {...{\n          \"href\": \"logging/content-overview\"\n        }}>{`Logging pattern`}</a>{`. Once the instance is created, get the service instance Ingestion Key and the API and Log hostnames to set them in the terraform variables as explained below.`}</p>\n    </InlineNotification>\n    <p>{`This architecture design requires direct access from your host to the provisioned instances, therefore every instance requires a public Floating IP, enable the Floating IPs by adding to the `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_floating_ip\" \"iac_app_floating_ip\" {\n  name   = \"\\${var.project_name}-\\${var.environment}-ip-\\${format(\"%02s\", count.index)}\"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n  count  = var.max_size\n}\n`}</code></pre>\n    <p>{`The Terraform code to generate the template is as follows, in a new file called `}<inlineCode parentName=\"p\">{`configuration.tf`}</inlineCode>{` to handle all the Ansible configuration.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=configuration.tf\",\n        \"path\": \"configuration.tf\"\n      }}>{`data \"template_file\" \"inventory\" {\n  depends_on = ibm_is_instance.iac_app_instance\n  template = file(\"\\${path.module}/inventory.yaml\")\n  vars = {\n    private_key_file = pathexpand(var.private_key_file)\n    logdna_ingestion_key = var.logdna_ingestion_key\n    project_name = var.project_name\n    environment = var.environment\n    logdna_api_host = var.logdna_api_host\n    logdna_log_host = var.logdna_log_host\n    appservers = format(\"    appservers:\\\\n      hosts:\\\\n%s\", join(\"\", formatlist(\"        %s:\\\\n\", ibm_is_floating_ip.iac_app_floating_ip[*].address)))\n  }\n}\n\n\ndata \"local_file\" \"inventory\" {\n  filename = \"\\${path.module}/inventory.yaml\"\n  content  = data.template_file.inventory.rendered\n}\n`}</code></pre>\n    <p>{`Notice the use of `}<inlineCode parentName=\"p\">{`format`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`formatlist`}</inlineCode>{` to render from the list of Floating IP addresses `}<inlineCode parentName=\"p\">{`ibm_is_floating_ip.iac_app_floating_ip[*].address`}</inlineCode>{` output like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`    appservers:\n      hosts:\n        52.116.136.206:\n        52.116.132.187:\n        52.116.136.220:\n`}</code></pre>\n    <p>{`The template also has additional input variables for the Ansible playbook that are not created by Terraform code so they are required as Terraform user input. Add them to the `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file and the values to the `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` file (which is or should be in `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{`)`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"logdna_ingestion_key\" {}\nvariable \"logdna_api_host\" {\n  default = \"api.us-south.logging.cloud.ibm.com\"\n}\nvariable \"logdna_log_host\" {\n  default = \"logs.us-south.logging.cloud.ibm.com\"\n}\nvariable \"private_key_file\" {\n  default = \"~/.ssh/id_rsa\"\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=terraform.tfvars\",\n        \"path\": \"terraform.tfvars\"\n      }}>{`logdna_ingestion_key = \"e86611977....\"\nlogdna_api_host = \"api.us-south.logging.cloud.ibm.com\"\nlogdna_log_host = \"logs.us-south.logging.cloud.ibm.com\"\n`}</code></pre>\n    <p>{`Executing this code will generate a `}<inlineCode parentName=\"p\">{`inventory.yaml`}</inlineCode>{` file which should be ignored in the GitHub repository as it’s a dynamically generated file, so add the filename to the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`echo 'inventory.yaml' >> .gitignore\n`}</code></pre>\n    <p>{`Having the inventory ready everything ready to execute `}<inlineCode parentName=\"p\">{`ansible-playbook`}</inlineCode>{` but the idea is to automate everything so we are going to make Terraform execute Ansible for us with the following `}<inlineCode parentName=\"p\">{`local-exec`}</inlineCode>{` provisioner inside a `}<inlineCode parentName=\"p\">{`null_resource`}</inlineCode>{` block in the `}<inlineCode parentName=\"p\">{`configuration.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`resource \"null_resource\" \"ansible\" {\n  depends_on = [local_file.inventory]\n\n  provisioner \"local-exec\" {\n    command = \"ansible-playbook -i \\${path.module}/inventory.yaml \\${path.module}/playbook.yml\"\n  }\n}\n`}</code></pre>\n    <p>{`This is fine but the Ansible command has to be executed when the instance is up and running and as we know Terraform (with this example) doesn’t know when the instance is ready. For example, the Cloud-Init code may be still running when Terraform ends. There is a trick to overcome this. Running a `}<inlineCode parentName=\"p\">{`remote_exec`}</inlineCode>{` to execute any command in the instance will make Terraform to wait for the Floating IP and the instance to be ready.`}</p>\n    <p>{`Add the following `}<inlineCode parentName=\"p\">{`null_resource.waiter`}</inlineCode>{` block into the `}<inlineCode parentName=\"p\">{`configuration.tf`}</inlineCode>{` file and make the `}<inlineCode parentName=\"p\">{`template_file.inventory`}</inlineCode>{` to depend on it.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`resource \"null_resource\" \"waiter\" {\n  depends_on = [ibm_is_instance.iac_app_instance, ibm_is_floating_ip.iac_app_floating_ip]\n\n  count  = var.max_size\n\n  provisioner \"remote_exec\" {\n    inline = [\"hostname\"]\n\n    connection {\n      user = \"ubuntu\"\n      host = ibm_is_floating_ip.iac_app_floating_ip[count.index].address\n      private_key = file(pathexpand(var.private_key_file))\n      timeout = \"5m\"\n    }\n  }\n}\n\ndata \"template_file\" \"inventory\" {\n  depends_on = [null_resource.waiter]\n  ...\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`null_resource.waiter`}</inlineCode>{` resource makes a connection to every provisioned instance to execute any command, i.e. `}<inlineCode parentName=\"p\">{`hostname`}</inlineCode>{`, when the connection and the command is successfully completed to every instance then Terraform will proceed to generate the inventory and execute ansible (remember ansible execution depends on the inventory).`}</p>\n    <p>{`As we are using a new providers (`}<inlineCode parentName=\"p\">{`templates`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`null`}</inlineCode>{`), we need to execute `}<inlineCode parentName=\"p\">{`terraform init`}</inlineCode>{`, then we can plan and apply the code changes`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init\nterraform plan\nterraform apply\n`}</code></pre>\n    <p>{`Terraform will do the provisioning and generate the inventory file, when all the instances are up and ready it executes Ansible to install and configure LogDNA on every provisioned instance.`}</p>\n    <p>{`Notice that the Ansible logs went to the Terraform logs, if you’d like to have them in a different file as well for better analysis (i.e. if the playbook fails) modify the Ansible execution in the `}<inlineCode parentName=\"p\">{`local_exec`}</inlineCode>{` provider to the following line and add the `}<inlineCode parentName=\"p\">{`ansible.log`}</inlineCode>{` file to the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`  command = \"ansible-playbook -i \\${path.module}/inventory.yaml \\${path.module}/playbook.yaml | tee --append \\${path.module}/ansible.log\"\n`}</code></pre>\n    <p>{`To test your code, as before, execute the following `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{` command to check the API but now you can go to the LogDNA Web Console and review the log analysis from the nodes.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`curl $(terraform output entrypoint)/movies/675\n`}</code></pre>\n    <h2>{`Final Terraform and Ansible Code`}</h2>\n    <p>{`All the developed code can be downloaded or cloned from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/12-ansible\"\n      }}>{`12-ansible`}</a>{` where the new or modified files are:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=configuration.tf\",\n        \"path\": \"configuration.tf\"\n      }}>{`resource \"null_resource\" \"waiter\" {\n  depends_on = [ibm_is_instance.iac_app_instance, ibm_is_floating_ip.iac_app_floating_ip]\n\n  count = var.max_size\n\n  provisioner \"remote-exec\" {\n    inline = [\"hostname\"]\n\n    connection {\n      user        = \"ubuntu\"\n      host        = ibm_is_floating_ip.iac_app_floating_ip[count.index].address\n      private_key = file(pathexpand(var.private_key_file))\n      timeout     = \"5m\"\n    }\n  }\n}\n\ndata \"template_file\" \"inventory\" {\n  depends_on = [null_resource.waiter]\n\n  template = file(\"\\${path.module}/templates/inventory.tmpl.yaml\")\n  vars = {\n    private_key_file     = pathexpand(var.private_key_file)\n    logdna_ingestion_key = var.logdna_ingestion_key\n    project_name         = var.project_name\n    environment          = var.environment\n    logdna_api_host      = var.logdna_api_host\n    logdna_log_host      = var.logdna_log_host\n    appservers           = format(\"    appservers:\\\\n      hosts:\\\\n%s\", join(\"\", formatlist(\"        %s:\\\\n\", ibm_is_floating_ip.iac_app_floating_ip[*].address)))\n  }\n}\n\nresource \"local_file\" \"inventory\" {\n  filename = \"\\${path.module}/inventory.yaml\"\n  content  = data.template_file.inventory.rendered\n}\n\nresource \"null_resource\" \"ansible\" {\n  depends_on = [local_file.inventory]\n\n  provisioner \"local-exec\" {\n    command = \"ansible-playbook -i \\${path.module}/inventory.yaml \\${path.module}/playbook.yaml | tee --append \\${path.module}/ansible.log\"\n  }\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=templates/inventory.tmpl.yaml\",\n        \"path\": \"templates/inventory.tmpl.yaml\"\n      }}>{`all:\n  vars:\n    ansible_user: ubuntu\n    ansible_ssh_private_key_file: \\${private_key_file}\n    ansible_ssh_common_args: \"-o StrictHostKeyChecking=no\"\n\n    # Input Variables:\n    conf_key: \\${logdna_ingestion_key}\n    conf_logdir: /var/log\n    conf_tags: app=\\${project_name},environment=\\${environment}\n    logdna_api_host: \\${logdna_api_host}\n    logdna_log_host: \\${logdna_log_host}\n\n  children:\n\\${appservers}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"public_key\" {}\n\nvariable \"logdna_ingestion_key\" {}\nvariable \"logdna_api_host\" {\n  default = \"api.us-south.logging.cloud.ibm.com\"\n}\nvariable \"logdna_log_host\" {\n  default = \"logs.us-south.logging.cloud.ibm.com\"\n}\nvariable \"private_key_file\" {\n  default = \"~/.ssh/id_rsa\"\n}\n\nvariable \"port\" {\n  default = 8080\n}\nvariable \"max_size\" {\n  default = 3\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=playbook.yaml\",\n        \"path\": \"playbook.yaml\"\n      }}>{`- hosts: all\n  become: yes\n  roles:\n    - role: logdna\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/main.yaml\",\n        \"path\": \"roles/logdna/tasks/main.yaml\"\n      }}>{`- include_tasks: ./install.yaml\n\n- include_tasks: ./configure.yaml\n\n- include_tasks: ./service.yaml\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/install.yaml\",\n        \"path\": \"roles/logdna/tasks/install.yaml\"\n      }}>{`- name: LogDNA Agent Package Public Key\n  apt_key:\n    url: https://repo.logdna.com/logdna.gpg\n\n- name: LogDNA Agent Repository\n  apt_repository:\n    repo: deb https://repo.logdna.com stable main\n\n- name: Install LogDNA Agent\n  apt:\n    state: present\n    name: logdna-agent\n    allow_unauthenticated: true\n    update_cache: true\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/configure.yaml\",\n        \"path\": \"roles/logdna/tasks/configure.yaml\"\n      }}>{`- name: Setting LogDNA Ingestion Key\n  shell: \"logdna-agent -k {{ conf_key }}\"\n  when: conf_key != \"\"\n\n- name: Adding Log Directories\n  shell: \"logdna-agent -d {{ conf_logdir }}\"\n  when: conf_logdir != \"\"\n\n- name: Adding API Host\n  shell: \"logdna-agent -s LOGDNA_APIHOST={{ ubuntu_api_host }}\"\n  when: ubuntu_api_host != \"\"\n\n- name: Adding Log Host\n  shell: \"logdna-agent -s LOGDNA_LOGHOST={{ ubuntu_log_host }}\"\n  when: ubuntu_log_host != \"\"\n\n- name: Setting Tags for This Host\n  shell: \"logdna-agent -t {{ conf_tags }}\"\n  when: conf_tags != \"\"\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/tasks/service.yaml\",\n        \"path\": \"roles/logdna/tasks/service.yaml\"\n      }}>{`- name: Activating LogDNA Agent Service\n  shell: \"update-rc.d logdna-agent defaults\"\n\n- name: Start LogDNA agent\n  service:\n    name: logdna-agent\n    enabled: true\n    state: \"{{ agent_service }}\"\n  when: (conf_key != \"\" and agent_service) or agent_service == \"stopped\"\n\n- debug:\n    msg: \"LogDNA Agent has {{ agent_service }}!\"\n  when: (conf_key != \"\" and agent_service) or agent_service == \"stopped\"\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\",\n        \"metastring\": \"path=roles/logdna/defaults/main.yaml\",\n        \"path\": \"roles/logdna/defaults/main.yaml\"\n      }}>{`conf_tags: \"\"\nconf_logdir: \"\" # default to /var/log\n\nubuntu_api_host: api.us-south.logging.cloud.ibm.com\nubuntu_log_host: logs.us-south.logging.cloud.ibm.com\nagent_service: started\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_vpc\" \"iac_app_vpc\" {\n  name = \"\\${var.project_name}-\\${var.environment}-vpc\"\n}\n\nresource \"ibm_is_subnet\" \"iac_app_subnet\" {\n  name            = \"\\${var.project_name}-\\${var.environment}-subnet\"\n  vpc             = ibm_is_vpc.iac_app_vpc.id\n  zone            = \"us-south-1\"\n  ipv4_cidr_block = \"10.240.0.0/24\"\n}\n\nresource \"ibm_is_security_group\" \"iac_app_security_group\" {\n  name = \"\\${var.project_name}-\\${var.environment}-sg-public\"\n  vpc  = ibm_is_vpc.iac_app_vpc.id\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_all_outbound\" {\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"outbound\"\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_http\" {\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  tcp {\n    port_min = var.port\n    port_max = var.port\n  }\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_ssh\" {\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  tcp {\n    port_min = 22\n    port_max = 22\n  }\n}\n\nresource \"ibm_is_floating_ip\" \"iac_app_floating_ip\" {\n  name   = \"\\${var.project_name}-\\${var.environment}-ip-\\${format(\"%02s\", count.index)}\"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n  count  = var.max_size\n}\n`}</code></pre>\n    <p>{`Optionally, you can have a `}<inlineCode parentName=\"p\">{`ansible.cfg`}</inlineCode>{` to add more settings, if required.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-ini\"\n      }}>{`[defaults]\nhost_key_checking = False\n`}</code></pre>\n    <p>{`It’s required to have a `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` file with the variables values or set them in environment variables. Use this example to create your `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=terraform.tfvars\",\n        \"path\": \"terraform.tfvars\"\n      }}>{`project_name = \"iac-ansible-test\"\nenvironment  = \"dev\"\nport         = \"8080\"\npublic_key   = \"ssh-rsa AAAAB3....\"\n\nlogdna_ingestion_key = \"e86611977....\"\nlogdna_api_host      = \"api.us-south.logging.cloud.ibm.com\"\nlogdna_log_host      = \"logs.us-south.logging.cloud.ibm.com\"\n`}</code></pre>\n    <h2>{`Ansible from a Bastion Host`}</h2>\n    <p>{`The previous design is functional but there is a dimension that may not be preferred in all cases. The Floating IPs and the open access to all the nodes from a single host, namely the workstation running Terraform and Ansible. A solution to avoid a requirement for Floating IPs is to have a Bastion Host. Access to the instances for configuration management can be done from a single host, the Bastion Host, and access controls are placed around this host which is used from the perimeter of the VPC to perform Ansible configuration management.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"781px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"56.59722222222222%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADVElEQVQoz2N49PTlkiPHTh18/PTVlhevPskxMDAwJc6w5k/uDOb4/5+BAYhQgLKapZpMUN4M2axqdz6fWgH+8GxeBs9qHqmobD6Z0HJehgcPnzzdtHnb/8tXrv8HAiUGhkNsya4fgj3sz4q7i0xmV20/IuLacbbStuW0D8xQ8bYcD6MJlhH/L9fzOE8W4VyzTp3PaIIYl0Dnag6GDRs33OrrWvF/+fIdn27f/WfEwLCFKdn1bUWQ86VLWjLTVXxaHwWf+/T/f9fmh+cYGK5w6utdkgQZ+r1fU/11t8nc101Kqm96zVfu6JbkZyi5wMpw5OixO/PnLf5/+vSFL//+/dcAKU7ze6WU4PYiHsSO7TpvMGvXzWeTdz7qAfFDw65LiOWvEL5SwMv/MlnX4naqJM+rZG1rr8XMbNzV8zkYXr1+d+f9h4//X7x89fnCxQeGDAxvWOYu+M8anvBRXEi+S4CNiUG3saF+Zl5OZg7QPJHHh+cwM0TfErncHqD/rtVg0vMGNZW3babzV81R5GfIP8XK8Obthzvff/z+//7D5y89PX0pElIS4iCXiGqusmEQqfUFMlWBmAsUdJxcvAalEcsZGQqLuRcnNcq/9JN3vBvKz/s6SMHZag8nK3/FbA6Gtx+/3vnx5///d+8/fe3s6vEDauQGRg6zkEymOgObkQkTI4O8ppYuj4ioGD8rG7taaWwLC0NwIevphlD9l3Vmk75UCci/r9KetmipFC9D7jE2hnuXrtx5dO3G/5dvP3z59+eXEsh1VdX/+YEUIyMDAyswFYkA2ZJAniQvv6BAbXwfC0OWLcvVknKTz7N6v3149vDWlw1z3x36vEqIgTeGheHizt239y1d+n/PoeOfTx37DIzl/6wLFz5jZsABYl0S2RgcLVgfT2vRe9ff9eX/+hX/f509+PjC/70CDOw+rAxnL155eODIsf8HDx7++eHjN3WQpv//nzBqa+eiGMQnLMEYkVnCFOQWx8YQmsW6sCpQ/+js2t8/t834f3vHtA/zWnUEGAr3sjI8ffbi+K1bt989fvLszpevP8BefvzkIyM4+aT9Y4jKaQUbaOkZx1DSMZfJzT2GlUE/mm3t+oVRBzbM3n9i56yG+hQXf8tiT0HO/mNsACrTasYM8vawAAAAAElFTkSuQmCC')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Ansible at Bastion Host\",\n        \"title\": \"Running Ansible from Bastion Host\",\n        \"src\": \"/cloud-enterprise-examples/static/149c95568b9cc80031cdf250c2dbdbaf/1ec2b/IaC-Ansible_Design_2.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/149c95568b9cc80031cdf250c2dbdbaf/7fc1e/IaC-Ansible_Design_2.png 288w\", \"/cloud-enterprise-examples/static/149c95568b9cc80031cdf250c2dbdbaf/a5df1/IaC-Ansible_Design_2.png 576w\", \"/cloud-enterprise-examples/static/149c95568b9cc80031cdf250c2dbdbaf/1ec2b/IaC-Ansible_Design_2.png 781w\"],\n        \"sizes\": \"(max-width: 781px) 100vw, 781px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`The Terraform and Ansible code for this has not been developed but it can be done in a later release to this pattern guide. Terraform first provisions the environment and also the Bastion Host with Ansible and send all playbooks to the host (if they are not already present). Then Terraform generates the inventory and uploads it to the host to finally execute Ansible remotely to configure all the hosts.`}</p>\n    <p>{`Another scenario for using a Bastion Host is in the use of IBM Cloud Schematics. In this example, we are executing Ansible from our host but with Schematics there is no host where it can install and execute Ansible, unless you create a instance or docker container to help you this task. Having a Bastion Host, Schematics can use it to execute Ansible and configure all the provisioned instances.`}</p>\n    <h2>{`Clean up`}</h2>\n    <p>{`To clean up everything just execute `}<inlineCode parentName=\"p\">{`terraform destroy`}</inlineCode>{`. As we are not using Schematics there is no need to run `}<inlineCode parentName=\"p\">{`ibmcloud`}</inlineCode>{` to make Schematics destroy the resources and the workspace.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}