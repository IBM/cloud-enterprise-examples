{"version":3,"sources":["webpack:///./src/pages/iac-resources/network/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","small","isMDXComponent"],"mappings":"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","file":"component---src-pages-iac-resources-network-index-mdx-7918efb7d46abcc9129e.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`IaC to manage Network Services Resources`}</p>\n    </PageDescription>\n    <p>{`Every infrastructure requires network resources in order to build everything on top of it. This page explain all the Network Resources needed to provision and deploy an application exposing an API about movies. The following diagram shows the network architecture to build in this page.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"762px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"117.01388888888889%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAEXUlEQVQ4y4WUa2gcVRTHp7XZpNlNSk229ZMPCn6LVAuKSAnURBGhflMiYpE2UdRqMDZQailRRFoREbH4qP2gScQvPj60K6UiqJRqax4mzZPNZndn7rzfj33N7PHcmdlmrY/O8tt753/PPXPO/zLDMAyzD+lD7kceQh5A+uP53cjeOObBeE7Xe5B7kUeRnQizfecdTOO6HbkL2YXcibQiyZi2mFST1ryWiuM3I7eEpFLbbmtLJLq2tie7tra2bk+1t6c6k8kkpSOZTFE6Uyk6TzbpyUjHP4xHOpJtbR1btrR0MLv29A329D+d3t37xI69B461P37045aHX3qnte/wqcQjw+8lel94O9Hz5GuJ3QNHwnn/K+8m+nGNjn0vnwxjHhv5INE3/H7inv0vtjDpV8f3bx7+tpdhbk3EpW/6B12AI9n0r2tNpI5fbGX2vXF2R7ZAvlZU9UdZkc5LsvQDjhmKosoZjrCZ2T9nMnPzcxlCuIyKWmO9Ke6iwJPJgdMXUsyVc9B9Yf68sKIvAL3qUIMA/PAXhL8aVGolqNbKUKvXQrWOQIyPGr0kRbSPfjXVyYyc+iadI7ksr6tQUOxqVjJ9Qbd923F9w3J8oln+umL7edX2NbynumLgvWL6axjLa3bV9jwQZYEbnfyjk3nq2Om0riu5c9cE+HmBDfKsCJyogWG7sMprMHF5DVbzAhSIDJxigoebv58pwE/zRShwYWygu2VaoTA6cbWTGXrz87QgCznJ8uimgMuzwAoqiJoFumlDXtSBLRDgWAFYyQDDsoFg4jx9AMZyghoothcl/PL3RkIxZzgeEKsSELcGnIlP1Mxos4agRhzUVTvUZFzjrArEsYGK3YQJxxsJFTGnocgZXkCsMnA6eqJGCTnFAqqFuhJpkmoAa3gQxwaq1Zxw7EyU0HKAzZOAWysAW+RBVHTc7ABHJOByReDW0QqcU01SjMiGHMYW+EA16UMkYfSLyxst604JOMkIOPSGeiWhh1GFJvUpQo4rxJZZ2QAaS/eoDQ9phYNxyyqt0CzFHpY2WkbfqH+Rh1bcMvWwvOHh9ZavdDLPv3U2zeMpu6UARLMaEAMr1TBAbaoQ/QrBCvWGh7oLhGqa83cPnz3xYVpW1dyv2V9gdn0qEHUJWxJBMTQwbQdUzbiOglBNN61wHuqqEVhu3PIEVvjciY/SkqLk5sgULGUvBXx2GgR+ESSdB8d1wb0Rx7lRCyrVSpjwyORV2vJn2LKY80oWyCaHFRZBMApYJU3ohQmcZjBJ873rNCWM3pRP8ZSlnG5LwFvFQHSFumAV65JK6piwjpv+l6aEfFjh4NgneMrSmmZKIKjrNVEr+jj6ssr7rlfysSXE+w9c33O9WrkSvstkhB7K4ZPj3UQiQhU/U7Zng1N2QtyyC+Vq6aaUKl74uRMkYox9t9LB3HfgePel2YWB2eXVoeml1YMzS6uHIlYOTS0u35yF5YPTiytDv81ee2bP62e2/QVuWhXtiY8VvQAAAABJRU5ErkJggg==')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Architecture\",\n        \"title\": \"Network Resources Architecture\",\n        \"src\": \"/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/1b1fd/IaC-Network_Resources.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/7fc1e/IaC-Network_Resources.png 288w\", \"/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/a5df1/IaC-Network_Resources.png 576w\", \"/cloud-enterprise-examples/static/3fb22de5630850b56a67e0b0abe6e263/1b1fd/IaC-Network_Resources.png 762w\"],\n        \"sizes\": \"(max-width: 762px) 100vw, 762px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`The code to build these resources can be downloaded from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/06-network\"\n      }}>{`06-network`}</a>{`.`}</p>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">VPC</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Subnets and Zones</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Security Groups</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Public Gateways</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Floating IP</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">VPN</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Final Terraform code</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Clean up</AnchorLink>\n    </AnchorLinks>\n    {\n      /* <AnchorLink>Network Resources & Data Sources</AnchorLink> */\n    }\n    <h2>{`VPC`}</h2>\n    <p>{`IBM Cloud Virtual Private Cloud (VPC) allows you to create your own space in the IBM Cloud, to run an isolated environment within the public cloud. VPC gives you the security of a private cloud, with the agility and ease of a public cloud.`}</p>\n    <p>{`To create a VPC with Terraform use the resource `}<inlineCode parentName=\"p\">{`ibm_is_vpc`}</inlineCode>{` providing the `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` and optionally the `}<inlineCode parentName=\"p\">{`resource_group`}</inlineCode>{`, add this code to the `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_vpc\" \"iac_app_vpc\" {\n  name = \"\\${var.project_name}-\\${var.environment}-vpc\"\n}\n`}</code></pre>\n    <p>{`More parameters are accepted, to know more about them read the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#provider-vps\"\n      }}>{`ibm_is_vpc`}</a>{` documentation.`}</p>\n    <h2>{`Subnets and Zones`}</h2>\n    <p>{`A  VPC is divided into subnets, using a range of private IP addresses. After creating the VPC you can add one or more subnets. Bu default all resources within the same VPC can communicate with each other, regardless of the subnets.`}</p>\n    <p>{`Each subnet must be contained within a single Zone and cannot span zones. Zones are distinct locations that are engineered to be isolated from failures in other Zones. By launching instances in separate Zones, you can protect your applications from the failure of a single location, helping with security, with reducing latency, and with high availability.`}</p>\n    <p>{`To create a Subnet with Terraform we use the resource `}<inlineCode parentName=\"p\">{`ibm_is_subnet`}</inlineCode>{`, it requires the `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{`, the `}<inlineCode parentName=\"p\">{`vpc`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`zone`}</inlineCode>{` where the subnet belongs.`}</p>\n    <p>{`An example of a simple subnet would be like this`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`resource \"ibm_is_subnet\" \"iac_app_subnet\" {\n  name            = \"\\${var.project_name}-\\${var.environment}-subnet\"\n  vpc             = ibm_is_vpc.iac_app_vpc.id\n  zone            = \"us-south-1\"\n  ipv4_cidr_block = \"10.240.0.0/24\"\n}\n`}</code></pre>\n    <p>{`This example creates a subnet named from the project name and environment, in the VPC previously created, in the zone `}<inlineCode parentName=\"p\">{`us-south-1`}</inlineCode>{` and with CIDR block `}<inlineCode parentName=\"p\">{`10.240.0.0/24`}</inlineCode>{`. These and other parameters are:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name of the subnet`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`vpc`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`VPC ID where the subnet is created`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`|\n`}<inlineCode parentName=\"p\">{`zone`}</inlineCode>{` | Zone name where the subnet is created |\n| `}<inlineCode parentName=\"p\">{`ipv4_cidr_block`}</inlineCode>{` | (optional) IPv4 range of the subnet |\n| `}<inlineCode parentName=\"p\">{`total_ipv4_address_count`}</inlineCode>{` | (optional) total number of IPv4 addresses |\n| `}<inlineCode parentName=\"p\">{`network_acl`}</inlineCode>{` | (optional) ID of the network ACL for the subnet |\n| `}<inlineCode parentName=\"p\">{`public_gateway`}</inlineCode>{` | (optional) ID of the public gateway for the subnet that you want to attach to the subnet. You create the public gateway with the `}<inlineCode parentName=\"p\">{`ibm_is_public_gateway`}</inlineCode>{` resource |\n| `}<inlineCode parentName=\"p\">{`resource_group`}</inlineCode>{` | (optional) ID of the resource group where you want to create the subnet |`}</p>\n    <p>{`For more information read the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#subnet\"\n      }}>{`ibm_is_subnet`}</a>{` documentation.`}</p>\n    <p>{`In our use case we need multiple subnets, append the following code to `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` to create them all using the index as part of the name.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_subnet\" \"iac_app_subnet\" {\n  count                    = local.max_size\n  name                     = \"\\${var.project_name}-\\${var.environment}-subnet-\\${format(\"%02s\", count.index)}\"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_app_vpc.id\n  total_ipv4_address_count = 16\n  public_gateway           = element(ibm_is_public_gateway.pgw.*.id, count.index)\n  resource_group           = data.ibm_resource_group.group.id\n}\n`}</code></pre>\n    <p>{`Instead of define a CIDR block lets define the total number of IP address and get the default `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc-on-classic-network?topic=vpc-on-classic-network-working-with-ip-address-ranges-address-prefixes-regions-and-subnets#ibm-cloud-vpc-and-address-prefixes\"\n      }}>{`VPC address prefixes`}</a>{`.`}</p>\n    <p>{`This code creates the subnets in different zones, defined in the list variable `}<inlineCode parentName=\"p\">{`vpc_zone_names`}</inlineCode>{` which is in the `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file like this.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"region\" {\n  default  = \"us-south\"\n}\nvariable \"vpc_zone_names\" {\n  type    = list(string)\n  default = [\"us-south-1\", \"us-south-2\", \"us-south-3\"]\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n`}</code></pre>\n    <p>{`As you can see the number of subnets to create depends on the number of zones in the list `}<inlineCode parentName=\"p\">{`vpc_zone_names`}</inlineCode>{`.`}</p>\n    <h2>{`Security Groups`}</h2>\n    <p>{`A `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-using-security-groups\"\n      }}>{`security group`}</a>{` is like a virtual firewall for your VSI to control inbound and outbound traffic through filtering rules. The default rule (create the security group without rules) denies all traffic, you need to add rules to define the filters for inbound and outbound traffic. These rules allow reverse traffic, this means a rule opening port 80 for inbound traffic also open the port 80 for outbound traffic to the original host.`}</p>\n    <p>{`To create the security groups and the rules we use the resources `}<inlineCode parentName=\"p\">{`ibm_is_security_group`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`ibm_is_security_group_rule`}</inlineCode>{`. Adding the following code to `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` we open the port defined by the user (defaults to `}<inlineCode parentName=\"p\">{`8080`}</inlineCode>{`) and port `}<inlineCode parentName=\"p\">{`22`}</inlineCode>{` to allow SSH connections (just for testing, we can remove it later) only to the VSI in the first security group.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_security_group\" \"iac_app_security_group\" {\n  name           = \"\\${var.project_name}-\\${var.environment}-sg-public\"\n  vpc            = ibm_is_vpc.iac_app_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_http\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_app_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = var.port\n    port_max = var.port\n  }\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_ssh\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n\n  tcp {\n    port_min = 22\n    port_max = 22\n  }\n}\n`}</code></pre>\n    <p>{`Other option to set access rules to the security group is through the Network Access Control List (ACL) with the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#network-acl\"\n      }}>{`ibm_is_network_acl`}</a>{` resource.`}</p>\n    <p>{`Three options are available for enabling communications from your VSI to the public internet:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Use a public gateway (PGW) to enable communication to the internet for all virtual server instances on the attached subnet. There is no charge for using a PGW, except for the bandwidth used.`}</li>\n      <li parentName=\"ul\">{`Use a Floating IP (FIP) to enable communication to and from a single VSI to the internet.`}</li>\n      <li parentName=\"ul\">{`Use a VPN gateway.`}</li>\n    </ul>\n    <h2>{`Public Gateways`}</h2>\n    <p>{`A Public Gateway (PGW) enables a subnet to connect to the Internet. PGW uses Many-to-1 NAT, which means every VSI  with private addresses will use 1 public IP address to talk to the public Internet. The PGW are tie to the VPC and the Zone, allowing internet connection to all the subnets and VSI within that zone.`}</p>\n    <p>{`To create a PGW we use the `}<inlineCode parentName=\"p\">{`ibm_is_public_gateway`}</inlineCode>{` resources like the following code appended to the `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_public_gateway\" \"pgw\" {\n  count = local.max_size\n  name  = \"\\${var.project_name}-\\${var.environment}-pgw-\\${format(\"%02s\", count.index)}\"\n  vpc   = ibm_is_vpc.iac_app_vpc.id\n  zone  = var.vpc_zone_names[count.index]\n}\n`}</code></pre>\n    <p>{`Besides the parameters in the example you can also have the optional parameters `}<inlineCode parentName=\"p\">{`resource_group`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`tags`}</inlineCode>{`. Among the output parameters we have `}<inlineCode parentName=\"p\">{`floating_ip`}</inlineCode>{` with a collection of floating IP addresses that are bound to the public gateway. Every floating IP address is listed with the floating IP `}<inlineCode parentName=\"p\">{`id`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`address`}</inlineCode>{`. To report these IP address, lets use the following output variables in the file `}<inlineCode parentName=\"p\">{`output.tf`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.tf\",\n        \"path\": \"output.tf\"\n      }}>{`output \"pgw_ip_addresses\" {\n  value = ibm_is_public_gateway.pgw[*].floating_ip.address\n}\n`}</code></pre>\n    <h2>{`Floating IP`}</h2>\n    <p>{`Floating IP addresses are IP addresses that are provided by IBM Cloud and are reachable from the public Internet. An Floating IP is linked to a VSI, Load Balancer or VPN Gateway, allowing internet access to this linked resource only.`}</p>\n    <p>{`Having a public gateway defined we do not need Floating IP but if you’d like to have them instead of PWG this is the code to add to `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` to link every Floating IP to a VSI.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tf\",\n        \"path\": \"network.tf\"\n      }}>{`resource \"ibm_is_floating_ip\" \"iac_app_floating_ip\" {\n  count  = var.max_size\n  name   = \"\\${var.project_name}-\\${var.environment}-ip-\\${format(\"%02s\", count.index)}\"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n}\n`}</code></pre>\n    <p>{`To list the Floating IPs we can use the following code with output variables.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.tf\",\n        \"path\": \"output.tf\"\n      }}>{`output \"ip_address\" {\n  value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n}\n`}</code></pre>\n    <h2>{`VPN`}</h2>\n    <p>{`The last resource to allow internet connection is Virtual Private Network (VPN), a service that is available for users to connect to their IBM Cloud VPC from the Internet, securely. This method may be the best option to connect to your VPC but it may not be suitable for every architecture or requirements.`}</p>\n    <p>{`A simple example, not to be used in this story would be like this.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`resource \"ibm_is_vpn_gateway\" \"iac_app_vpn_gateway\" {\n  name   = \"\\${var.project_name}-\\${var.environment}-vpn\"\n  subnet = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n}\n\nresource \"ibm_is_vpn_gateway_connection\" \"VPNGatewayConnection\" {\n  name          = \"\\${var.project_name}-\\${var.environment}-vpn-gw\"\n\n  vpn_gateway   = ibm_is_vpn_gateway.iac_app_vpn_gateway.id\n  peer_address  = ibm_is_vpn_gateway.iac_app_vpn_gateway.public_ip_address\n\n  preshared_key = \"VPNDemoPassword\"\n\n  local_cidrs   = [ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block]\n  peer_cidrs    = [ibm_is_subnet.iac_app_subnet[1].ipv4_cidr_block]\n}\n`}</code></pre>\n    <p>{`Having all the resources ready in the `}<inlineCode parentName=\"p\">{`network.tf`}</inlineCode>{` file and the variables set, we just need to execute the following terraform commands.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init    # Only the first time\nterraform plan\nterraform apply\n`}</code></pre>\n    <h2>{`Final Terraform code`}</h2>\n    <p>{`You can download the code from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/06-network\"\n      }}>{`06-network`}</a>{` where the main files are:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=network.tfresource \\\"ibm_is_vpc\\\" \\\"iac_app_vpc\\\" {\",\n        \"path\": \"network.tfresource\",\n        \"\\\"ibm_is_vpc\\\"\": true,\n        \"\\\"iac_app_vpc\\\"\": true,\n        \"{\": true\n      }}>{`  name = \"\\${var.project_name}-\\${var.environment}-vpc\"\n}\n\nresource \"ibm_is_subnet\" \"iac_app_subnet\" {\n  count                    = local.max_size\n  name                     = \"\\${var.project_name}-\\${var.environment}-subnet-\\${format(\"%02s\", count.index)}\"\n  zone                     = var.vpc_zone_names[count.index]\n  vpc                      = ibm_is_vpc.iac_app_vpc.id\n  total_ipv4_address_count = 16\n  public_gateway           = element(ibm_is_public_gateway.pgw.*.id, count.index)\n  resource_group           = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group\" \"iac_app_security_group\" {\n  name           = \"\\${var.project_name}-\\${var.environment}-sg-public\"\n  vpc            = ibm_is_vpc.iac_app_vpc.id\n  resource_group = data.ibm_resource_group.group.id\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_http\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_app_subnet[count.index].ipv4_cidr_block\n\n  tcp {\n    port_min = var.port\n    port_max = var.port\n  }\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_tcp_ssh\" {\n  count     = local.max_size\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"inbound\"\n  remote    = ibm_is_subnet.iac_app_subnet[0].ipv4_cidr_block\n\n  tcp {\n    port_min = 22\n    port_max = 22\n  }\n}\n\nresource \"ibm_is_security_group_rule\" \"iac_app_security_group_rule_all_outbound\" {\n  group     = ibm_is_security_group.iac_app_security_group.id\n  direction = \"outbound\"\n}\n\nresource \"ibm_is_public_gateway\" \"pgw\" {\n  count = local.max_size\n  name  = \"\\${var.project_name}-\\${var.environment}-pgw-\\${format(\"%02s\", count.index)}\"\n  vpc   = ibm_is_vpc.iac_app_vpc.id\n  zone  = var.vpc_zone_names[count.index]\n}\n\n// resource \"ibm_is_floating_ip\" \"iac_app_floating_ip\" {\n//   name   = \"\\${var.project_name}-\\${var.environment}-ip-\\${format(\"%02s\", count.index)}\"\n//   target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n//   count  = var.max_size\n// }\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"port\" {\n  default = 8080\n}\n\nvariable \"resource_group\" {\n  default = \"Default\"\n}\nvariable \"region\" {\n  default = \"us-south\"\n}\nvariable \"vpc_zone_names\" {\n  type    = list(string)\n  default = [\"us-south-1\", \"us-south-2\", \"us-south-3\"]\n}\n\nlocals {\n  max_size = length(var.vpc_zone_names)\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.rf\",\n        \"path\": \"output.rf\"\n      }}>{`// output \"ip_address\" {\n//   value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n// }\n\noutput \"pgw_ip_addresses\" {\n  value = ibm_is_public_gateway.pgw[*].floating_ip.address\n}\n`}</code></pre>\n    <h2>{`Clean up`}</h2>\n    <p>{`To clean up everything just execute:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n    {\n      /*\n      ## Network Resources & Data Sources\n      ### ibm_is_floating_ip\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-floating-ip)\n      \n      ### ibm_is_network_acl\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#network-acl)\n      \n      Reference:\n      - .\n      ### ibm_is_public_gateway\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-public-gateway)\n      \n      Reference:\n      - .\n      ### ibm_is_route\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-route)\n      \n      Reference:\n      - .\n      ### ibm_is_security_group\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#sec-group)\n      \n      Reference:\n      - .\n      ### ibm_is_security_group_rule\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#sec-group-rule)\n      \n      Reference:\n      - .\n      ### ibm_is_security_group_network_interface_attachment\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#sec-group-netint)\n      \n      Reference:\n      - .\n      ### ibm_is_subnet\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#subnet)\n      [data source](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-subnet)\n      Reference:\n      - .\n      ### ibm_is_vpc\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-vps)\n      [data source](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc)\n      Reference:\n      - [About Virtual Private Cloud](https://cloud.ibm.com/docs/vpc-on-classic?topic=vpc-on-classic-about)\n      ### ibm_is_vpc_address_prefix\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#address-prefix)\n      \n      Reference:\n      - .\n      ### ibm_is_vpn_gateway\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#vpn-gateway)\n      \n      Reference:\n      - .\n      ### ibm_is_vpn_gateway_connection\n      *Description*\n      [resource](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#vpn-gateway-connection)\n      \n      Reference:\n      - .\n      ## Network Data Sources\n      ### ibm_is_subnets\n      *Description*\n      [data source](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-subnets)\n      Reference:\n      - .\n      ### ibm_is_zone\n      *Description*\n      [data source](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-zone)\n      Reference:\n      - .\n      ### ibm_is_zones\n      *Description*\n      [data source](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-zones)\n      Reference:\n      - . */\n    }\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}