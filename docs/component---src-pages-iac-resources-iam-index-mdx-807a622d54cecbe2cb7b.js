(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{mSml:function(e,a,r){"use strict";r.r(a),r.d(a,"_frontmatter",(function(){return c})),r.d(a,"default",(function(){return g}));r("91GP"),r("rGqo"),r("yt8O"),r("Btvt"),r("RW0V"),r("q1tI");var s=r("7ljp"),t=r("013z");r("qKvR");function n(){return(n=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}var c={},o=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},i=o("PageDescription"),u=o("AnchorLinks"),p=o("AnchorLink"),l=o("InlineNotification"),m={_frontmatter:c},b=t.a;function g(e){var a=e.components,r=function(e,a){if(null==e)return{};var r,s,t={},n=Object.keys(e);for(s=0;s<n.length;s++)r=n[s],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,["components"]);return Object(s.b)(b,n({},m,r,{components:a,mdxType:"MDXLayout"}),Object(s.b)(i,{mdxType:"PageDescription"},Object(s.b)("p",null,"Automating Identity and Access Management")),Object(s.b)("p",null,"Identify and Access Management (IAM) is central to IBM Cloud access and resource controls.  Basic information about IAM and different components can be found ",Object(s.b)("a",n({parentName:"p"},{href:"https://cloud.ibm.com/docs/iam?topic=iam-iamoverview"}),"in the IAM overview")),Object(s.b)("p",null,"In this example, we will look at a terraform script which creates 4 Access Groups, and then creates 2 policies for each of these 4 Access Groups.  In order to use these scripts, you must have proper administrator access."),Object(s.b)(u,{small:!0,mdxType:"AnchorLinks"},Object(s.b)(p,{mdxType:"AnchorLink"},"IAM"),Object(s.b)(p,{mdxType:"AnchorLink"},"Resource Groups"),Object(s.b)(p,{mdxType:"AnchorLink"},"Final Terraform code"),Object(s.b)(p,{mdxType:"AnchorLink"},"Clean up")),Object(s.b)(l,{mdxType:"InlineNotification"},Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Requirements")),Object(s.b)("p",null,"To be able to execute and complete the instructions in this page, make sure you have an ",Object(s.b)("strong",{parentName:"p"},"IBM Cloud account"),": if you don’t have one yet, you can ",Object(s.b)("a",n({parentName:"p"},{href:"https://cloud.ibm.com/docs/overview?topic=overview-quickstart_lite#prereqs-lite"}),"create a Lite account")," for free."),Object(s.b)("p",null,"Also make sure you have the environment setup as explained in the ",Object(s.b)("a",n({parentName:"p"},{href:"/cloud-enterprise-examples/iac/setup-environment"}),"Setup Environment")," page to have installed the IBM Cloud CLI, logged in to your account with the IBM Cloud CLI and set the ",Object(s.b)("inlineCode",{parentName:"p"},"IC_API_KEY")," environment variable to a key which has the ability to manage IAM configuration.")),Object(s.b)("h2",null,"IAM"),Object(s.b)("p",null,"Two of the main components of IAM are:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Access Groups — contains users & services, whose access can be managed as a group."),Object(s.b)("li",{parentName:"ul"},"Policies — Policies for an access group define what access this group has to various resources.  Multiple policies can be set up for each access group, specifying various resources. Policies define role-based access at the platform and service level. There are a standard set of platform and service roles and some IBM Cloud services have special roles as documented in the individual service documentation.")),Object(s.b)("p",null,"Before you run through this example, make sure your Terraform environment is setup correctly as documented in the ",Object(s.b)("a",n({parentName:"p"},{href:"/cloud-enterprise-examples/iac/setup-environment"}),"environment setup"),".  Specifically make sure you get a list of access groups as documented in the setup document."),Object(s.b)("p",null,"To get started, in your IBM Cloud CLI, run the following command and make a list of all the access groups you have in your cloud account."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"ibmcloud iam access-groups\n")),Object(s.b)("p",null,"The example will create 4 new access groups: access-group-1, access-group-2, access-group-3, access-group-4\nThe Terraform code will then add different policies to each of the access groups. For the first two access groups, the permissions for a Kubernetes cluster administrator and an application auditor will be assigned based on the ",Object(s.b)("a",n({parentName:"p"},{href:"https://cloud.ibm.com/docs/openshift?topic=openshift-users#example-iam"}),"service example use cases"),". For the third access group, administrative access will be created for the Schematics service. For the fourth access group, administrative access will be created for the Cloud Object Storage service. For granularity, each access group collection of policies is in a single file."),Object(s.b)("p",null,"Let’s look at some of the code."),Object(s.b)("p",null,"Code to define the names for the Access Groups.  Set the variables ‘ag1’ ‘ag2’ ‘ag3’ ‘ag4’ to the names of the Access Groups we are creating."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=accessgroup.tf",path:"accessgroup.tf"}),'variable ag1{\n    type = string\n    default = "access-group-1"\n}\n\nvariable ag2{\n    type = string\n    default = "access-group-2"\n}\n\nvariable ag3{\n    type = string\n    default = "access-group-3"\n}\n\nvariable ag4{\n    type = string\n    default = "access-group-4"\n}\n')),Object(s.b)("p",null,"Let’s look at the policies for ",Object(s.b)("inlineCode",{parentName:"p"},"access-group-1"),":"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash",metastring:"path=policy-accessgroup-1.tf",path:"policy-accessgroup-1.tf"}),'resource "ibm_iam_access_group" "res_ag_1" {\n   name  = var.ag1\n   description = "Access group for Kubernetes cluster administrators"\n}\n\nresource "ibm_iam_access_group_policy" "res_ag_policy1" {\n\n  access_group_id = ibm_iam_access_group.res_ag_1.id\n  roles        = ["Administrator", "Manager"]\n  resources  {\n    service   = "containers-kubernetes"\n\n  }\n}\n\nresource "ibm_iam_access_group_policy" "res_ag_policy2" {\n\n  access_group_id = ibm_iam_access_group.res_ag_1.id\n  roles        = ["Administrator", "Manager"]\n  resources  {\n    service   = "container-registry"\n\n  }\n}\n')),Object(s.b)("p",null,"The above script is setting ‘access-group-1’ with ‘Administrator’ platform & ‘Manager’ service role to the ‘containers-kubernetes’ service, and the same for ‘container-registry’."),Object(s.b)("p",null,"Users can be added to access groups by their IBMid (email-address). The example code will add a user in the account to access groups 1, 3, and 4. You can list all of the e-mail addresses in the account using:"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"ibmcloud iam users\n")),Object(s.b)("p",null,"Select one of the user email addresses to provide when prompted by the terrraform cli."),Object(s.b)("p",null,"You can download the full example code from the GitHub repository ",Object(s.b)("a",n({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(s.b)("a",n({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/05-iam"}),"05-iam"),", and then run the following commands in IBM Cloud CLI to create the access groups and policies"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"terraform init\nterraform apply\n")),Object(s.b)("p",null,"The script will ask you to validate the creation, and upon successful execution, you should see 12 items added by the script."),Object(s.b)("p",null,"Now re-execute the following command to see the newly created access groups"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"ibmcloud iam access-groups\n")),Object(s.b)("h2",null,"Resource Groups"),Object(s.b)("p",null,"Resource Groups, as the name state, is a collection of cloud resources within an account. With all the resources in a group is easier and quick to assign user access to the resources using IAM access controls."),Object(s.b)("p",null,"To manage the Resource Groups with the IBM Cloud web console go to ",Object(s.b)("strong",{parentName:"p"},"Manage")," > ",Object(s.b)("strong",{parentName:"p"},"Account")," > ",Object(s.b)("strong",{parentName:"p"},"Account resources")," > ",Object(s.b)("strong",{parentName:"p"},"Resource groups"),". There you can create, view and modify them adding resources and manage the access to them. To delete a Resource Group it has to be empty."),Object(s.b)("p",null,"Use the IBM Cloud CLI command with the ",Object(s.b)("inlineCode",{parentName:"p"},"resources")," sub-command to manage the resources groups, like so"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"# List resource groups:\nibmcloud resource groups\n# Create:\nibmcloud resource group-create group2\n# Rename:\nibmcloud resource group-update group2 --name Admin\n# View resources:\nibmcloud resource service-instances -g Default\n# Delete:\nibmcloud resource group-delete Admin\n")),Object(s.b)("p",null,"To assign an access to a resource group using the IBM Cloud CLI use the command using the resource group name or id."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"ibmcloud iam user-policy-update USER_NAME POLICY_ID --resource-group-name RESOURCE_GROUP_NAME\nibmcloud iam user-policy-update USER_NAME POLICY_ID --resource-group-id RESOURCE_GROUP_ID\n")),Object(s.b)("p",null,"Resource Groups are not part of Networking but as it’s one of the first resources to create it’s included in this pattern."),Object(s.b)("p",null,"Create a Resource Group using the ",Object(s.b)("inlineCode",{parentName:"p"},"ibm_resource_group")," resource with the following code in the ",Object(s.b)("inlineCode",{parentName:"p"},"main.tf")," file."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=main.tf",path:"main.tf"}),'data "ibm_resource_group" "iac_app_rg" {\n  name = var.resource_group_name\n}\n')),Object(s.b)("p",null,"If the ",Object(s.b)("inlineCode",{parentName:"p"},"name")," parameter, or in this example the variable ",Object(s.b)("inlineCode",{parentName:"p"},"resource_group_name")," value, cannot be empty, it’s a a required parameter. So make sure to have at least a default value in the variables."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=variables.tf",path:"variables.tf"}),'variable "resource_group_name" {\n  description = "The resource group for all the resources created"\n  default     = "IaC-App"\n}\n')),Object(s.b)("h2",null,"Final Terraform code"),Object(s.b)("p",null,"You can download the code from the GitHub repository ",Object(s.b)("a",n({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/"}),"https://github.com/IBM/cloud-enterprise-examples/")," in the directory ",Object(s.b)("a",n({parentName:"p"},{href:"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute"}),"07-compute")," where the main files are:"),Object(s.b)("p",null,"First, main.tf which simply specifies the provider, region & the resource group we want to use, which is “Default”  Replace this with the resource group you have in your environment."),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=main.tf",path:"main.tf"}),'provider "ibm" {\n  generation = 2\n  region     = "us-south"\n}\n\ndata "ibm_resource_group" "group" {\n  name = "Default"\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=accessgroup.tf",path:"accessgroup.tf"}),'variable ag1 {\n    type = string\n    default = "access-group-1"\n}\n\nvariable ag2 {\n    type = string\n    default = "access-group-2"\n}\n\nvariable ag3 {\n    type = string\n    default = "access-group-3"\n}\n\nvariable ag4 {\n    type = string\n    default = "access-group-4"\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=policy-access-group-1.tf",path:"policy-access-group-1.tf"}),'resource "ibm_iam_access_group" "res_ag_1" {\n   name  = var.ag1\n   description = "Access group for Kubernetes cluster administrators"\n}\n\nresource "ibm_iam_access_group_policy" "res_ag_policy1" {\n\n  access_group_id = ibm_iam_access_group.res_ag_1.id\n  roles        = ["Administrator", "Manager"]\n  resources  {\n    service   = "containers-kubernetes"\n\n  }\n}\n\nresource "ibm_iam_access_group_policy" "res_ag_policy2" {\n\n  access_group_id = ibm_iam_access_group.res_ag_1.id\n  roles        = ["Administrator", "Manager"]\n  resources  {\n    service   = "container-registry"\n\n  }\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=policy-access-group-2.tf",path:"policy-access-group-2.tf"}),'resource "ibm_iam_access_group" "res_ag_2" {\n    name  = var.ag2\n    description = "Access group for Kubernetes cluster auditors"\n}\n\nresource "ibm_iam_access_group_policy" "res_ag2_policy1" {\n\n  access_group_id = ibm_iam_access_group.res_ag_2.id\n  roles        = ["Viewer", "Reader"]\n  resources  {\n    service   = "containers-kubernetes"\n\n  }\n}\n\nresource "ibm_iam_access_group_policy" "res_ag2_policy2" {\n\n  access_group_id = ibm_iam_access_group.res_ag_2.id\n  roles        = ["Reader"]\n  resources  {\n    service   = "container-registry"\n\n  }\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=policy-access-group-3.tf",path:"policy-access-group-3.tf"}),' resource "ibm_iam_access_group" "res_ag_3" {\n  name  = var.ag3\n  description = "Access group for Schematics workspace managers"\n}\n\nresource "ibm_iam_access_group_policy" "res_ag3_policy1" {\n\n  access_group_id = ibm_iam_access_group.res_ag_3.id\n  roles        = ["Administrator", "Manager"]\n  resources  {\n    service   = "schematics"\n\n  }\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=policy-access-group-4.tf",path:"policy-access-group-4.tf"}),'resource "ibm_iam_access_group" "res_ag_4" {\n    name  = var.ag4\n    description = "Access group for Cloud Object Storage administrators"\n}\n\nresource "ibm_iam_access_group_policy" "res_ag4_policy1" {\n  access_group_id = ibm_iam_access_group.res_ag_4.id\n  roles        = ["Administrator", "Manager"]\n  resources {\n    service = "cloud-object-storage"\n  }\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=user.tf",path:"user.tf"}),'variable "user_email" {}\n\nresource "ibm_iam_access_group_members" "ag1_members" {\n  access_group_id = ibm_iam_access_group.res_ag_1.id\n  ibm_ids         = [ var.user_email ]\n}\n\nresource "ibm_iam_access_group_members" "ag3_members" {\n  access_group_id = ibm_iam_access_group.res_ag_3.id\n  ibm_ids         = [ var.user_email ]\n}\n\nresource "ibm_iam_access_group_members" "ag4_members" {\n  access_group_id = ibm_iam_access_group.res_ag_4.id\n  ibm_ids         = [ var.user_email ]\n}\n')),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-hcl",metastring:"path=output.tf",path:"output.tf"}),'output "accessGroup1" {\n    value = ibm_iam_access_group.res_ag_1\n}\n\noutput "accessGroup2" {\n    value = ibm_iam_access_group.res_ag_2\n}\n\noutput "accessGroup3" {\n    value = ibm_iam_access_group.res_ag_3\n}\n\noutput "accessGroup4" {\n    value = ibm_iam_access_group.res_ag_4\n}\n')),Object(s.b)("h2",null,"Clean up"),Object(s.b)("p",null,"To cleanup all the resources created by the script, run the following:"),Object(s.b)("pre",null,Object(s.b)("code",n({parentName:"pre"},{className:"language-bash"}),"terraform destroy\n")))}g.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-iac-resources-iam-index-mdx-807a622d54cecbe2cb7b.js.map