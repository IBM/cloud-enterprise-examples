(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"hM+C":function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return s})),t.d(a,"default",(function(){return l}));t("91GP"),t("rGqo"),t("yt8O"),t("Btvt"),t("RW0V"),t("q1tI");var n=t("7ljp"),o=t("013z");t("qKvR");function i(){return(i=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var s={},c={_frontmatter:s},r=o.a;function l(e){var a=e.components,t=function(e,a){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,["components"]);return Object(n.b)(r,i({},c,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)("p",null,"For this pattern, we have created IKS on VPC which has worker pool (2vCPU and 4GB RAM) with one worker node and will configure autoscale on it. A sample Java application is built which uses WebSphere Liberty as its runtime and perform calculations to increase CPU load. We will build a container image for this application and push the image to IBM Cloud container registry. Then the application will be deployed to IKS using configuration (.yaml) files using the built image.\nFollow the instructions given below to deploy the application."),Object(n.b)("h2",null,"Create/Get namespace on IBM Cloud container registry"),Object(n.b)("p",null,"IBM Cloud Container Registry is used to store and access private container images. To access Cloud Container Registry through Cloud dashboard, click ",Object(n.b)("inlineCode",{parentName:"p"},"Navigation > Kubernetes > Registry")),Object(n.b)("p",null,"If you have not created namespace before or you want to use different namespace than existing one then need to create a new namespace. You can create a namespace through interface or using the following commands."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"$ ibmcloud cr namespace-add <YOUR_NAMESPACE>\n \n# To verify that namespace is created\n$ ibmcloud cr namespace-list\n")),Object(n.b)("h2",null,"Prepare deploy target for your container image"),Object(n.b)("p",null,"You need to set the correct deploy target for the container image to upload to the accessible container registry. Depending on the region you created your cluster in, your image URL will be in the following format:"),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{}),"<REGION_ABBREVIATION>.icr.io/<YOUR_NAMESPACE>/<YOUR_IMAGE_NAME>:<VERSION>\n")),Object(n.b)("p",null,"The following command tells you the Registry API endpoint for your cluster. You can get region abbreviation from the output."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"ibmcloud cr api\n")),Object(n.b)("p",null,"To get namespace use the following command."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"ibmcloud cr namespaces\n")),Object(n.b)("p",null,"You can choose any name for image and any version. For example, the deploy target for US-South region will be ",Object(n.b)("inlineCode",{parentName:"p"},"us.icr.io/my_namespace/scaleapp:1.0")),Object(n.b)("h2",null,"Deploy an application"),Object(n.b)("p",null,"Perform the following steps to build an image and push the image to IBM Cloud Container Registry."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"git clone https://github.com/IBM/cloud-enterprise-examples.git\n\ncd cloud-enterprise-examples/artifacts/auto-scale/iks-vpc\n\n# Build the image using Dockerfile and push to IBM Cloud Container registry\nibmcloud cr build --tag <YOUR_DEPLOY_TARGET> .\n\n# Verify whether the image is uploaded to the container registry\nibmcloud cr image-list\n")),Object(n.b)("p",null,"The public Ingress application load balancers(ALBs) gets created by default with IBM Kubernetes Service. Ingress is a Kubernetes service that balances network traffic workloads in your cluster by forwarding requests to your apps. To expose an app by using Ingress, you need to register the service of your application with Ingress by defining an Ingress resource. The Ingress resource is a Kubernetes resource that defines the rules for how to route incoming requests for apps."),Object(n.b)("p",null,"Run the following command and make a note of the Ingress Subdomain and its secret to be used in Ingress Resource definition as explained further."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"# To get the cluster name or ID to be used in next command\nibmcloud ks cluster ls\nibmcloud ks cluster get --cluster <your-cluster-name> |grep -i ingres\n")),Object(n.b)("p",null,"Now, need to modify ",Object(n.b)("inlineCode",{parentName:"p"},"deploy.yaml")," as shown below."),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"image location for Deployment resource. Use your deploy target used in above step.")),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"## macOS\n$ sed -i '' s#IMAGE#<YOUR_DEPLOY_TARGET># deploy.yaml\n\n## Linux\n$ sed -i s#IMAGE#<YOUR_DEPLOY_TARGET># deploy.yaml\n")),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"ingress subdomain and secret name (noted before) for Ingress resource")),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"## macOS\n$ sed -i '' s#HOST#<YOUR_INGRESS_SUBDOMAIN># deploy.yaml\n$ sed -i '' s#SECRET#<YOUR_INGRESS_SUBDOMAIN_SECRET># deploy.yaml\n\n## Linux\n$ sed -i s#HOST#<YOUR_INGRESS_SUBDOMAIN># deploy.yaml\n$ sed -i s#SECRET#<YOUR_INGRESS_SUBDOMAIN_SECRET># deploy.yaml\n")),Object(n.b)("p",null,"We are ready to deploy the application now. Run the following command."),Object(n.b)("pre",null,Object(n.b)("code",i({parentName:"pre"},{className:"language-bash"}),"kubectl create -f deploy.yaml\n")),Object(n.b)("p",null,"You can check the pod status using ",Object(n.b)("inlineCode",{parentName:"p"},"kubectl get pods")," and its logs using ",Object(n.b)("inlineCode",{parentName:"p"},"kubectl logs <pod-name>")," command.\nWait for 1-2 minutes as server takes sometime to start and then access the application."),Object(n.b)("h2",null,"Access the application"),Object(n.b)("p",null,"You can access your application using the Ingress subdomain URL. The paths to your app services are appended to the public route to form a unique app URL. Access the url ",Object(n.b)("inlineCode",{parentName:"p"},"https://<YOUR_INGRESS_SUBDOMAIN>/autoscale-webapp"),", you will get the following output on your screen."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"874px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"19.791666666666668%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAj0lEQVQY042OwQ6CMBBE+/9fpdHoQQ9EVAzERFRKSaAorcWSpmMLiQcvdjYvO7uHyRDKKFhVoqB36EHDy7rBD8aYIEgSnZHGFxyjDI9agpcSgvdoK+8FOJOjDxVJVgVOazoSz3OkG4rD8ob94ordLEe2pXjWr6m5tX8hXaPgEW0/btXp6XYtpfu91fANC9EH6eM05FlJTBcAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Output1",title:"Output1",src:"/att-cloudnative/ibmcloud-pattern-guide/static/288ae24dc9e6227d55506624588e7f3f/43104/output1.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/288ae24dc9e6227d55506624588e7f3f/7fc1e/output1.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/288ae24dc9e6227d55506624588e7f3f/a5df1/output1.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/288ae24dc9e6227d55506624588e7f3f/43104/output1.png 874w"],sizes:"(max-width: 874px) 100vw, 874px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"The compute-intensive operation you can execute by accessing this ",Object(n.b)("inlineCode",{parentName:"p"},"http://<YOUR_INGRESS_SUBDOMAIN>/autoscale-webapp/LoadCPUSquareRoot?count=1"),".\nThe browser will show the following on your screen."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1046px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"11.11111111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAU0lEQVQI112MQQoAIQwD/f87FVqtHupNpVlaEGQDYUgISUQEVcWcEzlniAiYOdh7RyklOMZAay02zlor9t5wmRmukpfnnPBaC2/+d86b3ffoPfwAeUebF3ZjEqQAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Output2",title:"Output2",src:"/att-cloudnative/ibmcloud-pattern-guide/static/6238947da7ca7f3749edffa20cdb559a/42af5/output2.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/6238947da7ca7f3749edffa20cdb559a/7fc1e/output2.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/6238947da7ca7f3749edffa20cdb559a/a5df1/output2.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/6238947da7ca7f3749edffa20cdb559a/42af5/output2.png 1046w"],sizes:"(max-width: 1046px) 100vw, 1046px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"The usage of Kubernetes cluster resources can be checked using the Kubernetes dashboard as well."),Object(n.b)("p",null,"Navigate to ",Object(n.b)("inlineCode",{parentName:"p"},"IBM Cloud Dashboard > Clusters > <YOUR_KUBERNETES_CLUSTER>")," and then click on Kubernetes Dashboard as shown."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"9.722222222222221%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAiElEQVQI1x3LuwrCMACF4T6/k/gK4uAbOKibgu4uOpTEXpIm0mKuivAbOnz8yzmVHgzGDIXBWotoJc+mQQhB13VorVFK0fea6aXYnwSLtWC1lSw3Nbd7j2w1slFlp6mcc3jvZyEEYopFIoZIKs05z1LK/L6JR/1mdx45XCeOlxE7Jnz84EKe/39dxpPbe7vrWQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Access Dashboard",title:"Access Dashboard",src:"/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/3cbba/access-dashboard.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/7fc1e/access-dashboard.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/a5df1/access-dashboard.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/3cbba/access-dashboard.png 1152w","/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/0b124/access-dashboard.png 1728w","/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/4ea69/access-dashboard.png 2304w","/att-cloudnative/ibmcloud-pattern-guide/static/74afb02eb6e5f6bdbbf0793ea42edf23/d9193/access-dashboard.png 2518w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(n.b)("p",null,"The Kubernetes Dashboard will show workloads, resources, their usage and so on. If you have run the compute-intensive operation, then dashboard would show resources usage like the below snapshot."),Object(n.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(n.b)("span",i({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"24.65277777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8UlEQVQY00XQO27DMAwGYN+4S9OrdEnv0FN0aIB0auJk6WtwYbu2ZEuyaVH6K8pBQuADSQ2UqMIYg6qqIFkihIAY45X0Ypoc6qZB2zagacQaEbeQOqBwzkGw9+ksDZGBWbwIYOY0cIJSPepW4/DpUP4Qyu+bwxehHxmF0SP+aMCz2iHEAB8YLKSOnHt5obEOsxvw8cu43w7YbPXVw5PG3aPG64lQ8OLRWY2X+h3ajlB2SDdpdINCb3S2LAuIKOUZTTdiXyq8nXW2P6317tij6WcUPq1KM4EtwVqL6fIF1thMehko1tUdPJnEZiyWtfae8A9bxnxpZC5eqwAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(n.b)("img",i({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Reources Usage",title:"Reources Usage",src:"/att-cloudnative/ibmcloud-pattern-guide/static/6f5fbd852764173345ee0949a65a1a3a/3cbba/resource-usage.png",srcSet:["/att-cloudnative/ibmcloud-pattern-guide/static/6f5fbd852764173345ee0949a65a1a3a/7fc1e/resource-usage.png 288w","/att-cloudnative/ibmcloud-pattern-guide/static/6f5fbd852764173345ee0949a65a1a3a/a5df1/resource-usage.png 576w","/att-cloudnative/ibmcloud-pattern-guide/static/6f5fbd852764173345ee0949a65a1a3a/3cbba/resource-usage.png 1152w","/att-cloudnative/ibmcloud-pattern-guide/static/6f5fbd852764173345ee0949a65a1a3a/026b8/resource-usage.png 1288w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "))}l.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-deploy-iks-application-deployment-index-mdx-5dfd9ce3f1e41e96310b.js.map