{"version":3,"sources":["webpack:///./src/pages/certificate-management/service-setup/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","InlineNotification","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","small","isMDXComponent"],"mappings":"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","file":"component---src-pages-certificate-management-service-setup-index-mdx-93cceb8d6b4fdb0a09b1.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst InlineNotification = makeShortcode(\"InlineNotification\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    {\n      /*\n      The pattern to document the resources is like follow:\n      - Introduce the resource with an example\n      - List all or the most important input parameters\n      - If will be used, list the most important output parameters\n      - Provide instructions to get the value of the input parameters, either using `ibmcloud`, API or the Web console.\n      - If needed, instructions to execute the code either with Terraform or Schematics\n      */\n    }\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Using the IBM Cloud Certificate Manager service`}</p>\n    </PageDescription>\n    <p>{`Transport Layer Security (TLS) created by the Internet Engineering Task Force (IETF) is a standardized protocol used to protect application data in flight. TLS supports the establishment of trust of the parties in the connection through the use of digital certificates. Secure handling of digital certificates, which are validated (by a Certificate Authority) public keys and their corresponding private keys is an essential capability for a cloud provider platform.`}</p>\n    <p>{`The IBM Cloud `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/catalog/services/certificate-manager\"\n      }}>{`Certificate Manager`}</a>{` is a free service to help you manage digital certificates used for SSL/TLS connections. This guide will show how to create a Certificate Manager instance, import an existing certificate signed by a public Certificate Authority (CA) and request a new singed certificate from the `}<a parentName=\"p\" {...{\n        \"href\": \"https://letsencrypt.org/\"\n      }}>{`Let’s Encrypt`}</a>{` CA. Related guides will show how to deploy certificates stored in Certificate Manager to the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/certificate-management/deploy-to-vpclb\"\n      }}>{`VPC Load Balancer`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/certificate-management/deploy-to-iks\"\n      }}>{`Kubernetes Ingress`}</a>{`.`}</p>\n    <p>{`Certificate Manager can order certificates from Let’s Encrypt for both individual domain names and wildcard domain names. Certificate Manager provides integration with IBM Cloud Internet Services for automatically configuring responses for domain challenges using the `}<a parentName=\"p\" {...{\n        \"href\": \"https://tools.ietf.org/html/rfc8555\"\n      }}>{`Automatic Certificate Management Environment`}</a>{` (ACME) protocol. Additionally, Certificate Manager supports the use of any DNS provider through a Callback URL notification process. This guide will provide an example Cloud Function for processing the notification which can be used as is or further integrated with a DNS provider’s API as needed.`}</p>\n    <p>{`The code to manage the Certificate Manager and certificates can be downloaded from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/14-certificate-management/certificate-management\"\n      }}>{`14-certificate-management/certificate-management`}</a>{`.`}</p>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Certificate Manager</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Importing an existing certificate</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Configuring a certificate notification endpoint</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Requesting a new certificate</AnchorLink>\n    </AnchorLinks>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Requirements`}</strong></p>\n      <p>{`To be able to execute and complete the instructions in this page, make sure you have an `}<strong parentName=\"p\">{`IBM Cloud account`}</strong>{`: if you don’t have one yet, you can `}<a parentName=\"p\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/overview?topic=overview-quickstart_lite#prereqs-lite\"\n        }}>{`create a Lite account`}</a>{` for free.`}</p>\n      <p>{`These examples will require an internet DNS domain that is managed by the user or can be used with a domain managed by the IBM Cloud Internet Services service.`}</p>\n      <p>{`Also make sure you have the environment setup as explained in the `}<a parentName=\"p\" {...{\n          \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n        }}>{`Setup Environment`}</a>{` page to have installed the IBM Cloud CLI, logged in to your account with the IBM Cloud CLI and set the `}<inlineCode parentName=\"p\">{`IC_API_KEY`}</inlineCode>{` environment variable to a key which has the ability to manage IAM configuration.`}</p>\n    </InlineNotification>\n    <h2>{`Certificate Manager`}</h2>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/certificate-manager?topic=certificate-manager-getting-started\"\n      }}>{`Certificate Manager`}</a>{` service instance can be created from the IBM Cloud dashboard or CLI. After the instance is created, it can be fully managed through a dashboard web interface. After the service instance is created, this guide will provide examples of managing certificate import and new certificate ordering using terraform.`}</p>\n    <p>{`Before you run through this example, make sure your Terraform environment is setup correctly as documented in the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n      }}>{`environment setup`}</a>{`.`}</p>\n    <p>{`Create a Certificate Manager instance. Begin by logging in to IBM Cloud using the CLI and set the desired resource group and region `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud login\nibmcloud target -g Default -r us-south\nibmcloud resource service-instance-create \"iac-certificate-manager\" cloudcerts free us-south\n`}</code></pre>\n    <p>{`Make a note of the `}<inlineCode parentName=\"p\">{`ID`}</inlineCode>{` returned by the command. It will be of the form `}<inlineCode parentName=\"p\">{`crn:v1:bluemix:public:cloudcerts:us-south:a/{account-id}:{instance-guid}::`}</inlineCode>{` Assign this to an envrionment variable `}<inlineCode parentName=\"p\">{`CMID`}</inlineCode>{` for later use. This command will work as well if you have `}<inlineCode parentName=\"p\">{`jq`}</inlineCode>{` installed.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`CMID=$(ibmcloud resource service-instance iac-certificate-manager --output JSON | jq .[].id | tr -d \\\\\")\necho $CMID\n`}</code></pre>\n    <p>{`Alternatively, the certificate manager instance can be created using terraform by creating an `}<inlineCode parentName=\"p\">{`ibm_resource_instance`}</inlineCode>{` resource using the service name `}<inlineCode parentName=\"p\">{`cloudcerts`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`free`}</inlineCode>{` plan.`}</p>\n    <h2>{`Importing an existing certificate`}</h2>\n    <p>{`Certificate manager can import signed certificates for storage. Either the certificate alone can be imported, or the certificate and the associated private key can be imported. To be able to deploy the certificate to other services, such as the VPC Load Balancer or Kubernetes ingress, the certificate and private key should both be imported. If your certificate requires an intermediate signing certificate, that can be imported at the same time.`}</p>\n    <p>{`Example code to import a certificate, private key and intermediate certificate can be found in the repo in the `}<inlineCode parentName=\"p\">{`14-certificate-managment/import-certificate`}</inlineCode>{` folder.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=certificate.tf\",\n        \"path\": \"certificate.tf\"\n      }}>{`data \"ibm_resource_instance\" \"cm\" {\n    name     = \"iac-certificate-manager\"\n    service  = \"cloudcerts\"\n}\n\nresource \"ibm_certificate_manager_import\" \"cert\" {\n  certificate_manager_instance_id = data.ibm_resource_instance.cm.id\n  name                            = \"iac-imported-certificate\"\n  description=\"Certificate signed by public CA and imported to Certificate Manager\"\n  data = {\n    content = file(var.certfile_path)\n    priv_key = file(var.private_keyfile_path)\n    intermediate = file(var.intermediate_certfile_path)\n  }\n}\n\noutput \"imported-certificate-id\" {\n  value = ibm_certificate_manager_import.cert.id\n}\n\noutput \"imported-certificate-issuer\" {\n  value = ibm_certificate_manager_import.cert.issuer\n}\n\noutput \"imported-certificate-expires-on\" {\n  value = ibm_certificate_manager_import.cert.expires_on\n}\n`}</code></pre>\n    <p>{`To use this code, update the file paths in the `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file with the local path on the system running terraform to the certificate, key, and intermediate certificate files. Example values are shown for a wildcard certificate on the `}<inlineCode parentName=\"p\">{`cm.timro.us`}</inlineCode>{` domain:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"certfile_path\" { \n  default = \"~/certs/PublicCA-demo/wc_cm_timro_us.pem\" \n}\nvariable \"private_keyfile_path\" { \n  default = \"~/certs/PublicCA-demo/wc_cm_timro_us.key\"\n}\nvariable \"intermediate_certfile_path\" { \n  default = \"~/certs/PublicCA-demo/wc_cm_timro_us_intermediate.pem\" \n}\nvariable \"resource_group\" {\n  default = \"Default\"\n}\nvariable \"region\" {\n  default = \"us-south\"\n}\n`}</code></pre>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p>{`To only import the certificate, leave the keyfile and intermediate certificate blank in `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` and comment the `}<inlineCode parentName=\"p\">{`priv_key`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`intermediate`}</inlineCode>{` properties in the `}<inlineCode parentName=\"p\">{`certificate.tf`}</inlineCode>{` file.`}</p>\n    </InlineNotification>\n    <p>{`Import the certificate using Terraform:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init \nterraform plan \nterraform apply\n`}</code></pre>\n    <p>{`After the certificate is uploaded, you can verify the status by viewing the certificate from the Certificate Manager dashboard:`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"28.47222222222222%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABB0lEQVQY041QO07FQAzM9eAKFCDRv1tAxfmAKlE+u87m/082JDa2pUivoMDSyHY8E68niOO4CMPQpmkKXddB27Z/omkazX3fwzAMinEcYds22NYF/DKAXwcIeEB1XRMLiAXEAuIfK6S+eplJ9t7Tvu+KZVnIWkOZLSkpfih2noJpmoR48ja8wERc11XzPM9a80u0Z77iOA78/PrG15cnfL594MO7x8e3CYM8z8kYczrnsCxL5NMxyzKsqgrlG1uCAIBFUaC1VufCk3mSJBhFEea5Q2MdgisxQER9upwiwZv1nPs4z5P+GwFvcoyMzzbsk+HasJ9GegF7aNhnzRfuZ8IVTct9w/pfE1vBIx0uISAAAAAASUVORK5CYII=')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Uploaded certificate\",\n        \"title\": \"Uploaded Certificate\",\n        \"src\": \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/3cbba/uploaded_certificate.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/7fc1e/uploaded_certificate.png 288w\", \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/a5df1/uploaded_certificate.png 576w\", \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/3cbba/uploaded_certificate.png 1152w\", \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/0b124/uploaded_certificate.png 1728w\", \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/4ea69/uploaded_certificate.png 2304w\", \"/cloud-enterprise-examples/static/820f08e1b78ce0c5916cc8d2fb63b034/73be3/uploaded_certificate.png 2418w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <h2>{`Configuring a certificate notification endpoint`}</h2>\n    <p>{`The Certificate Manager automates the support lifecycle of certifications through `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/certificate-manager?topic=certificate-manager-configuring-notifications\"\n      }}>{`notifications`}</a>{`. Notifications include messages related to certificate activity like certificate imports, domain requests for new certificates, upcoming certificate expirations, automatic renewals and more. Supported notification integrations are through Slack webhooks and a generic Callback URL.`}</p>\n    <p>{`When setting up `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/certificate-manager?topic=certificate-manager-ordering-certificates\"\n      }}>{`certificate ordering`}</a>{`, Certificate Manager supports two approaches to confirming domain ownership. If you are managing domains using IBM Cloud Internet Services, the service can be `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/certificate-manager?topic=certificate-manager-ordering-certificates#cis\"\n      }}>{`configured to automate`}</a>{` the domain confirmation process.`}</p>\n    <p>{`For a generic DNS provider, confirming domain ownership is handled through Callback URL notifications. The file `}<inlineCode parentName=\"p\">{`14-certificate-management/functions/cm-callback.js`}</inlineCode>{` provides a node.js function that will implement an endpoint to receive the domain request and log the necessary information to implement an ACME `}<inlineCode parentName=\"p\">{`dns-01`}</inlineCode>{` style challenge. This code is a simplified version of `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-security/certificate-manager-domain-validation-cloud-function-sample\"\n      }}>{`example code`}</a>{` for integration with the SoftLayer DNS provider.`}</p>\n    <p>{`This code can be deployed as a Cloud Function using the following steps in the IBM Cloud CLI. Begin by installing the cloud functions plugin and then create an IAM namespace for the function.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud plugin install cloud-functions\nibmcloud cloud-functions namespace create iac-functions-01\nibmcloud fn property set --namespace iac-functions-01\n`}</code></pre>\n    <p>{`If you have not already, change to the folder with the `}<inlineCode parentName=\"p\">{`cm-callback.js`}</inlineCode>{` file and install it as an action in the namespace and verify that it is installed:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud fn action create cm-callback cm-callback.js --kind nodejs:10 --web true\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ ibmcloud fn action list\nactions\n/4c87f7d9-ffc9-4d25-863c-8e47d6be4e24/cm-callback                      private nodejs:10\n`}</code></pre>\n    <p>{`Next, add parameters to the action that will specify the allowed Certificate Manager instances that will be allowed to post notifications for domain events and also the region of the Certificate Manager instance for request validation.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud fn action update cm-callback --param allowedCertificateManagerCRNs \"{\\\\\"$CMID\\\\\":true}\" --param cmRegion \"us-south\"\n`}</code></pre>\n    <p>{`Obtain the web endpoint for the action and set this to an envrionment variable CALLBACK_URL`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`CALLBACK_URL=$(ibmcloud fn action get cm-callback --url | grep http)\necho $CALLBACK_URL\n`}</code></pre>\n    <p>{`This URL endpoint can be added to the Certificate Manager using the dashboard by navigating to the `}<strong parentName=\"p\">{`Notifications`}</strong>{` page and clicking on the `}<strong parentName=\"p\">{`Create`}</strong>{` button. Select the “Callback URL” channel type and paste in the URL and save. Note, this step can also be performed `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/apidocs/certificate-manager#create-notification-channel\"\n      }}>{`using the api`}</a>{`.`}</p>\n    <p>{`Verify that your cloud function received the test notification from service (you can re-trigger a notification by clicking on the three vertical dots on the right side of the channel entry and selecting `}<strong parentName=\"p\">{`Test Connection`}</strong>{`)`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ ibmcloud fn activation logs --last\n2020-05-30T18:03:56.055864Z    stdout: Cloud function invoked.\n2020-05-30T18:03:56.056185Z    stdout: Get public key for instance crn:v1:bluemix:public:cloudcerts:us-south:a06788ee4fd5a4d779f236bbe43f09b4b:d6cad342-cf54-49d3-b5f9-42e842e43c40::\n`}</code></pre>\n    <p>{`With your Callback URL in operation, you can now use Certificate Manager to order a certificate.`}</p>\n    <h2>{`Requesting a new certificate`}</h2>\n    <p>{`When using a DNS provider other than IBM Cloud Internet Services, the requested domain challenge must be added to the DNS domain `}<em parentName=\"p\">{`within 10 minutes`}</em>{` of the certificate order. It’s good to verify that you have configured a process that will allow you to add TXT records to the planned domain for the certificate in advance.`}</p>\n    <p>{`Code for ordering a certificate is located in the `}<inlineCode parentName=\"p\">{`14-certificate-management/order-certifcate`}</inlineCode>{` folder.`}</p>\n    <p>{`Example code to create a certificate request for the domain name `}<inlineCode parentName=\"p\">{`movies.timro.us`}</inlineCode>{` is provided as an example. Edit the `}<inlineCode parentName=\"p\">{`certificate.tf`}</inlineCode>{` file to provide a domain name that you can manage.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=certificate.tf\",\n        \"path\": \"certificate.tf\"\n      }}>{`data \"ibm_resource_instance\" \"cm\" {\n    name     = \"iac-certificate-manager\"\n    service  = \"cloudcerts\"\n}\n\nresource \"ibm_certificate_manager_order\" \"cert\" {\n  certificate_manager_instance_id = data.ibm_resource_instance.cm.id\n  name                            = \"iac-ordered-certificate\"\n  description                     = \"Certificate ordered using alternate DNS provider\"\n  domains                         = [\"movies.timro.us\"]\n  rotate_keys                     = false\n  domain_validation_method        = \"dns-01\"\n  # dns_provider_instance_crn       = ibm_cis.instance.id  // if not provided CM will use callback\n}\n\noutput \"ordered-certificate-id\" {\n  value = ibm_certificate_manager_order.cert.id\n}\n\noutput \"ordered-certificate-status\" {\n  value = ibm_certificate_manager_order.cert.status\n}\n\noutput \"ordered-certificate-expires-on\" {\n  value = ibm_certificate_manager_order.cert.expires_on\n}\n`}</code></pre>\n    <p>{`Configure terraform in the directory and request the certificate. Note, if the Certificate Manager is not able to verify the status of the ACME `}<inlineCode parentName=\"p\">{`dns-01`}</inlineCode>{` challenge, the certificate status will stay as `}<strong parentName=\"p\">{`Pending`}</strong>{` until the 10 minute period expires.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init \nterraform plan \nterraform apply\n`}</code></pre>\n    <p>{`From another terminal (the terraform apply request will block) Check the output log from the cloud function (example output shown)`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ ibmcloud fn activation logs --last\n2020-05-30T18:32:30.830748Z    stdout: Cloud function invoked.\n2020-05-30T18:32:30.830893Z    stdout: Get public key for instance crn:v1:bluemix:public:cloudcerts:us-south:a06788ee4fd5a4d779f236bbe43f09b4b:d6cad342-cf54-49d3-b5f9-42e842e43c40::\n2020-05-30T18:32:31.037939Z    stdout: Validation requested for domain: movies.timro.us\n2020-05-30T18:32:31.037973Z    stdout: TXT record name: _acme-challenge, TXT value: x5_fFA2-dweRRjq5bw4hjGVloS2S6I3-mrkB5pHkHlk\n`}</code></pre>\n    <p>{`At this point, update your DNS domain with the requested record, use a very short TTL (300-600s). Verify the entry:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ dig -t TXT +short _acme-challenge.movies.timro.us\n\"x5_fFA2-dweRRjq5bw4hjGVloS2S6I3-mrkB5pHkHlk\"\n`}</code></pre>\n    <p>{`There can be times when Certificate Manager re-issues a request for a new challenge text. If this occurs there will be additional activations of the function with the updated challenge. Update the domain entry if this happens. With a short TTL, the updated value should propagate quickly enough to be processed before the 10 minute period expires.`}</p>\n    <p>{`If the creation of the certificate is successful, the following will be displayed from the terminal with the terraform cli:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-text\"\n      }}>{`Apply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nOutputs:\n\nordered-certificate-expires-on = 1598637993000\nordered-certificate-id = crn:v1:bluemix:public:cloudcerts:us-south:a/06788ee4fd5a4d779f236bbe43f09b4b:d6cad342-cf54-49d3-b5f9-42e842e43c40:certificate:df56720b1dab1db089f73d0fd8d6ad20\nordered-certificate-status = valid\n`}</code></pre>\n    <p>{`When this message appears, you may remove the TXT record for your domain. The certificate is ready for deployment from Certificate Manager. Both certificates are now visible in the service dashboard.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"30.208333333333332%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY04VQPU/FMAzsH2VlZYUBsbMx8KfehPRQpQdSh6pt0qbf6Xdam3OkIjFh6eRzYp/lC5IkucZxbKIoUlmW6bZtdV3XummaP5A3gfz3fe9hba+3zendbfpYe+2WTgVoMsMwMIYYzdx1HVtrGQMeJ5d3wTzPvO+7x7IsHIaf/HG98eX74MvXwgGElIhB+EAmZIIwQcgDIgRBwlJfy59A6jTN6OX5iR4eX+nuzdL9e7MHZVmqoig4TdMDmaqqIlhAwmVQa02wxdfo9fxcmuc5KaUgjuVdJdiDdV0NI5xzHhJE5HHGeeJ/cWBGPAyNMQ22G5xncJ4RLhkemWmazDiOPsO/33xymYFVnsOS4gfqYMKXS9N6TgAAAABJRU5ErkJggg==')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Both certificates\",\n        \"title\": \"Both Certificates\",\n        \"src\": \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/3cbba/both_certificates.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/7fc1e/both_certificates.png 288w\", \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/a5df1/both_certificates.png 576w\", \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/3cbba/both_certificates.png 1152w\", \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/0b124/both_certificates.png 1728w\", \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/4ea69/both_certificates.png 2304w\", \"/cloud-enterprise-examples/static/6f46b58cc93667953d9af97507d2c7b2/73be3/both_certificates.png 2418w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`Although these certificates could be removed at this point using `}<inlineCode parentName=\"p\">{`terraform destroy`}</inlineCode>{`, do not perform this action if you plan to continue with the other deployment examples to `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/certificate-management/deploy-to-vpclb\"\n      }}>{`VPC Load Balancer`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/certificate-management/deploy-to-iks\"\n      }}>{`Kubernetes Ingress`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}