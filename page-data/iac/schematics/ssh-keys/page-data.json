{"componentChunkName":"component---src-pages-iac-schematics-ssh-keys-index-mdx","path":"/iac/schematics/ssh-keys/","result":{"pageContext":{"frontmatter":{"title":"SSH Keys Management","description":"Instructions to create SSH keys","keywords":"terraform,ibm cloud,ssh keys"},"relativePagePath":"/iac/schematics/ssh-keys/index.mdx","titleType":"page","MdxNode":{"id":"da6ea86c-18cd-5c5b-8a9b-d51686a6ae78","children":[],"parent":"4e622ecc-f181-5b03-a1c4-b60275ccc773","internal":{"content":"---\ntitle: SSH Keys Management\ndescription: Instructions to create SSH keys\nkeywords: 'terraform,ibm cloud,ssh keys'\n---\n\n<PageDescription>\n\nSharing SSH key between projects\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Create the SSH Key Pair</AnchorLink>\n  <AnchorLink>Using the IBM Cloud CLI to create the SSH Key</AnchorLink>\n  <AnchorLink>Using Terraform to create the SSH Key</AnchorLink>\n  <AnchorLink>Use the created SSH key</AnchorLink>\n  <AnchorLink>Clean up</AnchorLink>\n</AnchorLinks>\n\nTerraform code in the example projects provided in this pattern creates, modifies and destroys the SSH key. However, you may want to use your own SSH key or create, modify and destroy it using a different method. Having a SSH key shared between projects is also good practice to follow. This chapter describes how to manage a SSH key outside of the example project Terraform code.\n\n## Create the SSH Key Pair\n\nBefore creating the SSH key in IBM Cloud you need to have a SSH key pair in your system. You can create the key pair using the `ssh-keygen` command. If you use the default parameters it generates the SSH Key Pairs in the files `~/.ssh/id_rsa.pub` and `~/.ssh/id_rsa`. Read [create the SSH key pair](https://cloud.ibm.com/docs/vpc?topic=vpc-ssh-keys) to know more about the command `ssh-keygen` and the different parameters you can use.\n\nYou can create the SSH Key on IBM Cloud on different ways, here we'll explain two: Using the IBM Cloud CLI and using Terraform.\n\n## Using the IBM Cloud CLI to create the SSH Key\n\nMake sure you have installed `ibmcloud` and the `infrastructure-service` plugin targeting it to Gen 2. Then login to your account using the `ibmcloud login` command. The [Setup Environment](/iac/setup-environment) page explain how to get this ready.\n\nList the existing SSH Keys using the following command to not use one of the used key names:\n\n```bash\nibmcloud is keys\n```\n\nTo create your SSH Key execute the command `ibmcloud is key-create KEY_NAME (KEY | @KEY_FILE)`. Assuming you'll take the public SSH key from `~/.ssh/id_rsa.pub` and name the key `schematics-test-key`, the command would be like this:\n\n```bash\nibmcloud is key-create schematics-test-key @~/.ssh/id_rsa.pub\n```\n\nIf something went wrong with the creation you can update the key name or delete the SSH key with the following commands respectively. The key ID `00000000-0000-0000-0000-000000000000` is fake, get the correct Key ID using the `ibmcloud is keys` command.\n\n```bash\nibmcloud is key-update 00000000-0000-0000-0000-000000000000 --name my-new-name\nibmcloud is key-delete 00000000-0000-0000-0000-000000000000 -f\n```\n\n<InlineNotification>\n\n###### Where can I learn more?\n\nRefer to the documentation the [Keys](https://cloud.ibm.com/docs/cli?topic=vpc-infrastructure-cli-plugin-vpc-reference#keys) in the VPC Infrastructure Service plugin. Or, use the CLI help with `ibmcloud is KEY-CMD --help` where `KEY-CMD` can be `key`, `keys`, `key-create`, `key-delete` or `key-update`.\n\nNotice that some documentation refers to the command `ibmcloud sl security sshkey-*`, this document is to manage the SSH Keys for the Classic Infrastructure or Gen 1.\n\n</InlineNotification>\n\n## Using Terraform to create the SSH Key\n\nA pre-requisite for using Terraform is to complete the [environment setup](/iac/setup-environment). For the steps below, it's required to have Terraform installed, the IBM Cloud Provider installed and the variable `IC_API_KEY` exported with the API Key to access your IBM Cloud account.\n\nIn the [Getting Started with Terraform](/iac/getting-started-terraform) we made Terraform code to create a SSH Key for our simple instance. We can reuse that code. Create a directory named `ssh-key` for the following Terraform code:\n\n```bash\nmkdir ssh-key\ncd ssh-key\n```\n\n```hcl path=main.tf\nprovider \"ibm\" {\n  generation         = 2\n  region             = \"us-south\"\n}\n\nvariable \"public_key_file\"  { default = \"~/.ssh/id_rsa.pub\" }\nlocals {\n  public_key    = file(pathexpand(var.public_key_file))\n}\n\nvariable \"ssh_key_name\" {}\n\nresource \"ibm_is_ssh_key\" \"iac_shared_ssh_key\" {\n  name       = var.ssh_key_name\n  public_key = local.public_key\n}\n\noutput \"id\" {\n  value = ibm_is_ssh_key.iac_shared_ssh_key.id\n}\noutput \"ibm_cloud_url\" {\n  value = ibm_is_ssh_key.iac_shared_ssh_key.resource_controller_url\n}\n```\n\nExecute `terraform init`, then execute the following commands to create or update the key (you will be prompted for the key name because there is no default set for ssh_key_name variable in the code):\n\n```bash\nterraform plan\nterraform apply\n```\n\nTo destroy the key just execute `terraform destroy`\n\n<InlineNotification>\n\n###### Where can I know more?\n\nRead the web documentation for the [ibm_is_ssh_key](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#ssh-key) resource of the IBM Cloud Provider.\n\n</InlineNotification>\n\n## Use the created SSH key\n\nTo make the Terraform code in all the examples of the IaC pattern use the recently created SSH Key we need to add the following code the files `variables.tf` and `main.tf` like so:\n\n```hcl path=variables.tf\nvariable \"ssh_key_name\" {}\n```\n\nAll the variables related to the SSH Key were replaced by just one `ssh_key_name` which is going to store the name of the recently created SSH Key.\n\n```hcl path=main.tf\ndata \"ibm_is_ssh_key\" \"shared_ssh_key\" {\n  name = var.ssh_key_name\n}\n\nresource \"ibm_is_instance\" \"iac_instance\" {\n  ...\n  keys = [ data.ibm_is_ssh_key.shared_ssh_key.id ]\n  ...\n}\n```\n\nIn the `main.tf` remove all the code to create the SSH Key and insert the data source `ibm_is_ssh_key` to get the information from the shared SSH Key. The data source requires the SSH Key name which is stored in the variable `ssh_key_name`. Also, remove any SSH key variable in the `variables.tf` file.\n\nThe `ibm_is_instance.iac_instance` instance use a similar code to get the SSH Key ID, but instead it uses the data source `ibm_is_ssh_key.shared_ssh_key`, notice the prefix `data.`.\n\n## Clean up\n\nIf you'd like to destroy the shared SSH Key just need to execute the command:\n\n```bash\nterraform destroy\n```\n\nIf the SSH key is being used by other resources IBM Cloud will complain and won't let you delete the key. Make sure no resource is using the key in order to delete it.\n","type":"Mdx","contentDigest":"7dcf185ed736b48895de1f93cf7b2140","counter":638,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"SSH Keys Management","description":"Instructions to create SSH keys","keywords":"terraform,ibm cloud,ssh keys"},"exports":{},"rawBody":"---\ntitle: SSH Keys Management\ndescription: Instructions to create SSH keys\nkeywords: 'terraform,ibm cloud,ssh keys'\n---\n\n<PageDescription>\n\nSharing SSH key between projects\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Create the SSH Key Pair</AnchorLink>\n  <AnchorLink>Using the IBM Cloud CLI to create the SSH Key</AnchorLink>\n  <AnchorLink>Using Terraform to create the SSH Key</AnchorLink>\n  <AnchorLink>Use the created SSH key</AnchorLink>\n  <AnchorLink>Clean up</AnchorLink>\n</AnchorLinks>\n\nTerraform code in the example projects provided in this pattern creates, modifies and destroys the SSH key. However, you may want to use your own SSH key or create, modify and destroy it using a different method. Having a SSH key shared between projects is also good practice to follow. This chapter describes how to manage a SSH key outside of the example project Terraform code.\n\n## Create the SSH Key Pair\n\nBefore creating the SSH key in IBM Cloud you need to have a SSH key pair in your system. You can create the key pair using the `ssh-keygen` command. If you use the default parameters it generates the SSH Key Pairs in the files `~/.ssh/id_rsa.pub` and `~/.ssh/id_rsa`. Read [create the SSH key pair](https://cloud.ibm.com/docs/vpc?topic=vpc-ssh-keys) to know more about the command `ssh-keygen` and the different parameters you can use.\n\nYou can create the SSH Key on IBM Cloud on different ways, here we'll explain two: Using the IBM Cloud CLI and using Terraform.\n\n## Using the IBM Cloud CLI to create the SSH Key\n\nMake sure you have installed `ibmcloud` and the `infrastructure-service` plugin targeting it to Gen 2. Then login to your account using the `ibmcloud login` command. The [Setup Environment](/iac/setup-environment) page explain how to get this ready.\n\nList the existing SSH Keys using the following command to not use one of the used key names:\n\n```bash\nibmcloud is keys\n```\n\nTo create your SSH Key execute the command `ibmcloud is key-create KEY_NAME (KEY | @KEY_FILE)`. Assuming you'll take the public SSH key from `~/.ssh/id_rsa.pub` and name the key `schematics-test-key`, the command would be like this:\n\n```bash\nibmcloud is key-create schematics-test-key @~/.ssh/id_rsa.pub\n```\n\nIf something went wrong with the creation you can update the key name or delete the SSH key with the following commands respectively. The key ID `00000000-0000-0000-0000-000000000000` is fake, get the correct Key ID using the `ibmcloud is keys` command.\n\n```bash\nibmcloud is key-update 00000000-0000-0000-0000-000000000000 --name my-new-name\nibmcloud is key-delete 00000000-0000-0000-0000-000000000000 -f\n```\n\n<InlineNotification>\n\n###### Where can I learn more?\n\nRefer to the documentation the [Keys](https://cloud.ibm.com/docs/cli?topic=vpc-infrastructure-cli-plugin-vpc-reference#keys) in the VPC Infrastructure Service plugin. Or, use the CLI help with `ibmcloud is KEY-CMD --help` where `KEY-CMD` can be `key`, `keys`, `key-create`, `key-delete` or `key-update`.\n\nNotice that some documentation refers to the command `ibmcloud sl security sshkey-*`, this document is to manage the SSH Keys for the Classic Infrastructure or Gen 1.\n\n</InlineNotification>\n\n## Using Terraform to create the SSH Key\n\nA pre-requisite for using Terraform is to complete the [environment setup](/iac/setup-environment). For the steps below, it's required to have Terraform installed, the IBM Cloud Provider installed and the variable `IC_API_KEY` exported with the API Key to access your IBM Cloud account.\n\nIn the [Getting Started with Terraform](/iac/getting-started-terraform) we made Terraform code to create a SSH Key for our simple instance. We can reuse that code. Create a directory named `ssh-key` for the following Terraform code:\n\n```bash\nmkdir ssh-key\ncd ssh-key\n```\n\n```hcl path=main.tf\nprovider \"ibm\" {\n  generation         = 2\n  region             = \"us-south\"\n}\n\nvariable \"public_key_file\"  { default = \"~/.ssh/id_rsa.pub\" }\nlocals {\n  public_key    = file(pathexpand(var.public_key_file))\n}\n\nvariable \"ssh_key_name\" {}\n\nresource \"ibm_is_ssh_key\" \"iac_shared_ssh_key\" {\n  name       = var.ssh_key_name\n  public_key = local.public_key\n}\n\noutput \"id\" {\n  value = ibm_is_ssh_key.iac_shared_ssh_key.id\n}\noutput \"ibm_cloud_url\" {\n  value = ibm_is_ssh_key.iac_shared_ssh_key.resource_controller_url\n}\n```\n\nExecute `terraform init`, then execute the following commands to create or update the key (you will be prompted for the key name because there is no default set for ssh_key_name variable in the code):\n\n```bash\nterraform plan\nterraform apply\n```\n\nTo destroy the key just execute `terraform destroy`\n\n<InlineNotification>\n\n###### Where can I know more?\n\nRead the web documentation for the [ibm_is_ssh_key](https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#ssh-key) resource of the IBM Cloud Provider.\n\n</InlineNotification>\n\n## Use the created SSH key\n\nTo make the Terraform code in all the examples of the IaC pattern use the recently created SSH Key we need to add the following code the files `variables.tf` and `main.tf` like so:\n\n```hcl path=variables.tf\nvariable \"ssh_key_name\" {}\n```\n\nAll the variables related to the SSH Key were replaced by just one `ssh_key_name` which is going to store the name of the recently created SSH Key.\n\n```hcl path=main.tf\ndata \"ibm_is_ssh_key\" \"shared_ssh_key\" {\n  name = var.ssh_key_name\n}\n\nresource \"ibm_is_instance\" \"iac_instance\" {\n  ...\n  keys = [ data.ibm_is_ssh_key.shared_ssh_key.id ]\n  ...\n}\n```\n\nIn the `main.tf` remove all the code to create the SSH Key and insert the data source `ibm_is_ssh_key` to get the information from the shared SSH Key. The data source requires the SSH Key name which is stored in the variable `ssh_key_name`. Also, remove any SSH key variable in the `variables.tf` file.\n\nThe `ibm_is_instance.iac_instance` instance use a similar code to get the SSH Key ID, but instead it uses the data source `ibm_is_ssh_key.shared_ssh_key`, notice the prefix `data.`.\n\n## Clean up\n\nIf you'd like to destroy the shared SSH Key just need to execute the command:\n\n```bash\nterraform destroy\n```\n\nIf the SSH key is being used by other resources IBM Cloud will complain and won't let you delete the key. Make sure no resource is using the key in order to delete it.\n","fileAbsolutePath":"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/src/pages/iac/schematics/ssh-keys/index.mdx"}}}}