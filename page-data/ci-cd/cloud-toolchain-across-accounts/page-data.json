{"componentChunkName":"component---src-pages-ci-cd-cloud-toolchain-across-accounts-index-mdx","path":"/ci-cd/cloud-toolchain-across-accounts/","result":{"pageContext":{"frontmatter":{"title":"Cross Account Pipelines with IBM Cloud Toolchain","description":"Cross Account Pipelines with IBM Cloud Toolchain","keywords":"ibm cloud cicd"},"relativePagePath":"/ci-cd/cloud-toolchain-across-accounts/index.mdx","titleType":"page","MdxNode":{"id":"7a51d340-e260-501f-bb91-1b9a8282d631","children":[],"parent":"43cf82d3-58a6-5337-9b19-cf169141b8c9","internal":{"content":"---\ntitle: Cross Account Pipelines with IBM Cloud Toolchain\ndescription: Cross Account Pipelines with IBM Cloud Toolchain\nkeywords: 'ibm cloud cicd'\n---\n\n<PageDescription>\n\nCross Account Pipelines with IBM Cloud Toolchain\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Overview</AnchorLink>\n  <AnchorLink>Setting up access to production kubernetes cluster</AnchorLink>\n</AnchorLinks>\n\n\n## Overview\nThe toolchain brings together many resources. A git repo, the Docker Registry, a Kubernetes Cluster and the toolchain itself.\n\nEverything created in the environment setup so far was done using a single IAM role, in a single resource group, in a single IBM Cloud Account. \n\n\n![CICD All Access](../../../images/cicd-toolchain-allaccess.png)    \n\nA powerful way to organize access is to put different IBM Cloud Resources into different **Resource Groups**.  \n\n\n![CICD Namespaces](../../../images/cicd-toolchain-rgs.png)       \n\nFor admin level or a higher level of isolation, it is common to put a production cluster in a different IBM Cloud Account from all other environments.\n\n![CICD Namespaces](../../../images/cicd-toolchain-accounts.png)    \n\n## Setting up access to production kubernetes cluster\n- Login into a second IBM Cloud Account, this will be \"Production\". \nYou will need to configure and create a k8s cluster by following [these instructions](../deploy-iks/setup-environment).\nAs a quick reference you can run the following command to create a cluster on VPC Gen 2.\n\n```bash\n$ ibmcloud ks cluster create vpc-gen2 --flavor FLAVOR --name NAME --subnet-id ID --vpc-id ID --zone ZONE\n``` \n\n- Create an API Key to access your cluster\n\n```bash\n$ ibmcloud iam api-key-create kubernetes-key\nCreating API key kubernetes-key under e65910fa61ce9072d64902d03f3d4774 as John.Zaccone@ibm.com...\nOK\nAPI key kubernetes-key was created\n\nPlease preserve the API key! It cannot be retrieved after it's created.\n                 \nID            ApiKey-0159e477-07d7-409d-ac84-c366528b6c65   \nName          kubernetes-key   \nDescription      \nCreated At    2020-05-12T17:44+0000   \nAPI Key       XXXXXXXXXXXX   \nLocked        false\n```\n\n<InlineNotification>\nThis will create a new API key that allows anyone who has it the ability to do anything you could do. \nTo make things more secure, you will want to create a service ID API key that limits access to only what your pipeline requires.\nThe following steps apply for any API key you create that has access to the Kubernetes cluster that you want to deploy to.\n</InlineNotification>\n\n- Log into the first account. This will be our \"Tools\" environment, where our pipeline lives, and where we will use the key to our Kubernetes cluster.\n\n- Find the **DevOps** page from the upper-left handside menu. Open the Toolchain you created earlier\n\n- Next to the **Deploy**, click the **Configure** icon\n\n![Configure Deploy Stage](../../../images/cicd-pipeline-configuredeploy.png)    \n\n- Change the **API Key** to the value you generated for your production cluster\n\n![Configure Deploy Stage](../../../images/cicd-pipeline-apikey.png)    \n\n- Save the values and rerun the Deploy stage to see the app deployed to your production cluster in your other account.","type":"Mdx","contentDigest":"81f254e8d43817512259d5c9e3a5479a","counter":634,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Cross Account Pipelines with IBM Cloud Toolchain","description":"Cross Account Pipelines with IBM Cloud Toolchain","keywords":"ibm cloud cicd"},"exports":{},"rawBody":"---\ntitle: Cross Account Pipelines with IBM Cloud Toolchain\ndescription: Cross Account Pipelines with IBM Cloud Toolchain\nkeywords: 'ibm cloud cicd'\n---\n\n<PageDescription>\n\nCross Account Pipelines with IBM Cloud Toolchain\n\n</PageDescription>\n\n<AnchorLinks small>\n  <AnchorLink>Overview</AnchorLink>\n  <AnchorLink>Setting up access to production kubernetes cluster</AnchorLink>\n</AnchorLinks>\n\n\n## Overview\nThe toolchain brings together many resources. A git repo, the Docker Registry, a Kubernetes Cluster and the toolchain itself.\n\nEverything created in the environment setup so far was done using a single IAM role, in a single resource group, in a single IBM Cloud Account. \n\n\n![CICD All Access](../../../images/cicd-toolchain-allaccess.png)    \n\nA powerful way to organize access is to put different IBM Cloud Resources into different **Resource Groups**.  \n\n\n![CICD Namespaces](../../../images/cicd-toolchain-rgs.png)       \n\nFor admin level or a higher level of isolation, it is common to put a production cluster in a different IBM Cloud Account from all other environments.\n\n![CICD Namespaces](../../../images/cicd-toolchain-accounts.png)    \n\n## Setting up access to production kubernetes cluster\n- Login into a second IBM Cloud Account, this will be \"Production\". \nYou will need to configure and create a k8s cluster by following [these instructions](../deploy-iks/setup-environment).\nAs a quick reference you can run the following command to create a cluster on VPC Gen 2.\n\n```bash\n$ ibmcloud ks cluster create vpc-gen2 --flavor FLAVOR --name NAME --subnet-id ID --vpc-id ID --zone ZONE\n``` \n\n- Create an API Key to access your cluster\n\n```bash\n$ ibmcloud iam api-key-create kubernetes-key\nCreating API key kubernetes-key under e65910fa61ce9072d64902d03f3d4774 as John.Zaccone@ibm.com...\nOK\nAPI key kubernetes-key was created\n\nPlease preserve the API key! It cannot be retrieved after it's created.\n                 \nID            ApiKey-0159e477-07d7-409d-ac84-c366528b6c65   \nName          kubernetes-key   \nDescription      \nCreated At    2020-05-12T17:44+0000   \nAPI Key       XXXXXXXXXXXX   \nLocked        false\n```\n\n<InlineNotification>\nThis will create a new API key that allows anyone who has it the ability to do anything you could do. \nTo make things more secure, you will want to create a service ID API key that limits access to only what your pipeline requires.\nThe following steps apply for any API key you create that has access to the Kubernetes cluster that you want to deploy to.\n</InlineNotification>\n\n- Log into the first account. This will be our \"Tools\" environment, where our pipeline lives, and where we will use the key to our Kubernetes cluster.\n\n- Find the **DevOps** page from the upper-left handside menu. Open the Toolchain you created earlier\n\n- Next to the **Deploy**, click the **Configure** icon\n\n![Configure Deploy Stage](../../../images/cicd-pipeline-configuredeploy.png)    \n\n- Change the **API Key** to the value you generated for your production cluster\n\n![Configure Deploy Stage](../../../images/cicd-pipeline-apikey.png)    \n\n- Save the values and rerun the Deploy stage to see the app deployed to your production cluster in your other account.","fileAbsolutePath":"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/src/pages/ci-cd/cloud-toolchain-across-accounts/index.mdx"}}}}