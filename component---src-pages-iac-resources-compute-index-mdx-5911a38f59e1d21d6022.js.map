{"version":3,"sources":["webpack:///./src/pages/iac-resources/compute/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","InlineNotification","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","small","kind","isMDXComponent"],"mappings":"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","file":"component---src-pages-iac-resources-compute-index-mdx-5911a38f59e1d21d6022.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/johandry/Workspace/ibm/att-cloudnative/ibmcloud-pattern-guide/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst InlineNotification = makeShortcode(\"InlineNotification\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    {\n      /*\n      The pattern to document the resources is like follow:\n      - Introduce the resource with an example\n      - List all or the most important input parameters\n      - If will be used, list the most important output parameters\n      - Provide instructions to get the value of the input parameters, either using `ibmcloud`, API or the Web console.\n      - If needed, instructions to execute the code either with Terraform or Schematics\n      */\n    }\n    {\n      /*\n      TODO: Is is possible to get the image and profile from ibm_is_images and ibm_is_instance_profiles ??\n      TODO: The code is failing, there is no access to the VSIs, could be the Health Check\n      TODO: Move all the Hard Coded code to variables, document how to get the values\n      TODO: Update the final code\n      */\n    }\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Automating compute resources with Terraform and Schematics. Compute images and instances life cycle`}</p>\n    </PageDescription>\n    <p>{`One of the basic and atomic services every cloud provide is compute. Compute on IBM Cloud covers different services however this pattern guide is about the IBM Cloud Virtual Servers, also called Virtual Server Instances or VSI, how to customize public and private virtual servers that scale up or down to suit your needs, using Terraform and IBM Cloud Schematics. Other IBM Cloud Compute services such as Kubernetes, OpenShift, Container Registry and Cloud Functions are covered in other pattern guides.`}</p>\n    <p>{`Based on the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac-resources/network\"\n      }}>{`Network Resources`}</a>{` pattern we would like to add a few compute resources and storage to host and expose an API with movies.`}</p>\n    <p>{`The following diagram shows the proposed architecture.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"762px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"117.01388888888889%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAFAElEQVQ4y4WUa4wTVRTHB4Tusm1XBep+8INREz+YIComvqKbIGD8gt80G42GAItREXSBSJAgEE1AQY1RIyJ+cAFFIo8AiwSNBHwssAul0N12aaevmbm98+w8+5jp8czQ1QVNnMmv9/bMOf85955zh2EY5qkWDyOPIQ8hc5HHkXuQJ1r/H23Nfb9ZyAPI00gXwtzadQczft2O3Inc1RIYn0eR9hYRJHwD4/Y2ZDJyU0A0ektXeyg0Y1pHePq0trbp7W2hGe04RsPhyDidkUgYx3Bni+g10I4/HR0RJBpub49OmTI1ytw9Z17vrAUvxGY/+WxX9+INHa/tH53Ss/3I1PkrPgwtQLpfeS8067m3Qvf3rA7m89/4IDR/+dZgnPf6ltCCldtCz/R9Epq38qPQfQtfncrEVvQvnLzyQDfDTA+1UveZdB0zAEd+0r/sNxBZf7KNmfvOrtsyBf57SZZ/FiV6jIr0OI4DPpIsDnB8aSB+6eJA4nJigOe5ARlt488n+J0kAr+n5/MTEebcUZh54vIxklaT4F9NaIAHbnB7/t1sQK3hQL1RhQbOfWsTgRYu2vyLSmVj7d7hTqZv648xlmczgipDkar1TFl1iWq4hmm5mm66vKy5OVFz87LhKvjft0ua7uap4map5gqKUTdsG8oi4dbsGepknl/3RUxVJfZoksKpjOHlSQVKRALVsGBMkKF/SIA0caDAi8CJGti2BYfiJfhlzADflyOSp1hVP0OyZvf5TqZ3w2cxQRZZURaBHl7t0T++A0GpAVU0UIwqcIN7QTq8FkhJAF4y8EU2CHwe6KE+KA8eQN+6J+vWNcH+cyi47uMYURRWLZeA2zzbyx/fDknNAqFMoOK4wO17G7ht3TBGCWaMNrsOlL0CpXfvheKvO9HX8URVBVGmZNW3f3YySzfujBGpzCoVA0q86A2nR2H3bz9AIpsE06pBrsBBJs/B8cQpOHz2GOimjX4EsjkOkqU89J/Z56W4DCiqQpbt+AkzHBfEtHlO9AqZHFy6nIAiwWxwH4u4d7lMHrJXr0Iqi4EVHW1l4DgRCtkcpNIpT5AlzFAkb35zGgU3fR0jYplVTQdKVPV4AR0FBXiqoKAJJSxErsADTxQgiomBKj6TgwLx+DJB0j0FY//ew6W+IGYo6xhccTzerAOnV6EoUJBVDQTVhBwKlfQalCQd20PCglUCH95qAIcx/xTlbCezbPOumCAS1nKaUK7UPV5zgFOxr+QKEIqtgiI5qqHNgpwggYTVF1GwpOAWaTZwinm94EsbPo2JssyeyZyGeG7YK8sEKCJXVFC0CgiEAiljS4kyLptiUUxQNT0Qln1kzdMtu9WHuORF2IdUltgENwSj7KAnFFMokgaqCmCho6b5gdjomgq6oaPNuhGvVq8Fgqv3nPeX/FVMoLjkehVk9pSnHlkONHMSaEUBE7OxbRNSl/C0JEhwSnzbRCxzgmBwUjbtCATVqgFc/KBXfP+RJn9hf1M0taZpGE3bsZrJIdK8gvhzFLmOCYJCkOHSjV9ilWlWrYhApFyDSAWXSKwryoJr2Y6LS3Idxw7w57gNE7Bc27Ib1Vpwlvk+vyjLt/TP5ClP6vjZMhwDrJoNVtUKqNad/8VBf/9zRyivbTyYjjIPvrx+5u/xZE88NdZ7YSS9+OJIesnF0TEkvWR4JHWNZIuR/yCZWoxxvYPxKy/OWbXz5r8ASEkENBhtSl8AAAAASUVORK5CYII=')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"architecture\",\n        \"title\": \"Compute Resources Architecture\",\n        \"src\": \"/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/1b1fd/IaC-Compute_Resources.png\",\n        \"srcSet\": [\"/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/7fc1e/IaC-Compute_Resources.png 288w\", \"/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/a5df1/IaC-Compute_Resources.png 576w\", \"/cloud-enterprise-examples/static/833469490cd4845c8944b36c3d043e16/1b1fd/IaC-Compute_Resources.png 762w\"],\n        \"sizes\": \"(max-width: 762px) 100vw, 762px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`The code to build these resources can be downloaded from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute\"\n      }}>{`07-compute`}</a>{`.`}</p>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Virtual Server Instance</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Virtual Server Instance with IBM Cloud Schematics</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Load Balance a Cluster of VSI</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">IBM Cloud Object Storage</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Volumes</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Final Terraform code</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Clean up</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Compute Resources & Data Source Reference</AnchorLink>\n    </AnchorLinks>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Requirements`}</strong></p>\n      <p>{`To be able to execute and complete the instructions in this page, make sure you have an `}<strong parentName=\"p\">{`IBM Cloud account`}</strong>{`: if you don’t have one yet, you can `}<a parentName=\"p\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/overview?topic=overview-quickstart_lite#prereqs-lite\"\n        }}>{`create a Lite account`}</a>{` for free.`}</p>\n      <p>{`Also make sure you have the environment setup as explained in the `}<a parentName=\"p\" {...{\n          \"href\": \"/cloud-enterprise-examples/iac/setup-environment\"\n        }}>{`Setup Environment`}</a>{` page to have installed the IBM Cloud CLI, login into your account with the IBM Cloud CLI and create a SSH Key.`}</p>\n    </InlineNotification>\n    <h2>{`Virtual Server Instance`}</h2>\n    <p>{`Before create a VSI we need to have all the networking resources created. The list of resources includes: VPC, Subnets in one or more zones, Public gateway for public internet communication, ACL’s for inbound and outbound traffic to the subnets. All these resources management is covered in the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/networking\"\n      }}>{`Networking section`}</a>{` where the required network resources were created in the `}<inlineCode parentName=\"p\">{`networking.tf`}</inlineCode>{` file.`}</p>\n    <p>{`The following code is an example to create a VSI, for this we use the `}<inlineCode parentName=\"p\">{`ibm_is_instance`}</inlineCode>{` resource.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`resource \"ibm_is_ssh_key\" \"iac_app_key\" {\n  name       = \"\\${var.project_name}-\\${var.environment}-key\"\n  public_key = var.public_key\n}\n\nresource \"ibm_is_instance\" \"iac_app_instance\" {\n  name    = \"\\${var.project_name}-\\${var.environment}-instance\"\n  image   = \"r006-14140f94-fcc4-11e9-96e7-a72723715315\"\n  profile = \"cx2-2x4\"\n\n  primary_network_interface {\n    name            = \"eth1\"\n    subnet          = ibm_is_subnet.iac_app_subnet.id\n    security_groups = [ibm_is_security_group.iac_app_security_group.id]\n  }\n\n  vpc  = ibm_is_vpc.iac_app_vpc.id\n  zone = \"us-south-1\"\n  keys = [ibm_is_ssh_key.iac_app_key.id]\n\n  user_data = <<-EOUD\n              #!/bin/bash\n              echo \"Hello World\" > index.html\n              nohup busybox httpd -f -p \\${var.port} &\n              EOUD\n\n  tags = [\"iac-\\${var.project_name}-\\${var.environment}\"]\n}\n`}</code></pre>\n    <p>{`The variables used in this code are defined at `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"public_key\" {}\n\nvariable \"port\" {\n  default = 8080\n}\n`}</code></pre>\n    <p>{`The value of the variables are set in the `}<inlineCode parentName=\"p\">{`terraform.tfvars`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`*.auto.tfvars`}</inlineCode>{` files. As we are going to use this code with the Terraform CLI on our local host and with IBM Cloud Schematics we should not use `}<inlineCode parentName=\"p\">{`file(pathexpand(var.public_key_file))`}</inlineCode>{` to get the value of a public key file like `}<inlineCode parentName=\"p\">{`~/.ssh/id_rsa.pub`}</inlineCode>{` because it doesn’t work on IBM Cloud Schematics. Instead let’s send the content of the public key file to the variable `}<inlineCode parentName=\"p\">{`public_key`}</inlineCode>{` in the `}<inlineCode parentName=\"p\">{`secrets.auto.tfvars`}</inlineCode>{` file using the following command.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`echo \"public_key = \\\\\"$(cat ~/.ssh/id_rsa.pub)\\\\\"\" > secrets.auto.tfvars\n`}</code></pre>\n    <p>{`It is `}<strong parentName=\"p\">{`important`}</strong>{` you make sure to include the file `}<inlineCode parentName=\"p\">{`secrets.auto.tfvars`}</inlineCode>{` to the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file so you don’t share your secrets to the world.`}</p>\n    <p>{`To test this VSI we’ll deploy a server to expose an API from a `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute/db.json\"\n      }}>{`movies database`}</a>{` JSON file. This is a sample of it:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"movies\": [{\n    \"id\": \"83\",\n    \"title\": \"Akira Kurosawa's Dreams\",\n    \"summary\": \"This is essentially eight separate short films, with some overlaps in characters and thematic material - that of man's relationship with his environment. 'Sunshine Through The Rain' - 'The Peach Orchard' - 'The Blizzard' - 'Crows' - 'Mount Fuji in Red' - The Weeping Demon' - 'Village of the Watermills'\",\n    \"year\": \"1990\",\n    \"duration\": \"7173610\",\n    \"originallyAvailableAt\": \"1990-05-11\",\n    \"addedAt\": \"1348382738\",\n    \"updatedAt\": \"1531023643\",\n    \"genre\": \"Sci-Fi & Fantasy\",\n    \"director\": [\"Akira Kurosawa\", \"Ishirô Honda\"],\n    \"writer\": [\"Akira Kurosawa\"],\n    \"cast\": [\"Akira Terao\", \"Mitsuko Baisho\", \"Toshie Negishi\"]\n  }, {\n    ...\n  }]\n}\n`}</code></pre>\n    <p>{`To deploy the JSON file to the provisioned VSI the first step is to load the file using the data source `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.terraform.io/docs/providers/local/d/file.html\"\n      }}>{`local_file`}</a>{`, the file content can be obtained with the attribute `}<inlineCode parentName=\"p\">{`content`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`content_base64`}</inlineCode>{` if you require the file content encoded.`}</p>\n    <p>{`In the `}<inlineCode parentName=\"p\">{`user_data`}</inlineCode>{` attribute use the command `}<inlineCode parentName=\"p\">{`echo`}</inlineCode>{` with `}<inlineCode parentName=\"p\">{`base64`}</inlineCode>{` to print the decoded content of the JSON file that was previously encoded using the `}<inlineCode parentName=\"p\">{`content_base64`}</inlineCode>{` attribute of the `}<inlineCode parentName=\"p\">{`local_file`}</inlineCode>{` data source. Terraform sends the content of the file to the IBM Cloud engine through HTTP, it is recommended to encode this text otherwise we can get unexpected results. That’s why we’ll use the attribute `}<inlineCode parentName=\"p\">{`content_base64`}</inlineCode>{` instead of `}<inlineCode parentName=\"p\">{`content`}</inlineCode>{`, and we use the command `}<inlineCode parentName=\"p\">{`base64`}</inlineCode>{`, at the server side, to decode the received text.`}</p>\n    <p>{`Modify the value of the `}<inlineCode parentName=\"p\">{`user_data`}</inlineCode>{` attribute of `}<inlineCode parentName=\"p\">{`ibm_is_instance.iac_app_instance`}</inlineCode>{` and add the `}<inlineCode parentName=\"p\">{`local_file`}</inlineCode>{` data source, like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`data \"local_file\" \"db\" {\n  filename = \"\\${path.module}/db.min.json\"\n}\n\nresource \"ibm_is_instance\" \"iac_app_instance\" {\n  ...\n  user_data = <<-EOUD\n            #!/bin/bash\n            echo '\\${data.local_file.db.content_base64}' | base64 --decode > /var/lib/db.min.json\n\n            echo '* libraries/restart-without-asking boolean true' | debconf-set-selections\n            apt update\n            curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -\n            apt-get install -y nodejs\n            npm install -g json-server\n\n            json-server --watch /var/lib/db.min.json --port \\${var.port} --host 0.0.0.0 &\n            EOUD\n  ...\n}\n`}</code></pre>\n    <InlineNotification mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`user_data vs provisioners`}</strong></p>\n      <p>{`Should I use `}<inlineCode parentName=\"p\">{`user_data`}</inlineCode>{` or provisioners such as `}<inlineCode parentName=\"p\">{`file`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`remote-exec`}</inlineCode>{`?`}</p>\n      <p>{`Terraform is a provisioning tool, it should not do configuration tasks maybe just trigger them. Among the configuration management tools are: Ansible, Cloud-Init, Puppet and (the less recommended) shell scripts. Thus, the appropriate way to configure a server or trigger the configuration should be using `}<inlineCode parentName=\"p\">{`user_data`}</inlineCode>{`, it can execute either a Cloud-Init code, a script or to start a configuration management tool like Ansible. The `}<inlineCode parentName=\"p\">{`user_data`}</inlineCode>{` is also used by the auto-scaling in IBM Cloud and Terraform provisioners are not.`}</p>\n      <p>{`The provisioners such as `}<inlineCode parentName=\"p\">{`file`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`remote-exec`}</inlineCode>{` are specific to Terraform that’s why they are not suggested for configuration management. If you would like to use them, read `}<a parentName=\"p\" {...{\n          \"href\": \"/cloud-enterprise-examples/iac/resources/compute/provisioners\"\n        }}>{`Using Terraform Provisioners`}</a>{`.`}</p>\n    </InlineNotification>\n    <p>{`We are introducing a new Terraform plugin (`}<inlineCode parentName=\"p\">{`local`}</inlineCode>{`) with the `}<inlineCode parentName=\"p\">{`local_file`}</inlineCode>{` data source, so before apply the infrastructure code and deploy the application we need to download this plugin with the `}<inlineCode parentName=\"p\">{`terraform init`}</inlineCode>{` command. Execute the following commands to apply the new code:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform init\nterraform plan\nterraform apply\n`}</code></pre>\n    <p>{`In about a minute the VSI is provisioned but the API server will be running in about an extra minute. To verify it’s working get the `}<inlineCode parentName=\"p\">{`public_ip`}</inlineCode>{` output variable to fetch some movies, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`curl \"$(terraform output entrypoint)/movies\" | jq\ncurl \"$(terraform output entrypoint)/movies/675\"\ncurl \"$(terraform output entrypoint)/movies?id=1067&id=1649\"\n`}</code></pre>\n    <p>{`If you do not see any response, please, give it a minute or two, it takes some time to install all the dependencies to run the API server.`}</p>\n    <h2>{`Virtual Server Instance with IBM Cloud Schematics`}</h2>\n    <p>{`As seen in the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloud-enterprise-examples/iac/schematics\"\n      }}>{`IBM Cloud Schematics`}</a>{` pattern a similar HCL code can be used with IBM Cloud Schematics and Terraform CLI, the only change is that Schematics cannot access your local filesystem but it can access the files located in the git repository or remote files.`}</p>\n    <p>{`To create this project on IBM Cloud Schematics create a JSON Workspace template file like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\",\n        \"metastring\": \"path=workspace.tmpl.json\",\n        \"path\": \"workspace.tmpl.json\"\n      }}>{`{\n  \"name\": \"iac_schematics_test\",\n  \"type\": [\n    \"terraform_v0.12\"\n  ],\n  \"description\": \"Sample workspace to test IBM Cloud Schematics. Deploys an web server on a VSI with a Hello World response\",\n  \"tags\": [\n    \"app:helloworld\",\n    \"env:dev\"\n  ],\n  \"template_repo\": {\n    \"url\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute\"\n  },\n  \"template_data\": [{\n    \"folder\": \".\",\n    \"type\": \"terraform_v0.12\",\n    \"variablestore\": [{\n        \"name\": \"project_name\",\n        \"value\": \"iac_schematics_test\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"environment\",\n        \"value\": \"dev\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"public_key\",\n        \"value\": \"{ PUBLIC_KEY }\",\n        \"type\": \"string\"\n      }\n    ]\n  }]\n}\n`}</code></pre>\n    <p>{`Then execute the following commands to create the Workspace, provision the VSI and deploy the application.`}</p>\n    {\n      /*\n      In the current version of the IBM Cloud Schematics plugin there is an error when the terraform_v0.12 is used.\n      To workaround this error export the variable:\n        export X_FEATURE_SANDBOX=true\n      This error should be fixed in the next release of the plugin\n      */\n    }\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`# Verify you are logged in to the right account\nibmcloud target\n\n# Get the content of the SSH public key and render it into the JSON file using the template\nPUBLIC_KEY=\"$(cat ~/.ssh/id_rsa.pub)\"\nsed \"s|{ PUBLIC_KEY }|$PUBLIC_KEY|\" workspace.tmpl.json > workspace.json\n\n# Create the Schematics Workspace\nibmcloud schematics workspace new --file workspace.json\n\n# List the Workspaces and get the Workspace ID\nibmcloud schematics workspace list\nID=$(ibmcloud schematics workspace list --json | jq -r '.workspaces[] | select(.name == \"iac_schematics_test\") | .id')\n\n# Planning and Provisioning\nact_ID=$(ibmcloud schematics plan --id $ID --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n\nact_ID=$(ibmcloud schematics apply --id $ID --force --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n`}</code></pre>\n    <p>{`You may have to wait 2-3 seconds between the execution of an action (i.e. `}<inlineCode parentName=\"p\">{`apply`}</inlineCode>{`) and the retrieval of the logs. Also, you may have to execute the retrieval of the `}<inlineCode parentName=\"p\">{`apply`}</inlineCode>{` logs several times until the task is completed.`}</p>\n    <p>{`If the Workspace JSON file is modified, for example a variable value, you can update it with the command `}<inlineCode parentName=\"p\">{`ibmcloud schematics workspace update`}</inlineCode>{`.`}</p>\n    <p>{`To verify the application is running, get the output variables and use `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{` to get the page:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud schematics workspace output --id $ID --json\nIP=$(ibmcloud schematics workspace output --id $ID --json | jq -r '.[].output_values[].ip_address.value')\nADDR=$(ibmcloud schematics workspace output --id $ID --json | jq -r '.[].output_values[].entrypoint.value')\n\ncurl \"\\${ADDR}/movies/675\"\n`}</code></pre>\n    <InlineNotification kind=\"warning\" mdxType=\"InlineNotification\">\n      <p><strong parentName=\"p\">{`Sensitive data in JSON file`}</strong></p>\n      <p>{`The file `}<inlineCode parentName=\"p\">{`workspace.json`}</inlineCode>{` contain your SSH public key, make sure this file is not committed to the Git repository. Add the `}<inlineCode parentName=\"p\">{`workspace.json`}</inlineCode>{` filename to the `}<inlineCode parentName=\"p\">{`.gitignore`}</inlineCode>{` file.`}</p>\n    </InlineNotification>\n    <h2>{`Identify Input Parameters Values`}</h2>\n    <p>{`In the Getting Started with Terraform section was explained how to get the value of the input parameters such as the instance `}<inlineCode parentName=\"p\">{`image`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`profile`}</inlineCode>{` using the IBM Cloud CLI and some Unix commands.`}</p>\n    <p>{`It’s also possible to get these parameters using the Data Sources `}<inlineCode parentName=\"p\">{`ibm_is_instance_profile`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`ibm_is_image`}</inlineCode>{`. Modify the `}<inlineCode parentName=\"p\">{`compute.tf`}</inlineCode>{` file to add the following data sources.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`data \"ibm_is_image\" \"ds_iac_app_image\" {\n  name = \"ibm-ubuntu-18-04-1-minimal-amd64-1\"\n}\n\nresource \"ibm_is_instance\" \"iac_app_instance\" {\n  ...\n  image   = data.ibm_is_image.ds_iac_app_image.id\n  ...\n}\n`}</code></pre>\n    <p>{`This change is not much but give more information to the developer reading the code if the the image name is used instead of the ID. You still need to execute the following IBM Cloud CLI commands to find the image and profile name, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud is images\nibmcloud is images | grep available | grep ubuntu-18 | grep amd64 | cut -f2 -d\" \"\nibmcloud is images --json | jq -r '.[] | select(.status==\"available\" and .operating_system.name==\"ubuntu-18-04-amd64\").name'\n\nibmcloud is instance-profiles\nibmcloud is instance-profiles | grep amd64 | sort -k4 -k5 -n | head -1 | cut -f1 -d\" \"\nibmcloud is instance-profiles --json | jq -r 'map(select(.vcpu_architecture.value==\"amd64\")) | sort_by(.memory.value)[0].name'\n`}</code></pre>\n    {\n      /* TODO: Is is possible to get the image and profile from ibm_is_images and ibm_is_instance_profiles ?? */\n    }\n    <h2>{`Load Balance a Cluster of VSI`}</h2>\n    <p>{`Running a single server serve the purpose but it’s a single point of failure, if this single server fails the API is not accessible. The solution is to have a cluster of Virtual Servers, routing the traffic to the servers that are working and scaling the size up or down based on the traffic load. IBM Cloud allow us to get this features with the Load Balancer service and Terraform resources.`}</p>\n    <p>{`You can read more about the type of Load Balancers, Listeners, Pools, LB Methods and more in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers\"\n      }}>{`Load Balancer documentation`}</a>{` for IBM CLoud Gen 2.`}</p>\n    <p>{`We’ll begin the Load Balancer code by creating a `}<inlineCode parentName=\"p\">{`ibm_is_lb`}</inlineCode>{` resource in the `}<inlineCode parentName=\"p\">{`lb.tf`}</inlineCode>{` file, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=lb.tf\",\n        \"path\": \"lb.tf\"\n      }}>{`resource \"ibm_is_lb\" \"iac_app_lb\" {\n  name    = \"\\${var.project_name}-\\${var.environment}-lb\"\n  subnets = [ibm_is_subnet.iac_app_subnet.id]\n}\n`}</code></pre>\n    <p>{`It requires an ID reference of the subnets where the LB is located. The VSI that are served by this Load Balancer should be in the same VPC and region. This specific LB name is formed by the project name and environment to not collide with other Load Balancers. Other important parameter is `}<inlineCode parentName=\"p\">{`type`}</inlineCode>{` to define if the LB will be `}<inlineCode parentName=\"p\">{`public`}</inlineCode>{` (default) or `}<inlineCode parentName=\"p\">{`private`}</inlineCode>{`, this would be public so the fully qualified domain name (FQDN) will be accessible from the internet and have assigned multiple public IP addresses.`}</p>\n    <p>{`For private load balancers the access is restricted to internal clients on the same subnet, region and VPC. It also has assigned a FQDN with multiple IP addresses and only accepts traffic from `}<a parentName=\"p\" {...{\n        \"href\": \"https://tools.ietf.org/html/rfc1918\"\n      }}>{`RFC1918`}</a>{` address spaces such as those in the blocks 10.0.0.0/8, 172.16.0.0/12 and 192.168.0.0/16.`}</p>\n    <p>{`The Load Balancer needs a listener to listen on a given port and protocol. The FQDN and port assigned to the load balancer are exposed to the public internet. The traffic is then redirected to a pool member or VSI from the assigned default pool. The API on the VSI is listening/serving on port `}<inlineCode parentName=\"p\">{`8080`}</inlineCode>{` by default, unless a different port is set in the `}<inlineCode parentName=\"p\">{`port`}</inlineCode>{` variable. We can make the LB listener to use the same port or different, in this case, let’s use the same.`}</p>\n    <p>{`The available protocols on the LB listener are `}<strong parentName=\"p\">{`HTTP`}</strong>{`, `}<strong parentName=\"p\">{`HTTPS`}</strong>{` and `}<strong parentName=\"p\">{`TCP`}</strong>{`, this one uses the HTTP protocol. The pool or VSI protocols supported are only HTTP and TCP, in this case it’s HTTP. Let’s append the following code to `}<inlineCode parentName=\"p\">{`lb.tf`}</inlineCode>{` to define the LB listener:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=lb.tf\",\n        \"path\": \"lb.tf\"\n      }}>{`resource \"ibm_is_lb_listener\" \"iac_app_lb_listener\" {\n  lb       = ibm_is_lb.iac_app_lb.id\n  port     = var.port\n  protocol = \"http\"\n  default_pool = ibm_is_lb_pool.iac_app_lb_pool.id\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ibm_is_lb`}</inlineCode>{` ID, `}<inlineCode parentName=\"p\">{`port`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`protocol`}</inlineCode>{` are required parameters. Other optional parameters are `}<inlineCode parentName=\"p\">{`default_pool`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`certificate_instance`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`connection_limit`}</inlineCode>{`, the last two are not needed for this project.`}</p>\n    <p>{`On the other side of the Load Balancer are the VSI or backend application which are identified as a Pool Member (`}<inlineCode parentName=\"p\">{`ibm_is_lb_pool_member`}</inlineCode>{`) that is, obviously, a member of the defined pool (`}<inlineCode parentName=\"p\">{`ibm_is_lb_pool`}</inlineCode>{`). Let’s begin modifying the VSI `}<inlineCode parentName=\"p\">{`ibm_is_instance.iac_app_instance`}</inlineCode>{` resource in the `}<inlineCode parentName=\"p\">{`compute.tf`}</inlineCode>{` file to have multiple instances adding the Terraform `}<inlineCode parentName=\"p\">{`count`}</inlineCode>{` parameter and modifying the `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` parameter to include the number of that instance. Like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`...\nresource \"ibm_is_instance\" \"iac_app_instance\" {\n  name    = \"\\${var.project_name}-\\${var.environment}-instance-\\${format(\"%02s\", count.index)}\"\n  ...\n  count   = var.max_size\n  ...\n}\n`}</code></pre>\n    <p>{`The new variable `}<inlineCode parentName=\"p\">{`max_size`}</inlineCode>{` defines how many VSI, therefore how many pool members too, will be created. This variable is defined like this in the `}<inlineCode parentName=\"p\">{`variables.tf`}</inlineCode>{` file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`variable \"max_size\" {\n  default = 3\n}\n`}</code></pre>\n    <p>{`All is set to create the Pool and the Pool Members, add the following code to the `}<inlineCode parentName=\"p\">{`lb.tf`}</inlineCode>{` file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=lb.tf\",\n        \"path\": \"lb.tf\"\n      }}>{`resource \"ibm_is_lb_pool\" \"iac_app_lb_pool\" {\n  name                = \"\\${var.project_name}-\\${var.environment}-lb-pool\"\n  lb                  = ibm_is_lb.iac_app_lb.id\n  algorithm           = \"round_robin\"\n  protocol            = \"http\"\n  health_delay        = 5\n  health_retries      = 2\n  health_timeout      = 2\n  health_type         = \"http\"\n  health_monitor_url  = \"/\"\n  health_monitor_port = var.port\n}\n\nresource \"ibm_is_lb_pool_member\" \"iac_app_lb_pool_mem\" {\n  count          = var.max_size\n  lb             = ibm_is_lb.iac_app_lb.id\n  pool           = ibm_is_lb_pool.iac_app_lb_pool.id\n  port           = var.port\n  target_address = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.primary_ipv4_address\n  weight         = (100 - count.index)\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool.iac_app_lb_pool`}</inlineCode>{` resource requires the following input attributes:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name of the pool. In this case it has the name of the project and environment to not collide with other pools`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`lb`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`ID of the load balancer is linked to`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`algorithm`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`load balancing algorithm. Supported values are `}<inlineCode parentName=\"td\">{`round_robin`}</inlineCode>{`, `}<inlineCode parentName=\"td\">{`weighted_round_robin`}</inlineCode>{`, or `}<inlineCode parentName=\"td\">{`least_connections`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`protocol`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`pool protocol. Supported values are `}<inlineCode parentName=\"td\">{`http`}</inlineCode>{`, and `}<inlineCode parentName=\"td\">{`tcp`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`health_delay`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`health check interval in seconds. Interval must be greater than timeout value`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`health_retries`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`health check max retries`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`health_timeout`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`health check timeout in seconds`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`health_type`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`pool protocol. Supported values are `}<inlineCode parentName=\"td\">{`http`}</inlineCode>{`, and `}<inlineCode parentName=\"td\">{`tcp`}</inlineCode></td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`Other input and output parameters are described in the `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool`}</inlineCode>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool\"\n      }}>{`resource documentation`}</a>{`. The 3 different load balancing methods to set in the `}<inlineCode parentName=\"p\">{`algorithm`}</inlineCode>{` input parameter are described in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers#load-balancing-methods\"\n      }}>{`Load Balancers documentation`}</a>{`.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool_member.iac_app_lb_pool_mem`}</inlineCode>{` is actually a list of resources because it also has the Terraform `}<inlineCode parentName=\"p\">{`count`}</inlineCode>{` attribute, just like the `}<inlineCode parentName=\"p\">{`ibm_is_instance`}</inlineCode>{` resource and this is because we need one pool member per VSI.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool_member`}</inlineCode>{` uses the `}<inlineCode parentName=\"p\">{`target_address`}</inlineCode>{` attribute to link the pool member to the VSI using its IP address. Here we use the `}<inlineCode parentName=\"p\">{`count.index`}</inlineCode>{` to reference to the VSI with the same index, so the pool member 0 is linked to the VSI 0, and so on. As we did to link the Floating IP to the IP address of the VSI, this IP address is identified by the `}<inlineCode parentName=\"p\">{`ibm_is_instance.iac_app_instance`}</inlineCode>{` resource output parameter `}<inlineCode parentName=\"p\">{`primary_network_interface.0.primary_ipv4_address`}</inlineCode>{`.`}</p>\n    <p>{`The required input attributes for `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool_member`}</inlineCode>{` are:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`pool`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`ID of the load balancer pool`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`lb`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`load balancer ID`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`port`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`port number of the application running in the server member, in this case is in the variable `}<inlineCode parentName=\"td\">{`port`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`target_address`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`IP address of the pool member or VSI`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`weight`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`weight of the server member. This parameter is optional and it takes effect only when the load balancing algorithm of its belonging pool is `}<inlineCode parentName=\"td\">{`weighted_round_robin`}</inlineCode></td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`More information about this resource can be found at the `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool_member`}</inlineCode>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool-member\"\n      }}>{`resource documentation`}</a>{`.`}</p>\n    <p>{`The load balancer adjusts its capacity automatically according to the load. When this adjustment occurs, you may see a change in the number of IP addresses associated with the load balancer’s DNS name. To know the load balancer’s DNS name and the associated IP addresses we use the following output variables to be included in the file `}<inlineCode parentName=\"p\">{`output.tf`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.tf\",\n        \"path\": \"output.tf\"\n      }}>{`output \"lb_ip_address\" {\n  value = ibm_is_lb.iac_app_lb.public_ips\n}\n\noutput \"entrypoint\" {\n  value = \"http://\\${ibm_is_lb.iac_app_lb.hostname}:\\${var.port}\"\n}\n`}</code></pre>\n    <p>{`The new value of `}<inlineCode parentName=\"p\">{`entrypoint`}</inlineCode>{` has now the hostname or FQDN of the load balancer.`}</p>\n    <p>{`Having a load balancer there is no need to have floating IP assigned to every VSI so you can remove them but in case you want to keep them you need one per VSI, so you have to do something similar done with the pool members modifying the `}<inlineCode parentName=\"p\">{`ibm_is_floating_ip.iac_app_floating_ip`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`ip_address`}</inlineCode>{` output variable that uses this resource, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"network.tf\",\n        \"network.tf\": true\n      }}>{`resource \"ibm_is_floating_ip\" \"iac_app_floating_ip\" {\n  name   = \"\\${var.project_name}-\\${var.environment}-ip\"\n  target = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.id\n  count  = var.max_size\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`output \"ip_address\" {\n  value = ibm_is_floating_ip.iac_app_floating_ip[*].address\n}\n`}</code></pre>\n    <p>{`Here we use `}<inlineCode parentName=\"p\">{`[*]`}</inlineCode>{` to let Terraform knows that we need the `}<inlineCode parentName=\"p\">{`address`}</inlineCode>{` of all the `}<inlineCode parentName=\"p\">{`iac_app_floating_ip`}</inlineCode>{` resources. This variable would be a list just like `}<inlineCode parentName=\"p\">{`lb_ip_address`}</inlineCode>{`.`}</p>\n    <p>{`But, again, there is no need to have Floating IP’s assigned per VSI, the Load Balancer provide the FQDN and an IP per pool member or VSI. Remove the Floating IP’s once you verify the Load Balancer works.`}</p>\n    <h2>{`Health Checks`}</h2>\n    <p>{`Health check definitions are mandatory for back-end pools. Not having health checks cause the pool identify the pool members as unhealthy therefore not forwarding new connections to them.`}</p>\n    <p>{`The health check is configured in the `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool`}</inlineCode>{` resource using the `}<inlineCode parentName=\"p\">{`health_*`}</inlineCode>{` attributes. Read the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-load-balancers#health-checks\"\n      }}>{`Health Check documentation`}</a>{` and the `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool`}</inlineCode>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources#lb-pool-input\"\n      }}>{`input attributes`}</a>{` that can be used for health check.`}</p>\n    <p>{`Health checks can be configured on back-end ports or on a separate health check port, based on the application. For this application, the API is being served with HTTP protocol, so we ser the input parameter `}<inlineCode parentName=\"p\">{`health_type`}</inlineCode>{` of `}<inlineCode parentName=\"p\">{`ibm_is_lb_pool`}</inlineCode>{` to `}<inlineCode parentName=\"p\">{`http`}</inlineCode>{`. The port to monitor is the same port where the API is exposed so the `}<inlineCode parentName=\"p\">{`health_monitor_port`}</inlineCode>{` parameter is set to the value we have on the variable `}<inlineCode parentName=\"p\">{`port`}</inlineCode>{` but if not set, the port used in the pool member will be used. Finally, the URL to monitor is the path to be used for the health check, the default value is `}<inlineCode parentName=\"p\">{`/`}</inlineCode>{` but we may have something like `}<inlineCode parentName=\"p\">{`/health`}</inlineCode>{`. If the HTTP response code is `}<inlineCode parentName=\"p\">{`200`}</inlineCode>{` then the pool member is considered healthy.`}</p>\n    <h2>{`IBM Cloud Object Storage`}</h2>\n    <p>{`There are different type of storage objects in cloud environment and you use different types for different situations Review the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/cloud-object-storage?topic=cloud-object-storage-about-cloud-object-storage\"\n      }}>{`IBM Cloud Object Storage`}</a>{` resources to know how to use them and which storage object to use.`}</p>\n    <p>{`We use the resource `}<inlineCode parentName=\"p\">{`ibm_cos_bucket`}</inlineCode>{` to create an Object Storage bucket to store data but it requires a `}<inlineCode parentName=\"p\">{`ibm_resource_instance`}</inlineCode>{` to be created in advance. There are 5 different storage classes to choose:`}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Smart Tier`}</strong>{` (`}<inlineCode parentName=\"li\">{`smart`}</inlineCode>{`) can be used for any workload, especially dynamic workloads where access patterns are unknown or difficult to predict. Smart Tier provides a simplified pricing structure and automatic cost optimization by classifying the data into “hot”, “cool”, and “cold” tiers based on monthly usage patterns. All data in the bucket is then billed at the lowest applicable rate. There are no threshold object sizes or storage periods, and there are no retrieval fees.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Standard`}</strong>{` (`}<inlineCode parentName=\"li\">{`standard`}</inlineCode>{`) is used for active workloads, with no charge for data retrieved (other than the cost of the operational request itself).`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Vault`}</strong>{` (`}<inlineCode parentName=\"li\">{`vault`}</inlineCode>{`) is used for cool workloads where data is accessed less than once a month - an extra retrieval charge ($/GB) is applied each time data is read. The service includes a minimum threshold for object size and storage period consistent with the intended use of this service for cooler, less-active data.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Cold Vault`}</strong>{` (`}<inlineCode parentName=\"li\">{`cold`}</inlineCode>{`) is used for cold workloads where data is accessed every 90 days or less - a larger extra retrieval charge ($/GB) is applied each time data is read. The service includes a longer minimum threshold for object size and storage period consistent with the intended use of this service for cold, inactive data.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Flex`}</strong>{` (`}<inlineCode parentName=\"li\">{`flex`}</inlineCode>{`) is being replaced by Smart Tier for dynamic workloads.`}</li>\n    </ul>\n    <p>{`In our demo application we use this bucket to store images with the movie covers and they are actively used, so the object class to choose is `}<inlineCode parentName=\"p\">{`standard`}</inlineCode>{`. For more information about storage classes, see `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage?topic=cloud-object-storage-classes\"\n      }}>{`Use storage classes`}</a>{`.`}</p>\n    <p>{`Lets create the storage with the following code:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\"\n      }}>{`resource \"ibm_resource_instance\" \"iac_app_cos_instance\" {\n  name     = \"\\${var.project_name}-\\${var.environment}-cos-instance\"\n  service  = \"cloud-object-storage\"\n  plan     = \"standard\"\n  location = \"global\"\n}\n\nresource \"ibm_cos_bucket\" \"iac_app_cos_bucket\" {\n  bucket_name          = \"\\${var.project_name}-\\${var.environment}-bucket\"\n  resource_instance_id = ibm_resource_instance.iac_app_cos_instance.id\n  region_location      = \"us-south\"\n  storage_class        = \"smart\"\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ibm_cos_bucket`}</inlineCode>{` resource requires the following input parameters:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`bucket_name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`to name the bucket`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`resource_instance_id`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`ID of the `}<inlineCode parentName=\"td\">{`ibm_resource_instance`}</inlineCode>{` service instance for which you want to create a bucket`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`storage_class`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The storage class that you want to use for the bucket`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`region_location`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`location of a regional bucket. Do not use this parameter with other `}<inlineCode parentName=\"td\">{`*_location`}</inlineCode>{` parameter`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`single_site_location`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`location for a single site bucket. Do not use this parameter with other `}<inlineCode parentName=\"td\">{`*_location`}</inlineCode>{` parameter`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`cross_region_location`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`location for a cross-regional bucket. Do not use this parameter with other `}<inlineCode parentName=\"td\">{`*_location`}</inlineCode>{` parameter`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`For more information about other optional input parameters and the output parameters read the `}<inlineCode parentName=\"p\">{`ibm_cos_bucket`}</inlineCode>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-resources#cos-bucket\"\n      }}>{`IBM Cloud Object Storage resource documentation`}</a>{`.`}</p>\n    <p>{`The upload of data to the bucket is not done with Terraform nor Schematics, but can be done using code in different languages such as `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-go\"\n      }}>{`Go`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-python\"\n      }}>{`Python`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-node\"\n      }}>{`Node`}</a>{` or `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage/libraries?topic=cloud-object-storage-java\"\n      }}>{`Java`}</a>{` using the SDK, or using the Linux commands (i.e. `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{`) with the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/services/cloud-object-storage/api-reference?topic=cloud-object-storage-compatibility-api\"\n      }}>{`Cloud Storage API`}</a>{`, or using any file transfer tools such as `}<a parentName=\"p\" {...{\n        \"href\": \"https://cyberduck.io/\"\n      }}>{`Cyberduck`}</a>{` or `}<a parentName=\"p\" {...{\n        \"href\": \"https://panic.com/transmit/\"\n      }}>{`Transmit`}</a>{` and command-line utilities like `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/s3tools/s3cmd\"\n      }}>{`s3cmd`}</a>{` or `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/minio/mc\"\n      }}>{`Minio Client`}</a>{`, and many others.`}</p>\n    <h2>{`Block Storage for Volumes`}</h2>\n    <p>{`Besides IBM Cloud Storage Object we can attach volumes to the instance to store data or files to access though file system interface, file system access semantics (such as strong consistency and file locking), and concurrently-accessible storage.`}</p>\n    <p>{`Block Storage are block-level volumes that can be attached to VSI as either a boot volume or as a data volume. The boot volumes are attached by default. The `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-block-storage-about\"\n      }}>{`Block Storage for VPC`}</a>{` documentation can give you more information.`}</p>\n    <p>{`To create a data volume per instance we use the `}<inlineCode parentName=\"p\">{`ibm_is_volume`}</inlineCode>{` resource with a code like this one.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=storage.tf\",\n        \"path\": \"storage.tf\"\n      }}>{`resource \"ibm_is_volume\" \"iac_app_volume\" {\n  count    = var.max_size\n  name     = \"\\${var.project_name}-\\${var.environment}-volume-\\${format(\"%02s\", count.index)}\"\n  profile  = \"10iops-tier\"\n  zone     = \"us-south-1\"\n  capacity = 100\n}\n`}</code></pre>\n    <p>{`The main input parameters for `}<inlineCode parentName=\"p\">{`ibm_is_volume`}</inlineCode>{` are described in the following table.`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Input parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`name`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`to name the volume`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`profile`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`volume profile`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`zone`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`location of the volume`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`capacity`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`capacity of the volume in gigabytes. the default value is `}<inlineCode parentName=\"td\">{`100`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`iops`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`total input/ output operations per second (IOPS) for your storage. This value is required for custom storage profiles only`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-capacity-performance\"\n      }}>{`Block Storage Capacity and Performance`}</a>{` documentation give you information about the available capacities and the performance (IOPS and Throughput) per capacity.`}</p>\n    <p>{`To get a list of volume profiles with the CLI use the following command, also the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/vpc?topic=vpc-block-storage-profiles\"\n      }}>{`Profiles`}</a>{` documentation list the available profiles and explain how to define a custom one.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud is volume-profiles\n`}</code></pre>\n    <p>{`Having the Block Storage is not enough, you need to assign the volume to the VSI using the `}<inlineCode parentName=\"p\">{`volumes`}</inlineCode>{` list attribute of the `}<inlineCode parentName=\"p\">{`ibm_is_instance`}</inlineCode>{` resource, like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`resource \"ibm_is_instance\" \"iac_app_instance\" {\n  ...\n  volumes = [ibm_is_volume.iac_app_volume[count.index].id]\n  ...\n}\n`}</code></pre>\n    <p>{`Notice the use of `}<inlineCode parentName=\"p\">{`count.index`}</inlineCode>{` to get one volume id. This way we ensure the volume `}<inlineCode parentName=\"p\">{`0`}</inlineCode>{` is assigned to the instance `}<inlineCode parentName=\"p\">{`0`}</inlineCode>{` and so on. The volume is mounted in the root partition, so there is no need to modify the user data to change the location of the JSON DB file.`}</p>\n    <p>{`Verify and apply all the changes executing the commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform plan\nterraform apply\n`}</code></pre>\n    <p>{`To test the API works execute the following command to get the Load Balancer FQDN or entrypoint to be used by the `}<inlineCode parentName=\"p\">{`curl`}</inlineCode>{` command:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`curl $(terraform output entrypoint)/movies/675\n`}</code></pre>\n    <h2>{`Final Terraform code`}</h2>\n    <p>{`You can download the code from the GitHub repository `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/\"\n      }}>{`https://github.com/IBM/cloud-enterprise-examples/`}</a>{` in the directory `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute\"\n      }}>{`07-compute`}</a>{` where the main files are:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=compute.tf\",\n        \"path\": \"compute.tf\"\n      }}>{`resource \"ibm_is_ssh_key\" \"iac_app_key\" {\n  name       = \"\\${var.project_name}-\\${var.environment}-key\"\n  public_key = var.public_key\n}\n\ndata \"local_file\" \"db\" {\n  filename = \"\\${path.module}/db.min.json\"\n}\n\ndata \"ibm_is_image\" \"ds_iac_app_image\" {\n  name = \"ibm-ubuntu-18-04-1-minimal-amd64-1\"\n}\n\nresource \"ibm_is_instance\" \"iac_app_instance\" {\n  count   = var.max_size\n  name    = \"\\${var.project_name}-\\${var.environment}-instance-\\${format(\"%02s\", count.index)}\"\n  image   = data.ibm_is_image.ds_iac_app_image.id\n  profile = \"cx2-2x4\"\n\n  primary_network_interface {\n    name            = \"eth1\"\n    subnet          = ibm_is_subnet.iac_app_subnet.id\n    security_groups = [ibm_is_security_group.iac_app_security_group.id]\n  }\n\n  vpc     = ibm_is_vpc.iac_app_vpc.id\n  zone    = \"us-south-1\"\n  keys    = [ibm_is_ssh_key.iac_app_key.id]\n  volumes = [ibm_is_volume.iac_app_volume[count.index].id]\n\n  user_data = <<-EOUD\n            #!/bin/bash\n            echo '\\${data.local_file.db.content_base64}' | base64 --decode > /var/lib/db.min.json\n\n            echo '* libraries/restart-without-asking boolean true' | debconf-set-selections\n\n            apt update\n            curl -sL https://deb.nodesource.com/setup_13.x | sudo -E bash -\n            apt-get install -y nodejs\n            npm install -g json-server\n\n            json-server --watch /var/lib/db.min.json --port \\${var.port} --host 0.0.0.0 &\n            EOUD\n\n  tags = [\"iac-\\${var.project_name}-\\${var.environment}\"]\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=lb.tf\",\n        \"path\": \"lb.tf\"\n      }}>{`resource \"ibm_is_lb\" \"iac_app_lb\" {\n  name    = \"\\${var.project_name}-\\${var.environment}-lb\"\n  subnets = [ibm_is_subnet.iac_app_subnet.id]\n}\n\nresource \"ibm_is_lb_listener\" \"iac_app_lb_listener\" {\n  lb       = ibm_is_lb.iac_app_lb.id\n  port     = var.port\n  protocol = \"http\"\n  default_pool = ibm_is_lb_pool.iac_app_lb_pool.id\n}\n\nresource \"ibm_is_lb_pool\" \"iac_app_lb_pool\" {\n  name                = \"\\${var.project_name}-\\${var.environment}-lb-pool\"\n  lb                  = ibm_is_lb.iac_app_lb.id\n  algorithm           = \"round_robin\"\n  protocol            = \"http\"\n  health_delay        = 5\n  health_retries      = 2\n  health_timeout      = 2\n  health_type         = \"http\"\n  health_monitor_url  = \"/\"\n  health_monitor_port = var.port\n}\n\nresource \"ibm_is_lb_pool_member\" \"iac_app_lb_pool_mem\" {\n  count          = var.max_size\n  lb             = ibm_is_lb.iac_app_lb.id\n  pool           = ibm_is_lb_pool.iac_app_lb_pool.id\n  port           = var.port\n  target_address = ibm_is_instance.iac_app_instance[count.index].primary_network_interface.0.primary_ipv4_address\n  weight         = (100 - count.index)\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=storage\",\n        \"path\": \"storage\"\n      }}>{`resource \"ibm_resource_instance\" \"iac_app_cos_instance\" {\n  name     = \"\\${var.project_name}-\\${var.environment}-cos-instance\"\n  service  = \"cloud-object-storage\"\n  plan     = \"standard\"\n  location = \"global\"\n}\n\nresource \"ibm_cos_bucket\" \"iac_app_cos_bucket\" {\n  bucket_name          = \"\\${var.project_name}-\\${var.environment}-bucket\"\n  resource_instance_id = ibm_resource_instance.iac_app_cos_instance.id\n  region_location      = \"us-south\"\n  storage_class        = \"smart\"\n}\n\nresource \"ibm_is_volume\" \"iac_app_volume\" {\n  count    = var.max_size\n  name     = \"\\${var.project_name}-\\${var.environment}-volume-\\${format(\"%02s\", count.index)}\"\n  profile  = \"10iops-tier\"\n  zone     = \"us-south-1\"\n  capacity = 100\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=output.tf\",\n        \"path\": \"output.tf\"\n      }}>{`output \"lb_ip_address\" {\n  value = ibm_is_lb.iac_app_lb.public_ips\n}\n\noutput \"entrypoint\" {\n  value = \"http://\\${ibm_is_lb.iac_app_lb.hostname}:\\${var.port}\"\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-hcl\",\n        \"metastring\": \"path=variables.tf\",\n        \"path\": \"variables.tf\"\n      }}>{`variable \"project_name\" {}\nvariable \"environment\" {}\n\nvariable \"public_key\" {}\n\nvariable \"port\" {\n  default = 8080\n}\nvariable \"max_size\" {\n  default = 3\n}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\",\n        \"metastring\": \"path=workspace.tmpl.json\",\n        \"path\": \"workspace.tmpl.json\"\n      }}>{`{\n  \"name\": \"iac_schematics_test\",\n  \"type\": [\n    \"terraform_v0.12\"\n  ],\n  \"description\": \"Sample workspace to test IBM Cloud Schematics. Deploys an web server on a VSI with a Hello World response\",\n  \"tags\": [\n    \"app:helloworld\",\n    \"env:dev\"\n  ],\n  \"template_repo\": {\n    \"url\": \"https://github.com/IBM/cloud-enterprise-examples/tree/master/iac/07-compute\"\n  },\n  \"template_data\": [{\n    \"folder\": \".\",\n    \"type\": \"terraform_v0.12\",\n    \"variablestore\": [{\n        \"name\": \"project_name\",\n        \"value\": \"iac_schematics_test\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"environment\",\n        \"value\": \"dev\",\n        \"type\": \"string\"\n      },\n      {\n        \"name\": \"public_key\",\n        \"value\": \"{ PUBLIC_KEY }\",\n        \"type\": \"string\"\n      }\n    ]\n  }]\n}\n`}</code></pre>\n    <h2>{`Clean up`}</h2>\n    <p>{`In this section you have created the same infrastructure using Terraform CLI and IBM Cloud Schematics.`}</p>\n    <p>{`To destroy everything created with Terraform CLI, execute:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`terraform destroy\n`}</code></pre>\n    <p>{`To delete everything you’ve created with IBM Cloud Schematics, execute the following command to destroy the infrastructure:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ID=$(ibmcloud schematics workspace list --json | jq -r '.workspaces[] | select(.name == \"iac_schematics_test\") | .id')\nibmcloud schematics destroy --id $ID\n\n# Or:\nact_ID=$(ibmcloud schematics destroy --id $ID --force --json | jq -r '.activityid')\nibmcloud schematics logs --id $ID --act-id $act_ID\n`}</code></pre>\n    <p>{`Finally, to delete the Workspace, execute these commands:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`ibmcloud schematics workspace delete --id $ID --force\nibmcloud schematics workspace list\n`}</code></pre>\n    <h2>{`Compute Resources & Data Source Reference`}</h2>\n    <p>{`The following Terraform Resources or Data Source are used to handle compute resources. Most of them are covered in this section, for those that were not, the links include a description, examples, the input and output parameters. There are also other useful links related to the resources that you may find useful.`}</p>\n    <AnchorLinks small mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_ssh_key</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_instance</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb_listener</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb_listener_policy</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb_listener_policy_rule</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb_pool</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_lb_pool_member</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_volume</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_images</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_instance_profile</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_instance_profiles</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">ibm_is_region</AnchorLink>\n    </AnchorLinks>\n    <h3>{`ibm_is_ssh_key`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#ssh-key\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-ssh-key\"\n        }}>{`Data Source documentation`}</a>{` retrieves non sensitive information from the given ssh key name`}</li>\n      <li parentName=\"ul\">{`Terraform `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.terraform.io/docs/configuration/variables.html\"\n        }}>{`input variables`}</a>{` are required to load the content of the SSH public key, using filesystem functions such as `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.terraform.io/docs/configuration/functions/file.html\"\n        }}>{`file`}</a>{` and Terraform data source like `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.terraform.io/docs/providers/local/d/file.html\"\n        }}>{`local_file`}</a>{`.`}</li>\n      <li parentName=\"ul\">{`Command `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.ssh.com/ssh/keygen/\"\n        }}><inlineCode parentName=\"a\">{`ssh-keygen`}</inlineCode></a>{` is required to generate the SSH key pair files.`}</li>\n    </ul>\n    <h3>{`ibm_is_instance`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#provider-instance\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb_listener`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb_listener_policy`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener-policy)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb_listener_policy_rule`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-listener-policy-rule)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb_pool`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-pool)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_lb_pool_member`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#lb-pool-member)\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_is_volume`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-resources&-access-data-sources#volume\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n    </ul>\n    <h3>{`ibm_cos_bucket`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-resources#cos-bucket\"\n        }}>{`Resource documentation`}</a>{` with examples, input and output parameters.`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-object-storage-data-sources#cos-bucket\"\n        }}>{`Data Source documentation`}</a>{` retrieves information about the given bucket`}</li>\n    </ul>\n    <h3>{`ibm_is_images`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-image\"\n        }}>{`Data Source documentation`}</a>{` retrieves all the compute images`}</li>\n    </ul>\n    <h3>{`ibm_is_instance_profile`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-instance-profile)\"\n        }}>{`Data Source documentation`}</a>{` retrieves an instance profile from a given name.`}</li>\n    </ul>\n    <h3>{`ibm_is_instance_profiles`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-instance-profiles)\"\n        }}>{`Data Source documentation`}</a>{` retrieves all the instance profiles`}</li>\n    </ul>\n    <h3>{`ibm_is_region`}</h3>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"(https://cloud.ibm.com/docs/terraform?topic=terraform-vpc-gen2-data-sources&-access-data-sources#vpc-region)\"\n        }}>{`Data Source documentation`}</a>{` retrieves all the regions.`}</li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}